{
  "version": 3,
  "sources": ["wrangler-modules-watch:wrangler:modules-watch", "../../../node_modules/wrangler/templates/modules-watch-stub.js", "../../../node_modules/bcryptjs/dist/bcrypt.js", "../bundle-L0oFto/middleware-loader.entry.ts", "../bundle-L0oFto/middleware-insertion-facade.js", "../../../src/index.ts", "../../../node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "../../../node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../../../node_modules/wrangler/templates/middleware/common.ts"],
  "sourceRoot": "M:\\DashBoardTO\\TecRail\\.wrangler\\tmp\\dev-xTUyGE",
  "sourcesContent": ["", "// `esbuild` doesn't support returning `watch*` options from `onStart()`\n// plugin callbacks. Instead, we define an empty virtual module that is\n// imported by this injected file. Importing the module registers watchers.\nimport \"wrangler:modules-watch\";\n", "/*\r\n Copyright (c) 2012 Nevins Bartolomeo <nevins.bartolomeo@gmail.com>\r\n Copyright (c) 2012 Shane Girish <shaneGirish@gmail.com>\r\n Copyright (c) 2014 Daniel Wirtz <dcode@dcode.io>\r\n\r\n Redistribution and use in source and binary forms, with or without\r\n modification, are permitted provided that the following conditions\r\n are met:\r\n 1. Redistributions of source code must retain the above copyright\r\n notice, this list of conditions and the following disclaimer.\r\n 2. Redistributions in binary form must reproduce the above copyright\r\n notice, this list of conditions and the following disclaimer in the\r\n documentation and/or other materials provided with the distribution.\r\n 3. The name of the author may not be used to endorse or promote products\r\n derived from this software without specific prior written permission.\r\n\r\n THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR\r\n IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES\r\n OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\r\n IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,\r\n INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\r\n NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\r\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\r\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n */\r\n\r\n/**\r\n * @license bcrypt.js (c) 2013 Daniel Wirtz <dcode@dcode.io>\r\n * Released under the Apache License, Version 2.0\r\n * see: https://github.com/dcodeIO/bcrypt.js for details\r\n */\r\n(function(global, factory) {\r\n\r\n    /* AMD */ if (typeof define === 'function' && define[\"amd\"])\r\n        define([], factory);\r\n    /* CommonJS */ else if (typeof require === 'function' && typeof module === \"object\" && module && module[\"exports\"])\r\n        module[\"exports\"] = factory();\r\n    /* Global */ else\r\n        (global[\"dcodeIO\"] = global[\"dcodeIO\"] || {})[\"bcrypt\"] = factory();\r\n\r\n}(this, function() {\r\n    \"use strict\";\r\n\r\n    /**\r\n     * bcrypt namespace.\r\n     * @type {Object.<string,*>}\r\n     */\r\n    var bcrypt = {};\r\n\r\n    /**\r\n     * The random implementation to use as a fallback.\r\n     * @type {?function(number):!Array.<number>}\r\n     * @inner\r\n     */\r\n    var randomFallback = null;\r\n\r\n    /**\r\n     * Generates cryptographically secure random bytes.\r\n     * @function\r\n     * @param {number} len Bytes length\r\n     * @returns {!Array.<number>} Random bytes\r\n     * @throws {Error} If no random implementation is available\r\n     * @inner\r\n     */\r\n    function random(len) {\r\n        /* node */ if (typeof module !== 'undefined' && module && module['exports'])\r\n            try {\r\n                return require(\"crypto\")['randomBytes'](len);\r\n            } catch (e) {}\r\n        /* WCA */ try {\r\n            var a; (self['crypto']||self['msCrypto'])['getRandomValues'](a = new Uint32Array(len));\r\n            return Array.prototype.slice.call(a);\r\n        } catch (e) {}\r\n        /* fallback */ if (!randomFallback)\r\n            throw Error(\"Neither WebCryptoAPI nor a crypto module is available. Use bcrypt.setRandomFallback to set an alternative\");\r\n        return randomFallback(len);\r\n    }\r\n\r\n    // Test if any secure randomness source is available\r\n    var randomAvailable = false;\r\n    try {\r\n        random(1);\r\n        randomAvailable = true;\r\n    } catch (e) {}\r\n\r\n    // Default fallback, if any\r\n    randomFallback = null;\r\n    /**\r\n     * Sets the pseudo random number generator to use as a fallback if neither node's `crypto` module nor the Web Crypto\r\n     *  API is available. Please note: It is highly important that the PRNG used is cryptographically secure and that it\r\n     *  is seeded properly!\r\n     * @param {?function(number):!Array.<number>} random Function taking the number of bytes to generate as its\r\n     *  sole argument, returning the corresponding array of cryptographically secure random byte values.\r\n     * @see http://nodejs.org/api/crypto.html\r\n     * @see http://www.w3.org/TR/WebCryptoAPI/\r\n     */\r\n    bcrypt.setRandomFallback = function(random) {\r\n        randomFallback = random;\r\n    };\r\n\r\n    /**\r\n     * Synchronously generates a salt.\r\n     * @param {number=} rounds Number of rounds to use, defaults to 10 if omitted\r\n     * @param {number=} seed_length Not supported.\r\n     * @returns {string} Resulting salt\r\n     * @throws {Error} If a random fallback is required but not set\r\n     * @expose\r\n     */\r\n    bcrypt.genSaltSync = function(rounds, seed_length) {\r\n        rounds = rounds || GENSALT_DEFAULT_LOG2_ROUNDS;\r\n        if (typeof rounds !== 'number')\r\n            throw Error(\"Illegal arguments: \"+(typeof rounds)+\", \"+(typeof seed_length));\r\n        if (rounds < 4)\r\n            rounds = 4;\r\n        else if (rounds > 31)\r\n            rounds = 31;\r\n        var salt = [];\r\n        salt.push(\"$2a$\");\r\n        if (rounds < 10)\r\n            salt.push(\"0\");\r\n        salt.push(rounds.toString());\r\n        salt.push('$');\r\n        salt.push(base64_encode(random(BCRYPT_SALT_LEN), BCRYPT_SALT_LEN)); // May throw\r\n        return salt.join('');\r\n    };\r\n\r\n    /**\r\n     * Asynchronously generates a salt.\r\n     * @param {(number|function(Error, string=))=} rounds Number of rounds to use, defaults to 10 if omitted\r\n     * @param {(number|function(Error, string=))=} seed_length Not supported.\r\n     * @param {function(Error, string=)=} callback Callback receiving the error, if any, and the resulting salt\r\n     * @returns {!Promise} If `callback` has been omitted\r\n     * @throws {Error} If `callback` is present but not a function\r\n     * @expose\r\n     */\r\n    bcrypt.genSalt = function(rounds, seed_length, callback) {\r\n        if (typeof seed_length === 'function')\r\n            callback = seed_length,\r\n            seed_length = undefined; // Not supported.\r\n        if (typeof rounds === 'function')\r\n            callback = rounds,\r\n            rounds = undefined;\r\n        if (typeof rounds === 'undefined')\r\n            rounds = GENSALT_DEFAULT_LOG2_ROUNDS;\r\n        else if (typeof rounds !== 'number')\r\n            throw Error(\"illegal arguments: \"+(typeof rounds));\r\n\r\n        function _async(callback) {\r\n            nextTick(function() { // Pretty thin, but salting is fast enough\r\n                try {\r\n                    callback(null, bcrypt.genSaltSync(rounds));\r\n                } catch (err) {\r\n                    callback(err);\r\n                }\r\n            });\r\n        }\r\n\r\n        if (callback) {\r\n            if (typeof callback !== 'function')\r\n                throw Error(\"Illegal callback: \"+typeof(callback));\r\n            _async(callback);\r\n        } else\r\n            return new Promise(function(resolve, reject) {\r\n                _async(function(err, res) {\r\n                    if (err) {\r\n                        reject(err);\r\n                        return;\r\n                    }\r\n                    resolve(res);\r\n                });\r\n            });\r\n    };\r\n\r\n    /**\r\n     * Synchronously generates a hash for the given string.\r\n     * @param {string} s String to hash\r\n     * @param {(number|string)=} salt Salt length to generate or salt to use, default to 10\r\n     * @returns {string} Resulting hash\r\n     * @expose\r\n     */\r\n    bcrypt.hashSync = function(s, salt) {\r\n        if (typeof salt === 'undefined')\r\n            salt = GENSALT_DEFAULT_LOG2_ROUNDS;\r\n        if (typeof salt === 'number')\r\n            salt = bcrypt.genSaltSync(salt);\r\n        if (typeof s !== 'string' || typeof salt !== 'string')\r\n            throw Error(\"Illegal arguments: \"+(typeof s)+', '+(typeof salt));\r\n        return _hash(s, salt);\r\n    };\r\n\r\n    /**\r\n     * Asynchronously generates a hash for the given string.\r\n     * @param {string} s String to hash\r\n     * @param {number|string} salt Salt length to generate or salt to use\r\n     * @param {function(Error, string=)=} callback Callback receiving the error, if any, and the resulting hash\r\n     * @param {function(number)=} progressCallback Callback successively called with the percentage of rounds completed\r\n     *  (0.0 - 1.0), maximally once per `MAX_EXECUTION_TIME = 100` ms.\r\n     * @returns {!Promise} If `callback` has been omitted\r\n     * @throws {Error} If `callback` is present but not a function\r\n     * @expose\r\n     */\r\n    bcrypt.hash = function(s, salt, callback, progressCallback) {\r\n\r\n        function _async(callback) {\r\n            if (typeof s === 'string' && typeof salt === 'number')\r\n                bcrypt.genSalt(salt, function(err, salt) {\r\n                    _hash(s, salt, callback, progressCallback);\r\n                });\r\n            else if (typeof s === 'string' && typeof salt === 'string')\r\n                _hash(s, salt, callback, progressCallback);\r\n            else\r\n                nextTick(callback.bind(this, Error(\"Illegal arguments: \"+(typeof s)+', '+(typeof salt))));\r\n        }\r\n\r\n        if (callback) {\r\n            if (typeof callback !== 'function')\r\n                throw Error(\"Illegal callback: \"+typeof(callback));\r\n            _async(callback);\r\n        } else\r\n            return new Promise(function(resolve, reject) {\r\n                _async(function(err, res) {\r\n                    if (err) {\r\n                        reject(err);\r\n                        return;\r\n                    }\r\n                    resolve(res);\r\n                });\r\n            });\r\n    };\r\n\r\n    /**\r\n     * Compares two strings of the same length in constant time.\r\n     * @param {string} known Must be of the correct length\r\n     * @param {string} unknown Must be the same length as `known`\r\n     * @returns {boolean}\r\n     * @inner\r\n     */\r\n    function safeStringCompare(known, unknown) {\r\n        var right = 0,\r\n            wrong = 0;\r\n        for (var i=0, k=known.length; i<k; ++i) {\r\n            if (known.charCodeAt(i) === unknown.charCodeAt(i))\r\n                ++right;\r\n            else\r\n                ++wrong;\r\n        }\r\n        // Prevent removal of unused variables (never true, actually)\r\n        if (right < 0)\r\n            return false;\r\n        return wrong === 0;\r\n    }\r\n\r\n    /**\r\n     * Synchronously tests a string against a hash.\r\n     * @param {string} s String to compare\r\n     * @param {string} hash Hash to test against\r\n     * @returns {boolean} true if matching, otherwise false\r\n     * @throws {Error} If an argument is illegal\r\n     * @expose\r\n     */\r\n    bcrypt.compareSync = function(s, hash) {\r\n        if (typeof s !== \"string\" || typeof hash !== \"string\")\r\n            throw Error(\"Illegal arguments: \"+(typeof s)+', '+(typeof hash));\r\n        if (hash.length !== 60)\r\n            return false;\r\n        return safeStringCompare(bcrypt.hashSync(s, hash.substr(0, hash.length-31)), hash);\r\n    };\r\n\r\n    /**\r\n     * Asynchronously compares the given data against the given hash.\r\n     * @param {string} s Data to compare\r\n     * @param {string} hash Data to be compared to\r\n     * @param {function(Error, boolean)=} callback Callback receiving the error, if any, otherwise the result\r\n     * @param {function(number)=} progressCallback Callback successively called with the percentage of rounds completed\r\n     *  (0.0 - 1.0), maximally once per `MAX_EXECUTION_TIME = 100` ms.\r\n     * @returns {!Promise} If `callback` has been omitted\r\n     * @throws {Error} If `callback` is present but not a function\r\n     * @expose\r\n     */\r\n    bcrypt.compare = function(s, hash, callback, progressCallback) {\r\n\r\n        function _async(callback) {\r\n            if (typeof s !== \"string\" || typeof hash !== \"string\") {\r\n                nextTick(callback.bind(this, Error(\"Illegal arguments: \"+(typeof s)+', '+(typeof hash))));\r\n                return;\r\n            }\r\n            if (hash.length !== 60) {\r\n                nextTick(callback.bind(this, null, false));\r\n                return;\r\n            }\r\n            bcrypt.hash(s, hash.substr(0, 29), function(err, comp) {\r\n                if (err)\r\n                    callback(err);\r\n                else\r\n                    callback(null, safeStringCompare(comp, hash));\r\n            }, progressCallback);\r\n        }\r\n\r\n        if (callback) {\r\n            if (typeof callback !== 'function')\r\n                throw Error(\"Illegal callback: \"+typeof(callback));\r\n            _async(callback);\r\n        } else\r\n            return new Promise(function(resolve, reject) {\r\n                _async(function(err, res) {\r\n                    if (err) {\r\n                        reject(err);\r\n                        return;\r\n                    }\r\n                    resolve(res);\r\n                });\r\n            });\r\n    };\r\n\r\n    /**\r\n     * Gets the number of rounds used to encrypt the specified hash.\r\n     * @param {string} hash Hash to extract the used number of rounds from\r\n     * @returns {number} Number of rounds used\r\n     * @throws {Error} If `hash` is not a string\r\n     * @expose\r\n     */\r\n    bcrypt.getRounds = function(hash) {\r\n        if (typeof hash !== \"string\")\r\n            throw Error(\"Illegal arguments: \"+(typeof hash));\r\n        return parseInt(hash.split(\"$\")[2], 10);\r\n    };\r\n\r\n    /**\r\n     * Gets the salt portion from a hash. Does not validate the hash.\r\n     * @param {string} hash Hash to extract the salt from\r\n     * @returns {string} Extracted salt part\r\n     * @throws {Error} If `hash` is not a string or otherwise invalid\r\n     * @expose\r\n     */\r\n    bcrypt.getSalt = function(hash) {\r\n        if (typeof hash !== 'string')\r\n            throw Error(\"Illegal arguments: \"+(typeof hash));\r\n        if (hash.length !== 60)\r\n            throw Error(\"Illegal hash length: \"+hash.length+\" != 60\");\r\n        return hash.substring(0, 29);\r\n    };\r\n\r\n    /**\r\n     * Continues with the callback on the next tick.\r\n     * @function\r\n     * @param {function(...[*])} callback Callback to execute\r\n     * @inner\r\n     */\r\n    var nextTick = typeof process !== 'undefined' && process && typeof process.nextTick === 'function'\r\n        ? (typeof setImmediate === 'function' ? setImmediate : process.nextTick)\r\n        : setTimeout;\r\n\r\n    /**\r\n     * Converts a JavaScript string to UTF8 bytes.\r\n     * @param {string} str String\r\n     * @returns {!Array.<number>} UTF8 bytes\r\n     * @inner\r\n     */\r\n    function stringToBytes(str) {\r\n        var out = [],\r\n            i = 0;\r\n        utfx.encodeUTF16toUTF8(function() {\r\n            if (i >= str.length) return null;\r\n            return str.charCodeAt(i++);\r\n        }, function(b) {\r\n            out.push(b);\r\n        });\r\n        return out;\r\n    }\r\n\r\n    // A base64 implementation for the bcrypt algorithm. This is partly non-standard.\r\n\r\n    /**\r\n     * bcrypt's own non-standard base64 dictionary.\r\n     * @type {!Array.<string>}\r\n     * @const\r\n     * @inner\r\n     **/\r\n    var BASE64_CODE = \"./ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\".split('');\r\n\r\n    /**\r\n     * @type {!Array.<number>}\r\n     * @const\r\n     * @inner\r\n     **/\r\n    var BASE64_INDEX = [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\r\n        -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\r\n        -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0,\r\n        1, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, -1, -1, -1, -1, -1, -1,\r\n        -1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19,\r\n        20, 21, 22, 23, 24, 25, 26, 27, -1, -1, -1, -1, -1, -1, 28, 29, 30,\r\n        31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47,\r\n        48, 49, 50, 51, 52, 53, -1, -1, -1, -1, -1];\r\n\r\n    /**\r\n     * @type {!function(...number):string}\r\n     * @inner\r\n     */\r\n    var stringFromCharCode = String.fromCharCode;\r\n\r\n    /**\r\n     * Encodes a byte array to base64 with up to len bytes of input.\r\n     * @param {!Array.<number>} b Byte array\r\n     * @param {number} len Maximum input length\r\n     * @returns {string}\r\n     * @inner\r\n     */\r\n    function base64_encode(b, len) {\r\n        var off = 0,\r\n            rs = [],\r\n            c1, c2;\r\n        if (len <= 0 || len > b.length)\r\n            throw Error(\"Illegal len: \"+len);\r\n        while (off < len) {\r\n            c1 = b[off++] & 0xff;\r\n            rs.push(BASE64_CODE[(c1 >> 2) & 0x3f]);\r\n            c1 = (c1 & 0x03) << 4;\r\n            if (off >= len) {\r\n                rs.push(BASE64_CODE[c1 & 0x3f]);\r\n                break;\r\n            }\r\n            c2 = b[off++] & 0xff;\r\n            c1 |= (c2 >> 4) & 0x0f;\r\n            rs.push(BASE64_CODE[c1 & 0x3f]);\r\n            c1 = (c2 & 0x0f) << 2;\r\n            if (off >= len) {\r\n                rs.push(BASE64_CODE[c1 & 0x3f]);\r\n                break;\r\n            }\r\n            c2 = b[off++] & 0xff;\r\n            c1 |= (c2 >> 6) & 0x03;\r\n            rs.push(BASE64_CODE[c1 & 0x3f]);\r\n            rs.push(BASE64_CODE[c2 & 0x3f]);\r\n        }\r\n        return rs.join('');\r\n    }\r\n\r\n    /**\r\n     * Decodes a base64 encoded string to up to len bytes of output.\r\n     * @param {string} s String to decode\r\n     * @param {number} len Maximum output length\r\n     * @returns {!Array.<number>}\r\n     * @inner\r\n     */\r\n    function base64_decode(s, len) {\r\n        var off = 0,\r\n            slen = s.length,\r\n            olen = 0,\r\n            rs = [],\r\n            c1, c2, c3, c4, o, code;\r\n        if (len <= 0)\r\n            throw Error(\"Illegal len: \"+len);\r\n        while (off < slen - 1 && olen < len) {\r\n            code = s.charCodeAt(off++);\r\n            c1 = code < BASE64_INDEX.length ? BASE64_INDEX[code] : -1;\r\n            code = s.charCodeAt(off++);\r\n            c2 = code < BASE64_INDEX.length ? BASE64_INDEX[code] : -1;\r\n            if (c1 == -1 || c2 == -1)\r\n                break;\r\n            o = (c1 << 2) >>> 0;\r\n            o |= (c2 & 0x30) >> 4;\r\n            rs.push(stringFromCharCode(o));\r\n            if (++olen >= len || off >= slen)\r\n                break;\r\n            code = s.charCodeAt(off++);\r\n            c3 = code < BASE64_INDEX.length ? BASE64_INDEX[code] : -1;\r\n            if (c3 == -1)\r\n                break;\r\n            o = ((c2 & 0x0f) << 4) >>> 0;\r\n            o |= (c3 & 0x3c) >> 2;\r\n            rs.push(stringFromCharCode(o));\r\n            if (++olen >= len || off >= slen)\r\n                break;\r\n            code = s.charCodeAt(off++);\r\n            c4 = code < BASE64_INDEX.length ? BASE64_INDEX[code] : -1;\r\n            o = ((c3 & 0x03) << 6) >>> 0;\r\n            o |= c4;\r\n            rs.push(stringFromCharCode(o));\r\n            ++olen;\r\n        }\r\n        var res = [];\r\n        for (off = 0; off<olen; off++)\r\n            res.push(rs[off].charCodeAt(0));\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * utfx-embeddable (c) 2014 Daniel Wirtz <dcode@dcode.io>\r\n     * Released under the Apache License, Version 2.0\r\n     * see: https://github.com/dcodeIO/utfx for details\r\n     */\r\n    var utfx = function() {\r\n        \"use strict\";\r\n\r\n        /**\r\n         * utfx namespace.\r\n         * @inner\r\n         * @type {!Object.<string,*>}\r\n         */\r\n        var utfx = {};\r\n\r\n        /**\r\n         * Maximum valid code point.\r\n         * @type {number}\r\n         * @const\r\n         */\r\n        utfx.MAX_CODEPOINT = 0x10FFFF;\r\n\r\n        /**\r\n         * Encodes UTF8 code points to UTF8 bytes.\r\n         * @param {(!function():number|null) | number} src Code points source, either as a function returning the next code point\r\n         *  respectively `null` if there are no more code points left or a single numeric code point.\r\n         * @param {!function(number)} dst Bytes destination as a function successively called with the next byte\r\n         */\r\n        utfx.encodeUTF8 = function(src, dst) {\r\n            var cp = null;\r\n            if (typeof src === 'number')\r\n                cp = src,\r\n                src = function() { return null; };\r\n            while (cp !== null || (cp = src()) !== null) {\r\n                if (cp < 0x80)\r\n                    dst(cp&0x7F);\r\n                else if (cp < 0x800)\r\n                    dst(((cp>>6)&0x1F)|0xC0),\r\n                    dst((cp&0x3F)|0x80);\r\n                else if (cp < 0x10000)\r\n                    dst(((cp>>12)&0x0F)|0xE0),\r\n                    dst(((cp>>6)&0x3F)|0x80),\r\n                    dst((cp&0x3F)|0x80);\r\n                else\r\n                    dst(((cp>>18)&0x07)|0xF0),\r\n                    dst(((cp>>12)&0x3F)|0x80),\r\n                    dst(((cp>>6)&0x3F)|0x80),\r\n                    dst((cp&0x3F)|0x80);\r\n                cp = null;\r\n            }\r\n        };\r\n\r\n        /**\r\n         * Decodes UTF8 bytes to UTF8 code points.\r\n         * @param {!function():number|null} src Bytes source as a function returning the next byte respectively `null` if there\r\n         *  are no more bytes left.\r\n         * @param {!function(number)} dst Code points destination as a function successively called with each decoded code point.\r\n         * @throws {RangeError} If a starting byte is invalid in UTF8\r\n         * @throws {Error} If the last sequence is truncated. Has an array property `bytes` holding the\r\n         *  remaining bytes.\r\n         */\r\n        utfx.decodeUTF8 = function(src, dst) {\r\n            var a, b, c, d, fail = function(b) {\r\n                b = b.slice(0, b.indexOf(null));\r\n                var err = Error(b.toString());\r\n                err.name = \"TruncatedError\";\r\n                err['bytes'] = b;\r\n                throw err;\r\n            };\r\n            while ((a = src()) !== null) {\r\n                if ((a&0x80) === 0)\r\n                    dst(a);\r\n                else if ((a&0xE0) === 0xC0)\r\n                    ((b = src()) === null) && fail([a, b]),\r\n                    dst(((a&0x1F)<<6) | (b&0x3F));\r\n                else if ((a&0xF0) === 0xE0)\r\n                    ((b=src()) === null || (c=src()) === null) && fail([a, b, c]),\r\n                    dst(((a&0x0F)<<12) | ((b&0x3F)<<6) | (c&0x3F));\r\n                else if ((a&0xF8) === 0xF0)\r\n                    ((b=src()) === null || (c=src()) === null || (d=src()) === null) && fail([a, b, c ,d]),\r\n                    dst(((a&0x07)<<18) | ((b&0x3F)<<12) | ((c&0x3F)<<6) | (d&0x3F));\r\n                else throw RangeError(\"Illegal starting byte: \"+a);\r\n            }\r\n        };\r\n\r\n        /**\r\n         * Converts UTF16 characters to UTF8 code points.\r\n         * @param {!function():number|null} src Characters source as a function returning the next char code respectively\r\n         *  `null` if there are no more characters left.\r\n         * @param {!function(number)} dst Code points destination as a function successively called with each converted code\r\n         *  point.\r\n         */\r\n        utfx.UTF16toUTF8 = function(src, dst) {\r\n            var c1, c2 = null;\r\n            while (true) {\r\n                if ((c1 = c2 !== null ? c2 : src()) === null)\r\n                    break;\r\n                if (c1 >= 0xD800 && c1 <= 0xDFFF) {\r\n                    if ((c2 = src()) !== null) {\r\n                        if (c2 >= 0xDC00 && c2 <= 0xDFFF) {\r\n                            dst((c1-0xD800)*0x400+c2-0xDC00+0x10000);\r\n                            c2 = null; continue;\r\n                        }\r\n                    }\r\n                }\r\n                dst(c1);\r\n            }\r\n            if (c2 !== null) dst(c2);\r\n        };\r\n\r\n        /**\r\n         * Converts UTF8 code points to UTF16 characters.\r\n         * @param {(!function():number|null) | number} src Code points source, either as a function returning the next code point\r\n         *  respectively `null` if there are no more code points left or a single numeric code point.\r\n         * @param {!function(number)} dst Characters destination as a function successively called with each converted char code.\r\n         * @throws {RangeError} If a code point is out of range\r\n         */\r\n        utfx.UTF8toUTF16 = function(src, dst) {\r\n            var cp = null;\r\n            if (typeof src === 'number')\r\n                cp = src, src = function() { return null; };\r\n            while (cp !== null || (cp = src()) !== null) {\r\n                if (cp <= 0xFFFF)\r\n                    dst(cp);\r\n                else\r\n                    cp -= 0x10000,\r\n                    dst((cp>>10)+0xD800),\r\n                    dst((cp%0x400)+0xDC00);\r\n                cp = null;\r\n            }\r\n        };\r\n\r\n        /**\r\n         * Converts and encodes UTF16 characters to UTF8 bytes.\r\n         * @param {!function():number|null} src Characters source as a function returning the next char code respectively `null`\r\n         *  if there are no more characters left.\r\n         * @param {!function(number)} dst Bytes destination as a function successively called with the next byte.\r\n         */\r\n        utfx.encodeUTF16toUTF8 = function(src, dst) {\r\n            utfx.UTF16toUTF8(src, function(cp) {\r\n                utfx.encodeUTF8(cp, dst);\r\n            });\r\n        };\r\n\r\n        /**\r\n         * Decodes and converts UTF8 bytes to UTF16 characters.\r\n         * @param {!function():number|null} src Bytes source as a function returning the next byte respectively `null` if there\r\n         *  are no more bytes left.\r\n         * @param {!function(number)} dst Characters destination as a function successively called with each converted char code.\r\n         * @throws {RangeError} If a starting byte is invalid in UTF8\r\n         * @throws {Error} If the last sequence is truncated. Has an array property `bytes` holding the remaining bytes.\r\n         */\r\n        utfx.decodeUTF8toUTF16 = function(src, dst) {\r\n            utfx.decodeUTF8(src, function(cp) {\r\n                utfx.UTF8toUTF16(cp, dst);\r\n            });\r\n        };\r\n\r\n        /**\r\n         * Calculates the byte length of an UTF8 code point.\r\n         * @param {number} cp UTF8 code point\r\n         * @returns {number} Byte length\r\n         */\r\n        utfx.calculateCodePoint = function(cp) {\r\n            return (cp < 0x80) ? 1 : (cp < 0x800) ? 2 : (cp < 0x10000) ? 3 : 4;\r\n        };\r\n\r\n        /**\r\n         * Calculates the number of UTF8 bytes required to store UTF8 code points.\r\n         * @param {(!function():number|null)} src Code points source as a function returning the next code point respectively\r\n         *  `null` if there are no more code points left.\r\n         * @returns {number} The number of UTF8 bytes required\r\n         */\r\n        utfx.calculateUTF8 = function(src) {\r\n            var cp, l=0;\r\n            while ((cp = src()) !== null)\r\n                l += utfx.calculateCodePoint(cp);\r\n            return l;\r\n        };\r\n\r\n        /**\r\n         * Calculates the number of UTF8 code points respectively UTF8 bytes required to store UTF16 char codes.\r\n         * @param {(!function():number|null)} src Characters source as a function returning the next char code respectively\r\n         *  `null` if there are no more characters left.\r\n         * @returns {!Array.<number>} The number of UTF8 code points at index 0 and the number of UTF8 bytes required at index 1.\r\n         */\r\n        utfx.calculateUTF16asUTF8 = function(src) {\r\n            var n=0, l=0;\r\n            utfx.UTF16toUTF8(src, function(cp) {\r\n                ++n; l += utfx.calculateCodePoint(cp);\r\n            });\r\n            return [n,l];\r\n        };\r\n\r\n        return utfx;\r\n    }();\r\n\r\n    Date.now = Date.now || function() { return +new Date; };\r\n\r\n    /**\r\n     * @type {number}\r\n     * @const\r\n     * @inner\r\n     */\r\n    var BCRYPT_SALT_LEN = 16;\r\n\r\n    /**\r\n     * @type {number}\r\n     * @const\r\n     * @inner\r\n     */\r\n    var GENSALT_DEFAULT_LOG2_ROUNDS = 10;\r\n\r\n    /**\r\n     * @type {number}\r\n     * @const\r\n     * @inner\r\n     */\r\n    var BLOWFISH_NUM_ROUNDS = 16;\r\n\r\n    /**\r\n     * @type {number}\r\n     * @const\r\n     * @inner\r\n     */\r\n    var MAX_EXECUTION_TIME = 100;\r\n\r\n    /**\r\n     * @type {Array.<number>}\r\n     * @const\r\n     * @inner\r\n     */\r\n    var P_ORIG = [\r\n        0x243f6a88, 0x85a308d3, 0x13198a2e, 0x03707344, 0xa4093822,\r\n        0x299f31d0, 0x082efa98, 0xec4e6c89, 0x452821e6, 0x38d01377,\r\n        0xbe5466cf, 0x34e90c6c, 0xc0ac29b7, 0xc97c50dd, 0x3f84d5b5,\r\n        0xb5470917, 0x9216d5d9, 0x8979fb1b\r\n    ];\r\n\r\n    /**\r\n     * @type {Array.<number>}\r\n     * @const\r\n     * @inner\r\n     */\r\n    var S_ORIG = [\r\n        0xd1310ba6, 0x98dfb5ac, 0x2ffd72db, 0xd01adfb7, 0xb8e1afed,\r\n        0x6a267e96, 0xba7c9045, 0xf12c7f99, 0x24a19947, 0xb3916cf7,\r\n        0x0801f2e2, 0x858efc16, 0x636920d8, 0x71574e69, 0xa458fea3,\r\n        0xf4933d7e, 0x0d95748f, 0x728eb658, 0x718bcd58, 0x82154aee,\r\n        0x7b54a41d, 0xc25a59b5, 0x9c30d539, 0x2af26013, 0xc5d1b023,\r\n        0x286085f0, 0xca417918, 0xb8db38ef, 0x8e79dcb0, 0x603a180e,\r\n        0x6c9e0e8b, 0xb01e8a3e, 0xd71577c1, 0xbd314b27, 0x78af2fda,\r\n        0x55605c60, 0xe65525f3, 0xaa55ab94, 0x57489862, 0x63e81440,\r\n        0x55ca396a, 0x2aab10b6, 0xb4cc5c34, 0x1141e8ce, 0xa15486af,\r\n        0x7c72e993, 0xb3ee1411, 0x636fbc2a, 0x2ba9c55d, 0x741831f6,\r\n        0xce5c3e16, 0x9b87931e, 0xafd6ba33, 0x6c24cf5c, 0x7a325381,\r\n        0x28958677, 0x3b8f4898, 0x6b4bb9af, 0xc4bfe81b, 0x66282193,\r\n        0x61d809cc, 0xfb21a991, 0x487cac60, 0x5dec8032, 0xef845d5d,\r\n        0xe98575b1, 0xdc262302, 0xeb651b88, 0x23893e81, 0xd396acc5,\r\n        0x0f6d6ff3, 0x83f44239, 0x2e0b4482, 0xa4842004, 0x69c8f04a,\r\n        0x9e1f9b5e, 0x21c66842, 0xf6e96c9a, 0x670c9c61, 0xabd388f0,\r\n        0x6a51a0d2, 0xd8542f68, 0x960fa728, 0xab5133a3, 0x6eef0b6c,\r\n        0x137a3be4, 0xba3bf050, 0x7efb2a98, 0xa1f1651d, 0x39af0176,\r\n        0x66ca593e, 0x82430e88, 0x8cee8619, 0x456f9fb4, 0x7d84a5c3,\r\n        0x3b8b5ebe, 0xe06f75d8, 0x85c12073, 0x401a449f, 0x56c16aa6,\r\n        0x4ed3aa62, 0x363f7706, 0x1bfedf72, 0x429b023d, 0x37d0d724,\r\n        0xd00a1248, 0xdb0fead3, 0x49f1c09b, 0x075372c9, 0x80991b7b,\r\n        0x25d479d8, 0xf6e8def7, 0xe3fe501a, 0xb6794c3b, 0x976ce0bd,\r\n        0x04c006ba, 0xc1a94fb6, 0x409f60c4, 0x5e5c9ec2, 0x196a2463,\r\n        0x68fb6faf, 0x3e6c53b5, 0x1339b2eb, 0x3b52ec6f, 0x6dfc511f,\r\n        0x9b30952c, 0xcc814544, 0xaf5ebd09, 0xbee3d004, 0xde334afd,\r\n        0x660f2807, 0x192e4bb3, 0xc0cba857, 0x45c8740f, 0xd20b5f39,\r\n        0xb9d3fbdb, 0x5579c0bd, 0x1a60320a, 0xd6a100c6, 0x402c7279,\r\n        0x679f25fe, 0xfb1fa3cc, 0x8ea5e9f8, 0xdb3222f8, 0x3c7516df,\r\n        0xfd616b15, 0x2f501ec8, 0xad0552ab, 0x323db5fa, 0xfd238760,\r\n        0x53317b48, 0x3e00df82, 0x9e5c57bb, 0xca6f8ca0, 0x1a87562e,\r\n        0xdf1769db, 0xd542a8f6, 0x287effc3, 0xac6732c6, 0x8c4f5573,\r\n        0x695b27b0, 0xbbca58c8, 0xe1ffa35d, 0xb8f011a0, 0x10fa3d98,\r\n        0xfd2183b8, 0x4afcb56c, 0x2dd1d35b, 0x9a53e479, 0xb6f84565,\r\n        0xd28e49bc, 0x4bfb9790, 0xe1ddf2da, 0xa4cb7e33, 0x62fb1341,\r\n        0xcee4c6e8, 0xef20cada, 0x36774c01, 0xd07e9efe, 0x2bf11fb4,\r\n        0x95dbda4d, 0xae909198, 0xeaad8e71, 0x6b93d5a0, 0xd08ed1d0,\r\n        0xafc725e0, 0x8e3c5b2f, 0x8e7594b7, 0x8ff6e2fb, 0xf2122b64,\r\n        0x8888b812, 0x900df01c, 0x4fad5ea0, 0x688fc31c, 0xd1cff191,\r\n        0xb3a8c1ad, 0x2f2f2218, 0xbe0e1777, 0xea752dfe, 0x8b021fa1,\r\n        0xe5a0cc0f, 0xb56f74e8, 0x18acf3d6, 0xce89e299, 0xb4a84fe0,\r\n        0xfd13e0b7, 0x7cc43b81, 0xd2ada8d9, 0x165fa266, 0x80957705,\r\n        0x93cc7314, 0x211a1477, 0xe6ad2065, 0x77b5fa86, 0xc75442f5,\r\n        0xfb9d35cf, 0xebcdaf0c, 0x7b3e89a0, 0xd6411bd3, 0xae1e7e49,\r\n        0x00250e2d, 0x2071b35e, 0x226800bb, 0x57b8e0af, 0x2464369b,\r\n        0xf009b91e, 0x5563911d, 0x59dfa6aa, 0x78c14389, 0xd95a537f,\r\n        0x207d5ba2, 0x02e5b9c5, 0x83260376, 0x6295cfa9, 0x11c81968,\r\n        0x4e734a41, 0xb3472dca, 0x7b14a94a, 0x1b510052, 0x9a532915,\r\n        0xd60f573f, 0xbc9bc6e4, 0x2b60a476, 0x81e67400, 0x08ba6fb5,\r\n        0x571be91f, 0xf296ec6b, 0x2a0dd915, 0xb6636521, 0xe7b9f9b6,\r\n        0xff34052e, 0xc5855664, 0x53b02d5d, 0xa99f8fa1, 0x08ba4799,\r\n        0x6e85076a, 0x4b7a70e9, 0xb5b32944, 0xdb75092e, 0xc4192623,\r\n        0xad6ea6b0, 0x49a7df7d, 0x9cee60b8, 0x8fedb266, 0xecaa8c71,\r\n        0x699a17ff, 0x5664526c, 0xc2b19ee1, 0x193602a5, 0x75094c29,\r\n        0xa0591340, 0xe4183a3e, 0x3f54989a, 0x5b429d65, 0x6b8fe4d6,\r\n        0x99f73fd6, 0xa1d29c07, 0xefe830f5, 0x4d2d38e6, 0xf0255dc1,\r\n        0x4cdd2086, 0x8470eb26, 0x6382e9c6, 0x021ecc5e, 0x09686b3f,\r\n        0x3ebaefc9, 0x3c971814, 0x6b6a70a1, 0x687f3584, 0x52a0e286,\r\n        0xb79c5305, 0xaa500737, 0x3e07841c, 0x7fdeae5c, 0x8e7d44ec,\r\n        0x5716f2b8, 0xb03ada37, 0xf0500c0d, 0xf01c1f04, 0x0200b3ff,\r\n        0xae0cf51a, 0x3cb574b2, 0x25837a58, 0xdc0921bd, 0xd19113f9,\r\n        0x7ca92ff6, 0x94324773, 0x22f54701, 0x3ae5e581, 0x37c2dadc,\r\n        0xc8b57634, 0x9af3dda7, 0xa9446146, 0x0fd0030e, 0xecc8c73e,\r\n        0xa4751e41, 0xe238cd99, 0x3bea0e2f, 0x3280bba1, 0x183eb331,\r\n        0x4e548b38, 0x4f6db908, 0x6f420d03, 0xf60a04bf, 0x2cb81290,\r\n        0x24977c79, 0x5679b072, 0xbcaf89af, 0xde9a771f, 0xd9930810,\r\n        0xb38bae12, 0xdccf3f2e, 0x5512721f, 0x2e6b7124, 0x501adde6,\r\n        0x9f84cd87, 0x7a584718, 0x7408da17, 0xbc9f9abc, 0xe94b7d8c,\r\n        0xec7aec3a, 0xdb851dfa, 0x63094366, 0xc464c3d2, 0xef1c1847,\r\n        0x3215d908, 0xdd433b37, 0x24c2ba16, 0x12a14d43, 0x2a65c451,\r\n        0x50940002, 0x133ae4dd, 0x71dff89e, 0x10314e55, 0x81ac77d6,\r\n        0x5f11199b, 0x043556f1, 0xd7a3c76b, 0x3c11183b, 0x5924a509,\r\n        0xf28fe6ed, 0x97f1fbfa, 0x9ebabf2c, 0x1e153c6e, 0x86e34570,\r\n        0xeae96fb1, 0x860e5e0a, 0x5a3e2ab3, 0x771fe71c, 0x4e3d06fa,\r\n        0x2965dcb9, 0x99e71d0f, 0x803e89d6, 0x5266c825, 0x2e4cc978,\r\n        0x9c10b36a, 0xc6150eba, 0x94e2ea78, 0xa5fc3c53, 0x1e0a2df4,\r\n        0xf2f74ea7, 0x361d2b3d, 0x1939260f, 0x19c27960, 0x5223a708,\r\n        0xf71312b6, 0xebadfe6e, 0xeac31f66, 0xe3bc4595, 0xa67bc883,\r\n        0xb17f37d1, 0x018cff28, 0xc332ddef, 0xbe6c5aa5, 0x65582185,\r\n        0x68ab9802, 0xeecea50f, 0xdb2f953b, 0x2aef7dad, 0x5b6e2f84,\r\n        0x1521b628, 0x29076170, 0xecdd4775, 0x619f1510, 0x13cca830,\r\n        0xeb61bd96, 0x0334fe1e, 0xaa0363cf, 0xb5735c90, 0x4c70a239,\r\n        0xd59e9e0b, 0xcbaade14, 0xeecc86bc, 0x60622ca7, 0x9cab5cab,\r\n        0xb2f3846e, 0x648b1eaf, 0x19bdf0ca, 0xa02369b9, 0x655abb50,\r\n        0x40685a32, 0x3c2ab4b3, 0x319ee9d5, 0xc021b8f7, 0x9b540b19,\r\n        0x875fa099, 0x95f7997e, 0x623d7da8, 0xf837889a, 0x97e32d77,\r\n        0x11ed935f, 0x16681281, 0x0e358829, 0xc7e61fd6, 0x96dedfa1,\r\n        0x7858ba99, 0x57f584a5, 0x1b227263, 0x9b83c3ff, 0x1ac24696,\r\n        0xcdb30aeb, 0x532e3054, 0x8fd948e4, 0x6dbc3128, 0x58ebf2ef,\r\n        0x34c6ffea, 0xfe28ed61, 0xee7c3c73, 0x5d4a14d9, 0xe864b7e3,\r\n        0x42105d14, 0x203e13e0, 0x45eee2b6, 0xa3aaabea, 0xdb6c4f15,\r\n        0xfacb4fd0, 0xc742f442, 0xef6abbb5, 0x654f3b1d, 0x41cd2105,\r\n        0xd81e799e, 0x86854dc7, 0xe44b476a, 0x3d816250, 0xcf62a1f2,\r\n        0x5b8d2646, 0xfc8883a0, 0xc1c7b6a3, 0x7f1524c3, 0x69cb7492,\r\n        0x47848a0b, 0x5692b285, 0x095bbf00, 0xad19489d, 0x1462b174,\r\n        0x23820e00, 0x58428d2a, 0x0c55f5ea, 0x1dadf43e, 0x233f7061,\r\n        0x3372f092, 0x8d937e41, 0xd65fecf1, 0x6c223bdb, 0x7cde3759,\r\n        0xcbee7460, 0x4085f2a7, 0xce77326e, 0xa6078084, 0x19f8509e,\r\n        0xe8efd855, 0x61d99735, 0xa969a7aa, 0xc50c06c2, 0x5a04abfc,\r\n        0x800bcadc, 0x9e447a2e, 0xc3453484, 0xfdd56705, 0x0e1e9ec9,\r\n        0xdb73dbd3, 0x105588cd, 0x675fda79, 0xe3674340, 0xc5c43465,\r\n        0x713e38d8, 0x3d28f89e, 0xf16dff20, 0x153e21e7, 0x8fb03d4a,\r\n        0xe6e39f2b, 0xdb83adf7, 0xe93d5a68, 0x948140f7, 0xf64c261c,\r\n        0x94692934, 0x411520f7, 0x7602d4f7, 0xbcf46b2e, 0xd4a20068,\r\n        0xd4082471, 0x3320f46a, 0x43b7d4b7, 0x500061af, 0x1e39f62e,\r\n        0x97244546, 0x14214f74, 0xbf8b8840, 0x4d95fc1d, 0x96b591af,\r\n        0x70f4ddd3, 0x66a02f45, 0xbfbc09ec, 0x03bd9785, 0x7fac6dd0,\r\n        0x31cb8504, 0x96eb27b3, 0x55fd3941, 0xda2547e6, 0xabca0a9a,\r\n        0x28507825, 0x530429f4, 0x0a2c86da, 0xe9b66dfb, 0x68dc1462,\r\n        0xd7486900, 0x680ec0a4, 0x27a18dee, 0x4f3ffea2, 0xe887ad8c,\r\n        0xb58ce006, 0x7af4d6b6, 0xaace1e7c, 0xd3375fec, 0xce78a399,\r\n        0x406b2a42, 0x20fe9e35, 0xd9f385b9, 0xee39d7ab, 0x3b124e8b,\r\n        0x1dc9faf7, 0x4b6d1856, 0x26a36631, 0xeae397b2, 0x3a6efa74,\r\n        0xdd5b4332, 0x6841e7f7, 0xca7820fb, 0xfb0af54e, 0xd8feb397,\r\n        0x454056ac, 0xba489527, 0x55533a3a, 0x20838d87, 0xfe6ba9b7,\r\n        0xd096954b, 0x55a867bc, 0xa1159a58, 0xcca92963, 0x99e1db33,\r\n        0xa62a4a56, 0x3f3125f9, 0x5ef47e1c, 0x9029317c, 0xfdf8e802,\r\n        0x04272f70, 0x80bb155c, 0x05282ce3, 0x95c11548, 0xe4c66d22,\r\n        0x48c1133f, 0xc70f86dc, 0x07f9c9ee, 0x41041f0f, 0x404779a4,\r\n        0x5d886e17, 0x325f51eb, 0xd59bc0d1, 0xf2bcc18f, 0x41113564,\r\n        0x257b7834, 0x602a9c60, 0xdff8e8a3, 0x1f636c1b, 0x0e12b4c2,\r\n        0x02e1329e, 0xaf664fd1, 0xcad18115, 0x6b2395e0, 0x333e92e1,\r\n        0x3b240b62, 0xeebeb922, 0x85b2a20e, 0xe6ba0d99, 0xde720c8c,\r\n        0x2da2f728, 0xd0127845, 0x95b794fd, 0x647d0862, 0xe7ccf5f0,\r\n        0x5449a36f, 0x877d48fa, 0xc39dfd27, 0xf33e8d1e, 0x0a476341,\r\n        0x992eff74, 0x3a6f6eab, 0xf4f8fd37, 0xa812dc60, 0xa1ebddf8,\r\n        0x991be14c, 0xdb6e6b0d, 0xc67b5510, 0x6d672c37, 0x2765d43b,\r\n        0xdcd0e804, 0xf1290dc7, 0xcc00ffa3, 0xb5390f92, 0x690fed0b,\r\n        0x667b9ffb, 0xcedb7d9c, 0xa091cf0b, 0xd9155ea3, 0xbb132f88,\r\n        0x515bad24, 0x7b9479bf, 0x763bd6eb, 0x37392eb3, 0xcc115979,\r\n        0x8026e297, 0xf42e312d, 0x6842ada7, 0xc66a2b3b, 0x12754ccc,\r\n        0x782ef11c, 0x6a124237, 0xb79251e7, 0x06a1bbe6, 0x4bfb6350,\r\n        0x1a6b1018, 0x11caedfa, 0x3d25bdd8, 0xe2e1c3c9, 0x44421659,\r\n        0x0a121386, 0xd90cec6e, 0xd5abea2a, 0x64af674e, 0xda86a85f,\r\n        0xbebfe988, 0x64e4c3fe, 0x9dbc8057, 0xf0f7c086, 0x60787bf8,\r\n        0x6003604d, 0xd1fd8346, 0xf6381fb0, 0x7745ae04, 0xd736fccc,\r\n        0x83426b33, 0xf01eab71, 0xb0804187, 0x3c005e5f, 0x77a057be,\r\n        0xbde8ae24, 0x55464299, 0xbf582e61, 0x4e58f48f, 0xf2ddfda2,\r\n        0xf474ef38, 0x8789bdc2, 0x5366f9c3, 0xc8b38e74, 0xb475f255,\r\n        0x46fcd9b9, 0x7aeb2661, 0x8b1ddf84, 0x846a0e79, 0x915f95e2,\r\n        0x466e598e, 0x20b45770, 0x8cd55591, 0xc902de4c, 0xb90bace1,\r\n        0xbb8205d0, 0x11a86248, 0x7574a99e, 0xb77f19b6, 0xe0a9dc09,\r\n        0x662d09a1, 0xc4324633, 0xe85a1f02, 0x09f0be8c, 0x4a99a025,\r\n        0x1d6efe10, 0x1ab93d1d, 0x0ba5a4df, 0xa186f20f, 0x2868f169,\r\n        0xdcb7da83, 0x573906fe, 0xa1e2ce9b, 0x4fcd7f52, 0x50115e01,\r\n        0xa70683fa, 0xa002b5c4, 0x0de6d027, 0x9af88c27, 0x773f8641,\r\n        0xc3604c06, 0x61a806b5, 0xf0177a28, 0xc0f586e0, 0x006058aa,\r\n        0x30dc7d62, 0x11e69ed7, 0x2338ea63, 0x53c2dd94, 0xc2c21634,\r\n        0xbbcbee56, 0x90bcb6de, 0xebfc7da1, 0xce591d76, 0x6f05e409,\r\n        0x4b7c0188, 0x39720a3d, 0x7c927c24, 0x86e3725f, 0x724d9db9,\r\n        0x1ac15bb4, 0xd39eb8fc, 0xed545578, 0x08fca5b5, 0xd83d7cd3,\r\n        0x4dad0fc4, 0x1e50ef5e, 0xb161e6f8, 0xa28514d9, 0x6c51133c,\r\n        0x6fd5c7e7, 0x56e14ec4, 0x362abfce, 0xddc6c837, 0xd79a3234,\r\n        0x92638212, 0x670efa8e, 0x406000e0, 0x3a39ce37, 0xd3faf5cf,\r\n        0xabc27737, 0x5ac52d1b, 0x5cb0679e, 0x4fa33742, 0xd3822740,\r\n        0x99bc9bbe, 0xd5118e9d, 0xbf0f7315, 0xd62d1c7e, 0xc700c47b,\r\n        0xb78c1b6b, 0x21a19045, 0xb26eb1be, 0x6a366eb4, 0x5748ab2f,\r\n        0xbc946e79, 0xc6a376d2, 0x6549c2c8, 0x530ff8ee, 0x468dde7d,\r\n        0xd5730a1d, 0x4cd04dc6, 0x2939bbdb, 0xa9ba4650, 0xac9526e8,\r\n        0xbe5ee304, 0xa1fad5f0, 0x6a2d519a, 0x63ef8ce2, 0x9a86ee22,\r\n        0xc089c2b8, 0x43242ef6, 0xa51e03aa, 0x9cf2d0a4, 0x83c061ba,\r\n        0x9be96a4d, 0x8fe51550, 0xba645bd6, 0x2826a2f9, 0xa73a3ae1,\r\n        0x4ba99586, 0xef5562e9, 0xc72fefd3, 0xf752f7da, 0x3f046f69,\r\n        0x77fa0a59, 0x80e4a915, 0x87b08601, 0x9b09e6ad, 0x3b3ee593,\r\n        0xe990fd5a, 0x9e34d797, 0x2cf0b7d9, 0x022b8b51, 0x96d5ac3a,\r\n        0x017da67d, 0xd1cf3ed6, 0x7c7d2d28, 0x1f9f25cf, 0xadf2b89b,\r\n        0x5ad6b472, 0x5a88f54c, 0xe029ac71, 0xe019a5e6, 0x47b0acfd,\r\n        0xed93fa9b, 0xe8d3c48d, 0x283b57cc, 0xf8d56629, 0x79132e28,\r\n        0x785f0191, 0xed756055, 0xf7960e44, 0xe3d35e8c, 0x15056dd4,\r\n        0x88f46dba, 0x03a16125, 0x0564f0bd, 0xc3eb9e15, 0x3c9057a2,\r\n        0x97271aec, 0xa93a072a, 0x1b3f6d9b, 0x1e6321f5, 0xf59c66fb,\r\n        0x26dcf319, 0x7533d928, 0xb155fdf5, 0x03563482, 0x8aba3cbb,\r\n        0x28517711, 0xc20ad9f8, 0xabcc5167, 0xccad925f, 0x4de81751,\r\n        0x3830dc8e, 0x379d5862, 0x9320f991, 0xea7a90c2, 0xfb3e7bce,\r\n        0x5121ce64, 0x774fbe32, 0xa8b6e37e, 0xc3293d46, 0x48de5369,\r\n        0x6413e680, 0xa2ae0810, 0xdd6db224, 0x69852dfd, 0x09072166,\r\n        0xb39a460a, 0x6445c0dd, 0x586cdecf, 0x1c20c8ae, 0x5bbef7dd,\r\n        0x1b588d40, 0xccd2017f, 0x6bb4e3bb, 0xdda26a7e, 0x3a59ff45,\r\n        0x3e350a44, 0xbcb4cdd5, 0x72eacea8, 0xfa6484bb, 0x8d6612ae,\r\n        0xbf3c6f47, 0xd29be463, 0x542f5d9e, 0xaec2771b, 0xf64e6370,\r\n        0x740e0d8d, 0xe75b1357, 0xf8721671, 0xaf537d5d, 0x4040cb08,\r\n        0x4eb4e2cc, 0x34d2466a, 0x0115af84, 0xe1b00428, 0x95983a1d,\r\n        0x06b89fb4, 0xce6ea048, 0x6f3f3b82, 0x3520ab82, 0x011a1d4b,\r\n        0x277227f8, 0x611560b1, 0xe7933fdc, 0xbb3a792b, 0x344525bd,\r\n        0xa08839e1, 0x51ce794b, 0x2f32c9b7, 0xa01fbac9, 0xe01cc87e,\r\n        0xbcc7d1f6, 0xcf0111c3, 0xa1e8aac7, 0x1a908749, 0xd44fbd9a,\r\n        0xd0dadecb, 0xd50ada38, 0x0339c32a, 0xc6913667, 0x8df9317c,\r\n        0xe0b12b4f, 0xf79e59b7, 0x43f5bb3a, 0xf2d519ff, 0x27d9459c,\r\n        0xbf97222c, 0x15e6fc2a, 0x0f91fc71, 0x9b941525, 0xfae59361,\r\n        0xceb69ceb, 0xc2a86459, 0x12baa8d1, 0xb6c1075e, 0xe3056a0c,\r\n        0x10d25065, 0xcb03a442, 0xe0ec6e0e, 0x1698db3b, 0x4c98a0be,\r\n        0x3278e964, 0x9f1f9532, 0xe0d392df, 0xd3a0342b, 0x8971f21e,\r\n        0x1b0a7441, 0x4ba3348c, 0xc5be7120, 0xc37632d8, 0xdf359f8d,\r\n        0x9b992f2e, 0xe60b6f47, 0x0fe3f11d, 0xe54cda54, 0x1edad891,\r\n        0xce6279cf, 0xcd3e7e6f, 0x1618b166, 0xfd2c1d05, 0x848fd2c5,\r\n        0xf6fb2299, 0xf523f357, 0xa6327623, 0x93a83531, 0x56cccd02,\r\n        0xacf08162, 0x5a75ebb5, 0x6e163697, 0x88d273cc, 0xde966292,\r\n        0x81b949d0, 0x4c50901b, 0x71c65614, 0xe6c6c7bd, 0x327a140a,\r\n        0x45e1d006, 0xc3f27b9a, 0xc9aa53fd, 0x62a80f00, 0xbb25bfe2,\r\n        0x35bdd2f6, 0x71126905, 0xb2040222, 0xb6cbcf7c, 0xcd769c2b,\r\n        0x53113ec0, 0x1640e3d3, 0x38abbd60, 0x2547adf0, 0xba38209c,\r\n        0xf746ce76, 0x77afa1c5, 0x20756060, 0x85cbfe4e, 0x8ae88dd8,\r\n        0x7aaaf9b0, 0x4cf9aa7e, 0x1948c25c, 0x02fb8a8c, 0x01c36ae4,\r\n        0xd6ebe1f9, 0x90d4f869, 0xa65cdea0, 0x3f09252d, 0xc208e69f,\r\n        0xb74e6132, 0xce77e25b, 0x578fdfe3, 0x3ac372e6\r\n    ];\r\n\r\n    /**\r\n     * @type {Array.<number>}\r\n     * @const\r\n     * @inner\r\n     */\r\n    var C_ORIG = [\r\n        0x4f727068, 0x65616e42, 0x65686f6c, 0x64657253, 0x63727944,\r\n        0x6f756274\r\n    ];\r\n\r\n    /**\r\n     * @param {Array.<number>} lr\r\n     * @param {number} off\r\n     * @param {Array.<number>} P\r\n     * @param {Array.<number>} S\r\n     * @returns {Array.<number>}\r\n     * @inner\r\n     */\r\n    function _encipher(lr, off, P, S) { // This is our bottleneck: 1714/1905 ticks / 90% - see profile.txt\r\n        var n,\r\n            l = lr[off],\r\n            r = lr[off + 1];\r\n\r\n        l ^= P[0];\r\n\r\n        /*\r\n        for (var i=0, k=BLOWFISH_NUM_ROUNDS-2; i<=k;)\r\n            // Feistel substitution on left word\r\n            n  = S[l >>> 24],\r\n            n += S[0x100 | ((l >> 16) & 0xff)],\r\n            n ^= S[0x200 | ((l >> 8) & 0xff)],\r\n            n += S[0x300 | (l & 0xff)],\r\n            r ^= n ^ P[++i],\r\n            // Feistel substitution on right word\r\n            n  = S[r >>> 24],\r\n            n += S[0x100 | ((r >> 16) & 0xff)],\r\n            n ^= S[0x200 | ((r >> 8) & 0xff)],\r\n            n += S[0x300 | (r & 0xff)],\r\n            l ^= n ^ P[++i];\r\n        */\r\n\r\n        //The following is an unrolled version of the above loop.\r\n        //Iteration 0\r\n        n  = S[l >>> 24];\r\n        n += S[0x100 | ((l >> 16) & 0xff)];\r\n        n ^= S[0x200 | ((l >> 8) & 0xff)];\r\n        n += S[0x300 | (l & 0xff)];\r\n        r ^= n ^ P[1];\r\n        n  = S[r >>> 24];\r\n        n += S[0x100 | ((r >> 16) & 0xff)];\r\n        n ^= S[0x200 | ((r >> 8) & 0xff)];\r\n        n += S[0x300 | (r & 0xff)];\r\n        l ^= n ^ P[2];\r\n        //Iteration 1\r\n        n  = S[l >>> 24];\r\n        n += S[0x100 | ((l >> 16) & 0xff)];\r\n        n ^= S[0x200 | ((l >> 8) & 0xff)];\r\n        n += S[0x300 | (l & 0xff)];\r\n        r ^= n ^ P[3];\r\n        n  = S[r >>> 24];\r\n        n += S[0x100 | ((r >> 16) & 0xff)];\r\n        n ^= S[0x200 | ((r >> 8) & 0xff)];\r\n        n += S[0x300 | (r & 0xff)];\r\n        l ^= n ^ P[4];\r\n        //Iteration 2\r\n        n  = S[l >>> 24];\r\n        n += S[0x100 | ((l >> 16) & 0xff)];\r\n        n ^= S[0x200 | ((l >> 8) & 0xff)];\r\n        n += S[0x300 | (l & 0xff)];\r\n        r ^= n ^ P[5];\r\n        n  = S[r >>> 24];\r\n        n += S[0x100 | ((r >> 16) & 0xff)];\r\n        n ^= S[0x200 | ((r >> 8) & 0xff)];\r\n        n += S[0x300 | (r & 0xff)];\r\n        l ^= n ^ P[6];\r\n        //Iteration 3\r\n        n  = S[l >>> 24];\r\n        n += S[0x100 | ((l >> 16) & 0xff)];\r\n        n ^= S[0x200 | ((l >> 8) & 0xff)];\r\n        n += S[0x300 | (l & 0xff)];\r\n        r ^= n ^ P[7];\r\n        n  = S[r >>> 24];\r\n        n += S[0x100 | ((r >> 16) & 0xff)];\r\n        n ^= S[0x200 | ((r >> 8) & 0xff)];\r\n        n += S[0x300 | (r & 0xff)];\r\n        l ^= n ^ P[8];\r\n        //Iteration 4\r\n        n  = S[l >>> 24];\r\n        n += S[0x100 | ((l >> 16) & 0xff)];\r\n        n ^= S[0x200 | ((l >> 8) & 0xff)];\r\n        n += S[0x300 | (l & 0xff)];\r\n        r ^= n ^ P[9];\r\n        n  = S[r >>> 24];\r\n        n += S[0x100 | ((r >> 16) & 0xff)];\r\n        n ^= S[0x200 | ((r >> 8) & 0xff)];\r\n        n += S[0x300 | (r & 0xff)];\r\n        l ^= n ^ P[10];\r\n        //Iteration 5\r\n        n  = S[l >>> 24];\r\n        n += S[0x100 | ((l >> 16) & 0xff)];\r\n        n ^= S[0x200 | ((l >> 8) & 0xff)];\r\n        n += S[0x300 | (l & 0xff)];\r\n        r ^= n ^ P[11];\r\n        n  = S[r >>> 24];\r\n        n += S[0x100 | ((r >> 16) & 0xff)];\r\n        n ^= S[0x200 | ((r >> 8) & 0xff)];\r\n        n += S[0x300 | (r & 0xff)];\r\n        l ^= n ^ P[12];\r\n        //Iteration 6\r\n        n  = S[l >>> 24];\r\n        n += S[0x100 | ((l >> 16) & 0xff)];\r\n        n ^= S[0x200 | ((l >> 8) & 0xff)];\r\n        n += S[0x300 | (l & 0xff)];\r\n        r ^= n ^ P[13];\r\n        n  = S[r >>> 24];\r\n        n += S[0x100 | ((r >> 16) & 0xff)];\r\n        n ^= S[0x200 | ((r >> 8) & 0xff)];\r\n        n += S[0x300 | (r & 0xff)];\r\n        l ^= n ^ P[14];\r\n        //Iteration 7\r\n        n  = S[l >>> 24];\r\n        n += S[0x100 | ((l >> 16) & 0xff)];\r\n        n ^= S[0x200 | ((l >> 8) & 0xff)];\r\n        n += S[0x300 | (l & 0xff)];\r\n        r ^= n ^ P[15];\r\n        n  = S[r >>> 24];\r\n        n += S[0x100 | ((r >> 16) & 0xff)];\r\n        n ^= S[0x200 | ((r >> 8) & 0xff)];\r\n        n += S[0x300 | (r & 0xff)];\r\n        l ^= n ^ P[16];\r\n\r\n        lr[off] = r ^ P[BLOWFISH_NUM_ROUNDS + 1];\r\n        lr[off + 1] = l;\r\n        return lr;\r\n    }\r\n\r\n    /**\r\n     * @param {Array.<number>} data\r\n     * @param {number} offp\r\n     * @returns {{key: number, offp: number}}\r\n     * @inner\r\n     */\r\n    function _streamtoword(data, offp) {\r\n        for (var i = 0, word = 0; i < 4; ++i)\r\n            word = (word << 8) | (data[offp] & 0xff),\r\n            offp = (offp + 1) % data.length;\r\n        return { key: word, offp: offp };\r\n    }\r\n\r\n    /**\r\n     * @param {Array.<number>} key\r\n     * @param {Array.<number>} P\r\n     * @param {Array.<number>} S\r\n     * @inner\r\n     */\r\n    function _key(key, P, S) {\r\n        var offset = 0,\r\n            lr = [0, 0],\r\n            plen = P.length,\r\n            slen = S.length,\r\n            sw;\r\n        for (var i = 0; i < plen; i++)\r\n            sw = _streamtoword(key, offset),\r\n            offset = sw.offp,\r\n            P[i] = P[i] ^ sw.key;\r\n        for (i = 0; i < plen; i += 2)\r\n            lr = _encipher(lr, 0, P, S),\r\n            P[i] = lr[0],\r\n            P[i + 1] = lr[1];\r\n        for (i = 0; i < slen; i += 2)\r\n            lr = _encipher(lr, 0, P, S),\r\n            S[i] = lr[0],\r\n            S[i + 1] = lr[1];\r\n    }\r\n\r\n    /**\r\n     * Expensive key schedule Blowfish.\r\n     * @param {Array.<number>} data\r\n     * @param {Array.<number>} key\r\n     * @param {Array.<number>} P\r\n     * @param {Array.<number>} S\r\n     * @inner\r\n     */\r\n    function _ekskey(data, key, P, S) {\r\n        var offp = 0,\r\n            lr = [0, 0],\r\n            plen = P.length,\r\n            slen = S.length,\r\n            sw;\r\n        for (var i = 0; i < plen; i++)\r\n            sw = _streamtoword(key, offp),\r\n            offp = sw.offp,\r\n            P[i] = P[i] ^ sw.key;\r\n        offp = 0;\r\n        for (i = 0; i < plen; i += 2)\r\n            sw = _streamtoword(data, offp),\r\n            offp = sw.offp,\r\n            lr[0] ^= sw.key,\r\n            sw = _streamtoword(data, offp),\r\n            offp = sw.offp,\r\n            lr[1] ^= sw.key,\r\n            lr = _encipher(lr, 0, P, S),\r\n            P[i] = lr[0],\r\n            P[i + 1] = lr[1];\r\n        for (i = 0; i < slen; i += 2)\r\n            sw = _streamtoword(data, offp),\r\n            offp = sw.offp,\r\n            lr[0] ^= sw.key,\r\n            sw = _streamtoword(data, offp),\r\n            offp = sw.offp,\r\n            lr[1] ^= sw.key,\r\n            lr = _encipher(lr, 0, P, S),\r\n            S[i] = lr[0],\r\n            S[i + 1] = lr[1];\r\n    }\r\n\r\n    /**\r\n     * Internaly crypts a string.\r\n     * @param {Array.<number>} b Bytes to crypt\r\n     * @param {Array.<number>} salt Salt bytes to use\r\n     * @param {number} rounds Number of rounds\r\n     * @param {function(Error, Array.<number>=)=} callback Callback receiving the error, if any, and the resulting bytes. If\r\n     *  omitted, the operation will be performed synchronously.\r\n     *  @param {function(number)=} progressCallback Callback called with the current progress\r\n     * @returns {!Array.<number>|undefined} Resulting bytes if callback has been omitted, otherwise `undefined`\r\n     * @inner\r\n     */\r\n    function _crypt(b, salt, rounds, callback, progressCallback) {\r\n        var cdata = C_ORIG.slice(),\r\n            clen = cdata.length,\r\n            err;\r\n\r\n        // Validate\r\n        if (rounds < 4 || rounds > 31) {\r\n            err = Error(\"Illegal number of rounds (4-31): \"+rounds);\r\n            if (callback) {\r\n                nextTick(callback.bind(this, err));\r\n                return;\r\n            } else\r\n                throw err;\r\n        }\r\n        if (salt.length !== BCRYPT_SALT_LEN) {\r\n            err =Error(\"Illegal salt length: \"+salt.length+\" != \"+BCRYPT_SALT_LEN);\r\n            if (callback) {\r\n                nextTick(callback.bind(this, err));\r\n                return;\r\n            } else\r\n                throw err;\r\n        }\r\n        rounds = (1 << rounds) >>> 0;\r\n\r\n        var P, S, i = 0, j;\r\n\r\n        //Use typed arrays when available - huge speedup!\r\n        if (Int32Array) {\r\n            P = new Int32Array(P_ORIG);\r\n            S = new Int32Array(S_ORIG);\r\n        } else {\r\n            P = P_ORIG.slice();\r\n            S = S_ORIG.slice();\r\n        }\r\n\r\n        _ekskey(salt, b, P, S);\r\n\r\n        /**\r\n         * Calcualtes the next round.\r\n         * @returns {Array.<number>|undefined} Resulting array if callback has been omitted, otherwise `undefined`\r\n         * @inner\r\n         */\r\n        function next() {\r\n            if (progressCallback)\r\n                progressCallback(i / rounds);\r\n            if (i < rounds) {\r\n                var start = Date.now();\r\n                for (; i < rounds;) {\r\n                    i = i + 1;\r\n                    _key(b, P, S);\r\n                    _key(salt, P, S);\r\n                    if (Date.now() - start > MAX_EXECUTION_TIME)\r\n                        break;\r\n                }\r\n            } else {\r\n                for (i = 0; i < 64; i++)\r\n                    for (j = 0; j < (clen >> 1); j++)\r\n                        _encipher(cdata, j << 1, P, S);\r\n                var ret = [];\r\n                for (i = 0; i < clen; i++)\r\n                    ret.push(((cdata[i] >> 24) & 0xff) >>> 0),\r\n                    ret.push(((cdata[i] >> 16) & 0xff) >>> 0),\r\n                    ret.push(((cdata[i] >> 8) & 0xff) >>> 0),\r\n                    ret.push((cdata[i] & 0xff) >>> 0);\r\n                if (callback) {\r\n                    callback(null, ret);\r\n                    return;\r\n                } else\r\n                    return ret;\r\n            }\r\n            if (callback)\r\n                nextTick(next);\r\n        }\r\n\r\n        // Async\r\n        if (typeof callback !== 'undefined') {\r\n            next();\r\n\r\n            // Sync\r\n        } else {\r\n            var res;\r\n            while (true)\r\n                if (typeof(res = next()) !== 'undefined')\r\n                    return res || [];\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Internally hashes a string.\r\n     * @param {string} s String to hash\r\n     * @param {?string} salt Salt to use, actually never null\r\n     * @param {function(Error, string=)=} callback Callback receiving the error, if any, and the resulting hash. If omitted,\r\n     *  hashing is perormed synchronously.\r\n     *  @param {function(number)=} progressCallback Callback called with the current progress\r\n     * @returns {string|undefined} Resulting hash if callback has been omitted, otherwise `undefined`\r\n     * @inner\r\n     */\r\n    function _hash(s, salt, callback, progressCallback) {\r\n        var err;\r\n        if (typeof s !== 'string' || typeof salt !== 'string') {\r\n            err = Error(\"Invalid string / salt: Not a string\");\r\n            if (callback) {\r\n                nextTick(callback.bind(this, err));\r\n                return;\r\n            }\r\n            else\r\n                throw err;\r\n        }\r\n\r\n        // Validate the salt\r\n        var minor, offset;\r\n        if (salt.charAt(0) !== '$' || salt.charAt(1) !== '2') {\r\n            err = Error(\"Invalid salt version: \"+salt.substring(0,2));\r\n            if (callback) {\r\n                nextTick(callback.bind(this, err));\r\n                return;\r\n            }\r\n            else\r\n                throw err;\r\n        }\r\n        if (salt.charAt(2) === '$')\r\n            minor = String.fromCharCode(0),\r\n            offset = 3;\r\n        else {\r\n            minor = salt.charAt(2);\r\n            if ((minor !== 'a' && minor !== 'b' && minor !== 'y') || salt.charAt(3) !== '$') {\r\n                err = Error(\"Invalid salt revision: \"+salt.substring(2,4));\r\n                if (callback) {\r\n                    nextTick(callback.bind(this, err));\r\n                    return;\r\n                } else\r\n                    throw err;\r\n            }\r\n            offset = 4;\r\n        }\r\n\r\n        // Extract number of rounds\r\n        if (salt.charAt(offset + 2) > '$') {\r\n            err = Error(\"Missing salt rounds\");\r\n            if (callback) {\r\n                nextTick(callback.bind(this, err));\r\n                return;\r\n            } else\r\n                throw err;\r\n        }\r\n        var r1 = parseInt(salt.substring(offset, offset + 1), 10) * 10,\r\n            r2 = parseInt(salt.substring(offset + 1, offset + 2), 10),\r\n            rounds = r1 + r2,\r\n            real_salt = salt.substring(offset + 3, offset + 25);\r\n        s += minor >= 'a' ? \"\\x00\" : \"\";\r\n\r\n        var passwordb = stringToBytes(s),\r\n            saltb = base64_decode(real_salt, BCRYPT_SALT_LEN);\r\n\r\n        /**\r\n         * Finishes hashing.\r\n         * @param {Array.<number>} bytes Byte array\r\n         * @returns {string}\r\n         * @inner\r\n         */\r\n        function finish(bytes) {\r\n            var res = [];\r\n            res.push(\"$2\");\r\n            if (minor >= 'a')\r\n                res.push(minor);\r\n            res.push(\"$\");\r\n            if (rounds < 10)\r\n                res.push(\"0\");\r\n            res.push(rounds.toString());\r\n            res.push(\"$\");\r\n            res.push(base64_encode(saltb, saltb.length));\r\n            res.push(base64_encode(bytes, C_ORIG.length * 4 - 1));\r\n            return res.join('');\r\n        }\r\n\r\n        // Sync\r\n        if (typeof callback == 'undefined')\r\n            return finish(_crypt(passwordb, saltb, rounds));\r\n\r\n        // Async\r\n        else {\r\n            _crypt(passwordb, saltb, rounds, function(err, bytes) {\r\n                if (err)\r\n                    callback(err, null);\r\n                else\r\n                    callback(null, finish(bytes));\r\n            }, progressCallback);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Encodes a byte array to base64 with up to len bytes of input, using the custom bcrypt alphabet.\r\n     * @function\r\n     * @param {!Array.<number>} b Byte array\r\n     * @param {number} len Maximum input length\r\n     * @returns {string}\r\n     * @expose\r\n     */\r\n    bcrypt.encodeBase64 = base64_encode;\r\n\r\n    /**\r\n     * Decodes a base64 encoded string to up to len bytes of output, using the custom bcrypt alphabet.\r\n     * @function\r\n     * @param {string} s String to decode\r\n     * @param {number} len Maximum output length\r\n     * @returns {!Array.<number>}\r\n     * @expose\r\n     */\r\n    bcrypt.decodeBase64 = base64_decode;\r\n\r\n    return bcrypt;\r\n}));\r\n", "// This loads all middlewares exposed on the middleware object and then starts\n// the invocation chain. The big idea is that we can add these to the middleware\n// export dynamically through wrangler, or we can potentially let users directly\n// add them as a sort of \"plugin\" system.\n\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"M:\\\\DashBoardTO\\\\TecRail\\\\.wrangler\\\\tmp\\\\bundle-L0oFto\\\\middleware-insertion-facade.js\";\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"M:\\\\DashBoardTO\\\\TecRail\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\common.ts\";\nimport type { WorkerEntrypointConstructor } from \"M:\\\\DashBoardTO\\\\TecRail\\\\.wrangler\\\\tmp\\\\bundle-L0oFto\\\\middleware-insertion-facade.js\";\n\n// Preserve all the exports from the worker\nexport * from \"M:\\\\DashBoardTO\\\\TecRail\\\\.wrangler\\\\tmp\\\\bundle-L0oFto\\\\middleware-insertion-facade.js\";\n\nclass __Facade_ScheduledController__ implements ScheduledController {\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\n\n\tconstructor(\n\t\treadonly scheduledTime: number,\n\t\treadonly cron: string,\n\t\tnoRetry: ScheduledController[\"noRetry\"]\n\t) {\n\t\tthis.#noRetry = noRetry;\n\t}\n\n\tnoRetry() {\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\n\t\t\tthrow new TypeError(\"Illegal invocation\");\n\t\t}\n\t\t// Need to call native method immediately in case uncaught error thrown\n\t\tthis.#noRetry();\n\t}\n}\n\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn worker;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\n\t\trequest,\n\t\tenv,\n\t\tctx\n\t) {\n\t\tif (worker.fetch === undefined) {\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\n\t\t}\n\t\treturn worker.fetch(request, env, ctx);\n\t};\n\n\treturn {\n\t\t...worker,\n\t\tfetch(request, env, ctx) {\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\t\tDate.now(),\n\t\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t\t() => {}\n\t\t\t\t\t);\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\n\t\t},\n\t};\n}\n\nfunction wrapWorkerEntrypoint(\n\tklass: WorkerEntrypointConstructor\n): WorkerEntrypointConstructor {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn klass;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\t// `extend`ing `klass` here so other RPC methods remain callable\n\treturn class extends klass {\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\n\t\t\trequest,\n\t\t\tenv,\n\t\t\tctx\n\t\t) => {\n\t\t\tthis.env = env;\n\t\t\tthis.ctx = ctx;\n\t\t\tif (super.fetch === undefined) {\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\n\t\t\t}\n\t\t\treturn super.fetch(request);\n\t\t};\n\n\t\t#dispatcher: Dispatcher = (type, init) => {\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\tDate.now(),\n\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t() => {}\n\t\t\t\t);\n\t\t\t\treturn super.scheduled(controller);\n\t\t\t}\n\t\t};\n\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\n\t\t\treturn __facade_invoke__(\n\t\t\t\trequest,\n\t\t\t\tthis.env,\n\t\t\t\tthis.ctx,\n\t\t\t\tthis.#dispatcher,\n\t\t\t\tthis.#fetchDispatcher\n\t\t\t);\n\t\t}\n\t};\n}\n\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\nif (typeof ENTRY === \"object\") {\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\n} else if (typeof ENTRY === \"function\") {\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\n}\nexport default WRAPPED_ENTRY;\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"M:\\\\DashBoardTO\\\\TecRail\\\\src\\\\index.ts\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"M:\\\\DashBoardTO\\\\TecRail\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"M:\\\\DashBoardTO\\\\TecRail\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"M:\\\\DashBoardTO\\\\TecRail\\\\src\\\\index.ts\";\n\t\t\t\tconst MIDDLEWARE_TEST_INJECT = \"__INJECT_FOR_TESTING_WRANGLER_MIDDLEWARE__\";\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "\uFEFFimport bcrypt from 'bcryptjs'\r\n\r\nexport interface Env {\r\n  DB: D1Database\r\n  JWT_SECRET: string\r\n  JWT_EXP_MINUTES?: string\r\n  AUTH_MAX_ATTEMPTS?: string\r\n  AUTH_LOCK_MINUTES?: string\r\n  CORS_ORIGIN?: string\r\n}\r\n\r\ntype AuthPayload = {\r\n  user_id: string\r\n  company_id: string\r\n  nome: string\r\n  cargo: string | null\r\n  equipe: string | null\r\n  session_id: string\r\n  exp: number\r\n}\r\n\r\ntype PermissionAction = 'leitura' | 'criacao' | 'edicao' | 'exclusao'\r\n\r\ntype CompanyRow = {\r\n  id: string\r\n  nome: string\r\n  status: string\r\n}\r\n\r\ntype UserRow = {\n  id: string\n  company_id: string\n  nome: string\n  cs: string\n  email: string\n  escala?: string\n  profile_id?: string | null\n  profile_name?: string | null\n  cargo: string | null\n  coordenacao: string | null\n  equipe: string | null\n  equipe_aditiva?: string | null\r\n  status: string\r\n  created_at?: string\r\n  updated_at?: string\r\n}\r\n\r\ntype UserWithCompanyRow = UserRow & {\r\n  company_status: string | null\r\n}\r\n\r\ntype UserAuthRow = {\r\n  user_id: string\r\n  password_hash: string\r\n  last_login_at: string | null\r\n  failed_attempts: number\r\n  locked_until: string | null\r\n}\r\n\r\ntype UserHistoryRow = {\r\n  id: string\r\n  company_id: string\r\n  user_id: string\r\n  changed_by_user_id: string | null\r\n  changed_by_name: string | null\r\n  changes: string\r\n  created_at: string\r\n}\r\n\r\ntype UserSessionRow = {\r\n  id: string\r\n  company_id: string\r\n  user_id: string\r\n  ip: string | null\r\n  created_at: string\r\n  revoked_at: string | null\r\n}\r\n\r\ntype ProfileRow = {\r\n  id: string\r\n  company_id: string\r\n  name: string\r\n  status: string\r\n  created_at: string\r\n  updated_at: string\r\n}\r\n\r\ntype ProfilePermissionRow = {\r\n  profile_id: string\r\n  screen_id: string\r\n  leitura: number\r\n  criacao: number\r\n  edicao: number\r\n  exclusao: number\r\n}\r\n\r\ntype PermissionRow = {\r\n  screen_id: string\r\n  leitura: number\r\n  criacao: number\r\n  edicao: number\r\n  exclusao: number\r\n}\r\n\r\ntype PermissionCheckRow = {\r\n  profile_status: string | null\r\n  leitura: number | null\r\n  criacao: number | null\r\n  edicao: number | null\r\n  exclusao: number | null\r\n}\r\n\r\ntype AtivoRow = {\n  id: string\n  company_id: string\n  ATIVO_EMPRESA: string\n  ATIVO_CODPE: string\n  ATIVO_DESCRITIVO_OS: string\n  ATIVO_STATUS: string\n  ATIVO_COORDENACAO: string\n  ATIVO_EQUIPE: string\n  ATIVO_MONITORADOS: string\n  ATIVO_SIGLA: string\n  ATIVO_CICLO: string\n  ATIVO_CONTADOR: number\n  CONTADOR_CICLO: string\n  ATIVO_TOLERANCIA: string\n  ATIVO_CLASSE: string\n  ATIVO_GRUPO: string\n  ATIVO_OEA: string\n  ATIVO_TMM: string\n  ATIVO_LATITUDE: string | null\n  ATIVO_LONGITUDE: string | null\n  ATIVO_ULTIMA_MANUT: string | null\n  ATIVO_MODELO_POSTE: string | null\n  ATIVO_MODELO_RELE: string | null\n  ATIVO_MODELO_DDS: string | null\n  ATIVO_DDS_SERIAL: string | null\n  ATIVO_DDS_DTQ: string | null\n  ATIVO_MYTRAIN: string | null\n  ATIVO_JAMPER1: string | null\n  ATIVO_JAMPER2: string | null\n  ATIVO_MODELO: string | null\n  ATIVO_OBSERVACAO: string | null\n}\n\ntype PlanejamentoAssetRow = {\n  id: string\n  ATIVO_CODPE: string\n  ATIVO_DESCRITIVO_OS: string\n  ATIVO_SIGLA: string\n  ATIVO_CICLO: string\n  ATIVO_ULTIMA_MANUT: string | null\n  proxima_manut: string | null\n}\n\ntype AtivoHistoryRow = {\n  id: string\n  company_id: string\n  ativo_id: string\n  action: string\n  before_data: string | null\n  after_data: string\n  changed_by_user_id: string | null\n  changed_by_name: string | null\n  created_at: string\n}\n\ntype AtivoStatusLogRow = {\n  id: string\n  company_id: string\n  ativo_id: string\n  ativo_codpe: string\n  ativo_descritivo: string\n  equipe: string\n  status: string\n  observacao: string\n  data_alteracao: string\n  data_previsao_reparo: string | null\n  changed_by_user_id: string | null\n  changed_by_name: string | null\n  created_at: string\n}\n\r\ntype ComponenteRow = {\r\n  IDCOMPONETE: number\r\n  company_id: string\r\n  IDATIVO: string\r\n  COMP_NOME: string\r\n  COMP_SERIAL: string | null\r\n  COMP_DATA: string | null\r\n  COMP_MODELO: string | null\r\n  COMP_DESCRICAO: string | null\r\n}\r\n\r\ntype ComponenteListRow = ComponenteRow & {\r\n  ATIVO_CODPE: string | null\r\n  ATIVO_DESCRITIVO_OS: string | null\r\n  ATIVO_SIGLA: string | null\r\n  ATIVO_COORDENACAO: string | null\r\n  ATIVO_EQUIPE: string | null\r\n}\r\n\r\ntype ComponenteMaintenanceRow = {\r\n  id: number\r\n  company_id: string\r\n  hist_manut_id_componente: number\r\n  hist_manut_data_hora: string\r\n  hist_manut_id_os: string | null\r\n  created_at: string\r\n}\r\n\r\ntype ComponenteChangeRow = {\r\n  id: number\r\n  company_id: string\r\n  IDCOMPONETE: number\r\n  usuario_id: string\r\n  data_hora: string\r\n  campos_alterados: string\r\n  created_at: string\r\n}\r\n\r\ntype NotaStatus =\r\n  | 'Criado'\r\n  | 'Novo'\r\n  | 'Programado'\r\n  | 'Ag. Material'\r\n  | 'Ag'\r\n  | 'Plano'\r\n  | 'Cancelado'\r\n\r\ntype NotaRow = {\r\n  IDNOTA: number\r\n  company_id: string\r\n  id_ativo: string\r\n  id_os: string | null\r\n  nota_pendencia: string\r\n  nota_status: NotaStatus\r\n  nota_data_criada: string\r\n  nota_data_programada: string | null\r\n  nota_data_realizada: string | null\r\n  nota_observacao_pcm: string | null\r\n  nota_observacao_tecnico: string | null\r\n}\r\n\r\ntype NotaListRow = NotaRow & {\r\n  ATIVO_CODPE: string | null\r\n  ATIVO_DESCRITIVO_OS: string | null\r\n}\r\n\r\ntype NotaChangeRow = {\r\n  id: number\r\n  company_id: string\r\n  IDNOTA: number\r\n  usuario_id: string\r\n  data_hora: string\r\n  campos_alterados: string\r\n  created_at: string\r\n}\r\n\r\ntype TarefaRow = {\r\n  id: string\r\n  company_id: string\r\n  id_sigla: string\r\n  sigla: string\r\n  tarefa: string\r\n  medicao: 0 | 1\r\n  criticidade: 0 | 1\r\n  periodicidade: number\r\n  sub_sistema: string | null\r\n  sistema: string | null\r\n  codigo: string\r\n  active: 0 | 1\r\n  created_at: string\r\n  updated_at: string\r\n  created_by: string | null\r\n  updated_by: string | null\r\n}\r\n\r\nconst NOTA_STATUSES: NotaStatus[] = [\r\n  'Criado',\r\n  'Novo',\r\n  'Programado',\r\n  'Ag. Material',\r\n  'Ag',\r\n  'Plano',\r\n  'Cancelado'\r\n]\r\n\r\nfunction normalizeNotaStatus(value: unknown): NotaStatus | null {\r\n  const normalized = String(value ?? '').trim()\r\n  if (NOTA_STATUSES.includes(normalized as NotaStatus)) {\r\n    return normalized as NotaStatus\r\n  }\r\n  return null\r\n}\r\n\r\ntype OrderServiceRow = {\r\n  id: string\r\n  company_id: string\r\n  os_numero: number\r\n  estrutura_id: string\r\n  ativo_id: string\r\n  os_tipo: string\r\n  os_pdm: number\r\n  os_status: string\r\n  os_checklist: number\r\n  os_capex: number\r\n  os_realizado_em: string | null\r\n  os_programado1: string | null\r\n  os_programado2: string | null\r\n  os_programado3: string | null\r\n  os_programado4: string | null\r\n  os_programado5: string | null\r\n  os_obs_pcm: string | null\r\n  os_obs_tecnico: string | null\r\n  os_ano: number\r\n  os_mes: number\r\n  created_at?: string\r\n  created_by?: string\r\n  updated_at?: string | null\r\n  updated_by?: string | null\r\n}\r\n\r\ntype OrderServiceListRow = {\r\n  id: string\r\n  os_numero: number\r\n  os_status: string\r\n  os_pdm: number\r\n  os_tipo: string\r\n  os_checklist: number\r\n  os_capex: number\r\n  os_programado1: string | null\r\n  os_programado2: string | null\r\n  os_programado3: string | null\r\n  os_programado4: string | null\r\n  os_programado5: string | null\r\n  os_realizado_em: string | null\r\n  os_obs_pcm: string | null\r\n  ATIVO_CODPE: string\r\n  ATIVO_DESCRITIVO_OS: string\r\n  ATIVO_EQUIPE: string\r\n}\r\n\r\ntype OrderServiceHistoryRow = {\r\n  id: string\r\n  company_id: string\r\n  order_service_id: string\r\n  action: string\r\n  before_data: string | null\r\n  after_data: string\r\n  changed_by_user_id: string | null\r\n  changed_by_name: string | null\r\n  created_at: string\r\n}\r\n\r\ntype SchedulerConfigRow = {\r\n  id: string\r\n  company_id: string\r\n  coordenacao: string\r\n  equipe: string\r\n  mes: string\r\n  data_json: string\r\n  created_at?: string\r\n  updated_at?: string\r\n}\r\n\r\ntype SchedulerTeamConfigRow = {\r\n  id: string\r\n  company_id: string\r\n  coordenacao: string\r\n  equipe: string\r\n  escala: string\r\n  observacao: string | null\r\n  created_at?: string\r\n  updated_at?: string\r\n}\r\n\r\ntype SchedulerSubTeamConfigRow = {\r\n  id: string\r\n  company_id: string\r\n  coordenacao: string\r\n  equipe_id: string\r\n  sub_equipe: string\r\n  escala: string\r\n  status: string\r\n  observacao: string | null\r\n  created_at?: string\r\n  updated_at?: string\r\n}\r\n\r\ntype SchedulerAssignmentRow = {\r\n  id: string\r\n  company_id: string\r\n  os_id: string\r\n  coordenacao: string\r\n  equipe_id: string\r\n  sub_equipe: string\r\n  created_at?: string\r\n  updated_at?: string\r\n}\r\n\r\ntype SchedulerHolidayRow = {\r\n  id: string\r\n  company_id: string\r\n  equipe_id: string\r\n  feriado: string\r\n  data: string\r\n  created_at?: string\r\n  updated_at?: string\r\n}\r\n\r\ntype ProfileHistoryRow = {\r\n  id: string\r\n  company_id: string\r\n  profile_id: string\r\n  changed_by_user_id: string | null\r\n  changed_by_name: string | null\r\n  changes: string\r\n  created_at: string\r\n}\r\n\r\ntype EstruturaRow = {\r\n  id: string\r\n  company_id: string\r\n  coordenacao: string\r\n  equipe: string\r\n  cc: string\r\n  execucao: string\r\n  status: string\r\n  created_at: string\r\n}\r\n\r\ntype EstruturaHistoryRow = {\n  id: string\n  company_id: string\n  estrutura_id: string\n  action: string\n  before_data: string | null\n  after_data: string\n  changed_by_user_id: string | null\n  changed_by_name: string | null\n  created_at: string\n}\n\ntype ParametroCadastroAtivoType =\n  | 'Status_ativo'\n  | 'Monitorado'\n  | 'Sub'\n  | 'Ciclo'\n  | 'Tolerancia'\n  | 'Classe'\n  | 'Grupo'\n  | 'ModeloPoste'\n  | 'ModeloRele'\n  | 'DDSmodelo'\n  | 'CaixaModelo'\n\nconst PARAMETRO_TIPOS: ParametroCadastroAtivoType[] = [\n  'Status_ativo',\n  'Monitorado',\n  'Sub',\n  'Ciclo',\n  'Tolerancia',\n  'Classe',\n  'Grupo',\n  'ModeloPoste',\n  'ModeloRele',\n  'DDSmodelo',\n  'CaixaModelo'\n]\n\nlet parametrosTableEnsured = false\n\nasync function ensureParametrosTable(env: Env): Promise<void> {\n  if (parametrosTableEnsured) return\n  await env.DB.prepare(\n    `CREATE TABLE IF NOT EXISTS tb_parametro (\n       id_parametro TEXT PRIMARY KEY,\n       company_id TEXT NOT NULL,\n       tipo_parametro TEXT NOT NULL,\n       valor TEXT NOT NULL,\n       ativo INTEGER NOT NULL DEFAULT 1,\n       ordem INTEGER,\n       observacao TEXT,\n       created_at TEXT NOT NULL,\n       updated_at TEXT NOT NULL\n     )`\n  ).run()\n  await env.DB.prepare(\n    `CREATE INDEX IF NOT EXISTS idx_parametro_company\n     ON tb_parametro (company_id, tipo_parametro)`\n  ).run()\n  parametrosTableEnsured = true\n}\n\ntype ParametroCadastroAtivoRow = {\n  id_parametro: string\n  company_id: string\n  tipo_parametro: ParametroCadastroAtivoType\n  valor: string\n  ativo: 0 | 1\n  ordem: number | null\n  observacao: string | null\n  created_at: string\n  updated_at: string\n}\n\r\nconst DEFAULT_JWT_EXP_MINUTES = 30\nconst DEFAULT_MAX_ATTEMPTS = 5\nconst DEFAULT_LOCK_MINUTES = 15\nconst SESSION_COOKIE_NAME = 'tecrail_session'\nconst SESSION_REFRESH_THRESHOLD_MINUTES = 5\n\ntype PendingSessionRefresh = {\n  token: string\n  maxAgeSeconds: number\n}\n\nconst pendingSessionRefresh = new WeakMap<Request, PendingSessionRefresh>()\n\nfunction scheduleSessionRefresh(\n  request: Request,\n  token: string,\n  maxAgeSeconds: number\n): void {\n  pendingSessionRefresh.set(request, { token, maxAgeSeconds })\n}\n\n// Local execution: `wrangler dev` uses the local D1 database (mirror of remote).\n// Remote execution: `wrangler deploy` uses the remote D1 database.\nexport default {\n  async fetch(request: Request, env: Env): Promise<Response> {\n  const respond = (response: Response, _env?: Env) => {\n    const refreshMeta = pendingSessionRefresh.get(request)\n    if (refreshMeta) {\n      response.headers.append(\n        'Set-Cookie',\n        buildSessionCookie(refreshMeta.token, request, refreshMeta.maxAgeSeconds)\n      )\n      pendingSessionRefresh.delete(request)\n    }\n    return withCors(response, env, request)\n  }\n    try {\n      if (request.method === 'OPTIONS') {\n        return respond(new Response(null, { status: 204 }))\n      }\n\r\n      const url = new URL(request.url)\r\n      const routeKey = `${request.method.toUpperCase()} ${url.pathname}`\r\n\r\n      switch (routeKey) {\r\n        case 'GET /':\r\n          return respond(\r\n            Response.json({\r\n              status: 'ok',\r\n              routes: [\r\n                '/health',\r\n                '/db/health',\r\n                '/auth/login',\r\n                '/auth/me',\r\n                '/auth/permissions',\r\n                '/admin/users',\r\n                '/admin/profiles',\r\n                '/admin/profiles/history',\r\n                '/estrutura',\r\n                '/estrutura/history',\r\n                '/ativos',\r\n                '/ativos/detail',\r\n                '/ativos/history',\r\n                '/componentes',\r\n                '/componentes/detail',\r\n                '/componentes/historico/manutencao',\r\n                '/componentes/historico/alteracao',\r\n                '/notas',\r\n                '/notas/detail',\r\n                '/notas/historico/alteracao',\r\n                '/os',\r\n                '/os/detail',\r\n                '/os/history',\r\n                '/os/scheduler-config',\r\n                '/os/scheduler-team-config',\r\n                '/os/scheduler-sub-team',\r\n                '/os/scheduler-assignment',\r\n                '/os/scheduler-holiday'\r\n              ]\r\n          }),\r\n          env\r\n        )\r\n        case 'GET /health':\r\n          return respond(\r\n            Response.json({ status: 'ok', service: 'tecrail-worker' }),\r\n            env\r\n          )\r\n        case 'GET /db/health':\r\n          return respond(await handleDbHealth(env), env)\r\n        case 'POST /auth/login':\r\n          return respond(await handleLogin(request, env), env)\r\n        case 'GET /auth/me':\r\n          return respond(await handleAuthMe(request, env), env)\r\n        case 'GET /auth/permissions':\n          return respond(await handleAuthPermissions(request, env), env)\n        case 'POST /auth/logout':\n          return respond(await handleLogout(request, env), env)\n        case 'POST /admin/users':\r\n          return respond(await handleCreateUser(request, env), env)\r\n        case 'GET /admin/users':\r\n          return respond(await handleListUsers(request, env), env)\r\n        case 'PATCH /admin/users':\r\n          return respond(await handleUpdateUser(request, env), env)\r\n        case 'GET /admin/users/history':\r\n          return respond(await handleUserHistory(request, env), env)\r\n        case 'GET /admin/profiles':\r\n          return respond(await handleListProfiles(request, env), env)\r\n        case 'POST /admin/profiles':\r\n          return respond(await handleCreateProfile(request, env), env)\r\n        case 'PATCH /admin/profiles':\r\n          return respond(await handleUpdateProfile(request, env), env)\r\n        case 'GET /admin/profiles/history':\r\n          return respond(await handleProfileHistory(request, env), env)\r\n        case 'GET /estrutura':\r\n          return respond(await handleListEstrutura(request, env), env)\r\n        case 'POST /estrutura':\r\n          return respond(await handleCreateEstrutura(request, env), env)\r\n        case 'PATCH /estrutura':\r\n          return respond(await handleUpdateEstrutura(request, env), env)\r\n        case 'GET /estrutura/history':\n          return respond(await handleEstruturaHistory(request, env), env)\n        case 'GET /parametros':\n          return respond(await handleListParametros(request, env), env)\n        case 'POST /parametros':\n          return respond(await handleCreateParametro(request, env), env)\n        case 'PATCH /parametros':\n          return respond(await handleUpdateParametro(request, env), env)\n        case 'GET /ativos':\n          return respond(await handleListAtivos(request, env), env)\r\n        case 'GET /ativos/detail':\n          return respond(await handleGetAtivo(request, env), env)\n        case 'POST /ativos':\n          return respond(await handleCreateAtivo(request, env), env)\n        case 'PATCH /ativos':\n          return respond(await handleUpdateAtivo(request, env), env)\n        case 'GET /ativos/status-history':\n          return respond(await handleAtivoStatusHistory(request, env), env)\n        case 'GET /ativos/history':\n          return respond(await handleAtivoHistory(request, env), env)\n        case 'GET /componentes':\r\n          return respond(await handleListComponentes(request, env), env)\r\n        case 'GET /componentes/detail':\r\n          return respond(await handleGetComponenteDetail(request, env), env)\r\n        case 'GET /componentes/historico/manutencao':\r\n          return respond(\r\n            await handleComponentesMaintenanceHistory(request, env),\r\n            env\r\n          )\r\n        case 'GET /componentes/historico/alteracao':\r\n          return respond(\r\n            await handleComponentesChangeHistory(request, env),\r\n            env\r\n          )\r\n        case 'POST /componentes':\r\n          return respond(await handleCreateComponente(request, env), env)\r\n        case 'PATCH /componentes':\r\n          return respond(await handleUpdateComponente(request, env), env)\r\n        case 'GET /notas':\r\n          return respond(await handleListNotas(request, env), env)\r\n        case 'GET /notas/detail':\r\n          return respond(await handleGetNotaDetail(request, env), env)\r\n        case 'GET /notas/historico/alteracao':\r\n          return respond(await handleNotaChangeHistory(request, env), env)\r\n        case 'POST /notas':\r\n          return respond(await handleCreateNotas(request, env), env)\r\n        case 'PATCH /notas':\r\n          return respond(await handleUpdateNota(request, env), env)\r\n        case 'GET /tarefas':\n          return respond(await handleListTarefas(request, env), env)\n        case 'GET /planejamento/filters':\n          return respond(await handlePlanejamentoFilters(request, env), env)\n        case 'GET /planejamento/technicians':\n          return respond(await handlePlanejamentoTechnicians(request, env), env)\n        case 'GET /planejamento/ativos':\n          return respond(await handlePlanejamentoAssets(request, env), env)\n        case 'POST /tarefas':\n          return respond(await handleCreateTarefa(request, env), env)\n        case 'PATCH /tarefas':\r\n          return respond(await handleUpdateTarefa(request, env), env)\r\n        case 'GET /os':\r\n          return respond(await handleListOrderService(request, env), env)\r\n        case 'GET /os/detail':\r\n          return respond(await handleGetOrderService(request, env), env)\r\n        case 'POST /os':\r\n          return respond(await handleCreateOrderService(request, env), env)\r\n        case 'PATCH /os':\r\n          return respond(await handleUpdateOrderService(request, env), env)\r\n        case 'GET /os/history':\r\n          return respond(await handleOrderServiceHistory(request, env), env)\r\n        case 'PATCH /os/bulk':\r\n          return respond(await handleBulkUpdateOrderService(request, env), env)\r\n        case 'GET /os/scheduler-config':\r\n          return respond(await handleGetSchedulerConfig(request, env), env)\r\n        case 'PATCH /os/scheduler-config':\r\n          return respond(await handleUpsertSchedulerConfig(request, env), env)\r\n        case 'GET /os/scheduler-team-config':\r\n          return respond(await handleGetSchedulerTeamConfig(request, env), env)\r\n        case 'PATCH /os/scheduler-team-config':\r\n          return respond(await handleUpsertSchedulerTeamConfig(request, env), env)\r\n        case 'GET /os/scheduler-sub-team':\r\n          return respond(await handleGetSchedulerSubTeamConfig(request, env), env)\r\n        case 'PATCH /os/scheduler-sub-team':\r\n          return respond(await handleUpsertSchedulerSubTeamConfig(request, env), env)\r\n        case 'DELETE /os/scheduler-sub-team':\r\n          return respond(await handleDeleteSchedulerSubTeamConfig(request, env), env)\r\n        case 'GET /os/scheduler-assignment':\r\n          return respond(await handleGetSchedulerAssignments(request, env), env)\r\n        case 'PATCH /os/scheduler-assignment':\r\n          return respond(await handleUpsertSchedulerAssignment(request, env), env)\r\n        case 'DELETE /os/scheduler-assignment':\r\n          return respond(await handleDeleteSchedulerAssignment(request, env), env)\r\n        case 'GET /os/scheduler-holiday':\r\n          return respond(await handleGetSchedulerHolidays(request, env), env)\r\n        case 'PATCH /os/scheduler-holiday':\r\n          return respond(await handleUpsertSchedulerHoliday(request, env), env)\r\n        default:\r\n          if (routeKey.startsWith('DELETE /componentes/')) {\r\n            return respond(await handleDeleteComponente(request, env), env)\r\n          }\r\n          return respond(new Response('Not Found', { status: 404 }), env)\r\n      }\r\n    } catch (error) {\r\n      console.error('Unhandled worker error', error)\r\n      return respond(\r\n        Response.json({ error: 'Erro interno.' }, { status: 500 }),\r\n        env\r\n      )\r\n    }\r\n  }\r\n}\r\n\r\nasync function handleDbHealth(env: Env): Promise<Response> {\r\n  // Minimal query to validate the D1 binding without relying on real data.\r\n  const result = await env.DB.prepare('SELECT 1 AS ok').first<{ ok: number }>()\r\n  return Response.json({ ok: result?.ok === 1 })\r\n}\r\n\r\nasync function handleLogin(request: Request, env: Env): Promise<Response> {\r\n  assertJwtSecret(env)\r\n\r\n  const payload = await readJson(request)\r\n  const clientIp = getClientIp(request)\r\n  if (!payload) {\r\n    await logLoginAttempt(env, {\r\n      success: 0,\r\n      reason: 'invalid_payload',\r\n      ip: clientIp,\r\n      userAgent: request.headers.get('user-agent')\r\n    })\r\n    return Response.json({ error: 'Dados invalidos.' }, { status: 400 })\r\n  }\r\n\r\n  const cs = String(payload.cs || '').trim()\r\n  const senha = String(payload.senha || '')\r\n\r\n  if (!cs || !senha) {\r\n    await logLoginAttempt(env, {\r\n      success: 0,\r\n      reason: 'missing_fields',\r\n      ip: clientIp,\r\n      userAgent: request.headers.get('user-agent')\r\n    })\r\n    return Response.json({ error: 'Empresa, CS e senha sao obrigatorios.' }, { status: 400 })\r\n  }\r\n\r\n  const user = await env.DB\n    .prepare(\n      `SELECT u.*, c.status AS company_status, p.name AS profile_name\n       FROM tb_user u\n       LEFT JOIN tb_company c ON c.id = u.company_id\n       LEFT JOIN tb_profile p ON p.id = u.profile_id\n       WHERE u.cs = ?`\n    )\n    .bind(cs)\n    .first<UserWithCompanyRow>()\n\r\n  if (!user) {\r\n    await logLoginAttempt(env, {\r\n      success: 0,\r\n      reason: 'user_not_found',\r\n      companyId: null,\r\n      userId: null,\r\n      cs,\r\n      ip: clientIp,\r\n      userAgent: request.headers.get('user-agent')\r\n    })\r\n    return Response.json({ error: 'Credenciais invalidas.' }, { status: 401 })\r\n  }\r\n\r\n  const companyId = user.company_id\r\n\r\n  if (user.company_status !== 'ativo') {\r\n    await logLoginAttempt(env, {\r\n      success: 0,\r\n      reason: 'company_inactive',\r\n      companyId: user.company_id,\r\n      userId: user.id,\r\n      cs,\r\n      ip: clientIp,\r\n      userAgent: request.headers.get('user-agent')\r\n    })\r\n    return Response.json({ error: 'Credenciais invalidas.' }, { status: 401 })\r\n  }\r\n\r\n  if (user.status !== 'ativo') {\r\n    await logLoginAttempt(env, {\r\n      success: 0,\r\n      reason: 'user_inactive',\r\n      companyId: user.company_id,\r\n      userId: user.id,\r\n      cs,\r\n      email: user.email,\r\n      ip: clientIp,\r\n      userAgent: request.headers.get('user-agent')\r\n    })\r\n    return Response.json({ error: 'Credenciais invalidas.' }, { status: 401 })\r\n  }\r\n\r\n  const auth = await env.DB\r\n    .prepare(\r\n      'SELECT user_id, password_hash, last_login_at, failed_attempts, locked_until FROM tb_user_auth WHERE user_id = ?'\r\n    )\r\n    .bind(user.id)\r\n    .first<UserAuthRow>()\r\n\r\n  if (!auth) {\r\n    await logLoginAttempt(env, {\r\n      success: 0,\r\n      reason: 'auth_missing',\r\n      companyId,\r\n      userId: user.id,\r\n      cs,\r\n      email: user.email,\r\n      ip: clientIp,\r\n      userAgent: request.headers.get('user-agent')\r\n    })\r\n    return Response.json({ error: 'Credenciais invalidas.' }, { status: 401 })\r\n  }\r\n\r\n  const now = new Date()\r\n  const lockedUntil = auth.locked_until ? new Date(auth.locked_until) : null\r\n  if (lockedUntil && lockedUntil.getTime() > now.getTime()) {\r\n    await logLoginAttempt(env, {\r\n      success: 0,\r\n      reason: 'account_locked',\r\n      companyId,\r\n      userId: user.id,\r\n      cs,\r\n      email: user.email,\r\n      ip: clientIp,\r\n      userAgent: request.headers.get('user-agent')\r\n    })\r\n    return Response.json({ error: 'Conta bloqueada temporariamente.' }, { status: 423 })\r\n  }\r\n\r\n  const passwordOk = await bcrypt.compare(senha, auth.password_hash)\r\n  if (!passwordOk) {\r\n    const maxAttempts = parseInt(env.AUTH_MAX_ATTEMPTS || '', 10) || DEFAULT_MAX_ATTEMPTS\r\n    const lockMinutes = parseInt(env.AUTH_LOCK_MINUTES || '', 10) || DEFAULT_LOCK_MINUTES\r\n    const failedAttempts = (auth.failed_attempts || 0) + 1\r\n    const shouldLock = failedAttempts >= maxAttempts\r\n    const newLockedUntil = shouldLock\r\n      ? new Date(now.getTime() + lockMinutes * 60 * 1000).toISOString()\r\n      : null\r\n\r\n    await env.DB\r\n      .prepare('UPDATE tb_user_auth SET failed_attempts = ?, locked_until = ? WHERE user_id = ?')\r\n      .bind(failedAttempts, newLockedUntil, user.id)\r\n      .run()\r\n\r\n    await logLoginAttempt(env, {\r\n      success: 0,\r\n      reason: shouldLock ? 'account_locked' : 'invalid_password',\r\n      companyId,\r\n      userId: user.id,\r\n      cs,\r\n      email: user.email,\r\n      ip: clientIp,\r\n      userAgent: request.headers.get('user-agent')\r\n    })\r\n\r\n    return Response.json({ error: 'Credenciais invalidas.' }, { status: 401 })\r\n  }\r\n\r\n  await env.DB\r\n    .prepare('UPDATE tb_user_auth SET failed_attempts = 0, locked_until = NULL, last_login_at = ? WHERE user_id = ?')\r\n    .bind(now.toISOString(), user.id)\r\n    .run()\r\n\r\n  await revokeActiveSessionsForUser(env, user.id, companyId)\r\n  const sessionId = await createUserSession(env, companyId, user.id, clientIp)\r\n\r\n  await logLoginAttempt(env, {\r\n    success: 1,\r\n    reason: 'login_success',\r\n    companyId,\r\n    userId: user.id,\r\n    cs,\r\n    email: user.email,\r\n    ip: clientIp,\r\n    userAgent: request.headers.get('user-agent')\r\n  })\r\n\r\n  const expMinutes = parseInt(env.JWT_EXP_MINUTES || '', 10) || DEFAULT_JWT_EXP_MINUTES\n  const token = await signJwt(\n    {\n      user_id: user.id,\n      company_id: companyId,\n      nome: user.nome,\n      cargo: user.cargo,\n      equipe: user.equipe,\n      session_id: sessionId\n    },\n    env.JWT_SECRET,\n    expMinutes\n  )\n\n  const cookie = buildSessionCookie(token, request, expMinutes * 60)\n  const response = Response.json({\n    token,\n    user: {\n      id: user.id,\n      company_id: companyId,\n      nome: user.nome,\n      email: user.email,\n      cargo: user.cargo,\n      equipe: user.equipe,\n      profile_id: user.profile_id,\n      profile_name: user.profile_name\n    }\n  })\n  response.headers.set('Set-Cookie', cookie)\n  return response\n}\n\r\nasync function handleAuthMe(request: Request, env: Env): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  // Company isolation: always filter by company_id.\r\n  const user = await env.DB\n    .prepare(\n      `SELECT u.id, u.company_id, u.nome, u.email, u.cargo, u.equipe, u.profile_id,\n              p.name AS profile_name\n       FROM tb_user u\n       LEFT JOIN tb_profile p ON p.id = u.profile_id\n       WHERE u.id = ? AND u.company_id = ?`\n    )\n    .bind(auth.user_id, auth.company_id)\n    .first<UserRow>()\n\r\n  if (!user || user.status !== 'ativo') {\r\n    return Response.json({ error: 'Usuario inativo.' }, { status: 401 })\r\n  }\r\n\r\n  return Response.json({\n    user: {\n      id: user.id,\n      company_id: user.company_id,\n      nome: user.nome,\n      email: user.email,\n      cargo: user.cargo,\n      equipe: user.equipe,\n      profile_id: user.profile_id,\n      profile_name: user.profile_name\n    }\n  })\n}\r\n\r\nasync function handleAuthPermissions(request: Request, env: Env): Promise<Response> {\n  assertJwtSecret(env)\n  const auth = await requireAuth(request, env)\n  if (!auth) {\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\n  }\n\r\n  const result = await env.DB.prepare(\r\n    `SELECT perm.screen_id, perm.leitura, perm.criacao, perm.edicao, perm.exclusao\r\n     FROM tb_user u\r\n     LEFT JOIN tb_profile p ON p.id = u.profile_id\r\n     LEFT JOIN tb_profile_permission perm ON perm.profile_id = u.profile_id\r\n     WHERE u.id = ? AND u.company_id = ? AND p.status = 'ativo'`\r\n  )\r\n    .bind(auth.user_id, auth.company_id)\r\n    .all<PermissionRow>()\r\n\r\n  const permissions: Record<\r\n    string,\r\n    { leitura: boolean; criacao: boolean; edicao: boolean; exclusao: boolean }\r\n  > = {}\r\n\r\n  for (const row of result.results) {\r\n    if (!row.screen_id) continue\r\n    permissions[row.screen_id] = {\r\n      leitura: row.leitura === 1,\r\n      criacao: row.criacao === 1,\r\n      edicao: row.edicao === 1,\r\n      exclusao: row.exclusao === 1\r\n    }\r\n  }\r\n\r\n  return Response.json({ permissions })\n}\n\nasync function handleLogout(request: Request, env: Env): Promise<Response> {\n  assertJwtSecret(env)\n  const auth = await requireAuth(request, env)\n  if (auth) {\n    await revokeSession(env, auth.session_id, auth.company_id, auth.user_id)\n  }\n\n  const cookie = buildSessionCookie('', request, 0)\n  const response = Response.json({ ok: true })\n  response.headers.set('Set-Cookie', cookie)\n  return response\n}\n\r\nasync function handleCreateUser(request: Request, env: Env): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n  const permissionError = await requirePermission(\r\n    env,\r\n    auth,\r\n    'configuracao',\r\n    'criacao'\r\n  )\r\n  if (permissionError) return permissionError\r\n\r\n  const payload = await readJson(request)\r\n  if (!payload) {\r\n    return Response.json({ error: 'Dados invalidos.' }, { status: 400 })\r\n  }\r\n\r\n  const nome = String(payload.nome || '').trim()\r\n  const cs = String(payload.cs || '').trim()\r\n  const email = String(payload.email || '').trim().toLowerCase()\r\n  const escala = normalizeEscala(String(payload.escala || ''))\r\n  const profileId = payload.profile_id ? String(payload.profile_id).trim() : ''\r\n  const cargo = payload.cargo ? String(payload.cargo).trim() : null\r\n  const coordenacao = payload.coordenacao\r\n    ? String(payload.coordenacao).trim()\r\n    : null\r\n  const equipe = payload.equipe ? String(payload.equipe).trim() : null\r\n  const equipeAditiva = payload.equipe_aditiva\r\n    ? String(payload.equipe_aditiva).trim()\r\n    : null\r\n  const status = normalizeStatus(String(payload.status || 'ativo'))\r\n  const senha = String(payload.senha || '')\r\n\r\n  if (!nome || !cs || !email || !senha || !escala || !profileId) {\r\n    return Response.json(\r\n      { error: 'Nome, CS, email, escala, perfil e senha sao obrigatorios.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n\r\n  if (!isValidEmail(email)) {\r\n    return Response.json({ error: 'Email invalido.' }, { status: 400 })\r\n  }\r\n\r\n  if (!isPasswordValid(senha)) {\r\n    return Response.json(\r\n      {\r\n        error:\r\n          'Senha invalida. Minimo 7 caracteres, 1 letra, 1 numero e 1 especial (!@#$%&).'\r\n      },\r\n      { status: 400 }\r\n    )\r\n  }\r\n\r\n  if (!status) {\r\n    return Response.json({ error: 'Status invalido.' }, { status: 400 })\r\n  }\r\n\r\n  if (!escala) {\r\n    return Response.json({ error: 'Escala invalida.' }, { status: 400 })\r\n  }\r\n\r\n  if (!isValidCs(cs)) {\r\n    return Response.json({ error: 'CS deve conter 6 digitos.' }, { status: 400 })\r\n  }\r\n\r\n  const profile = await env.DB.prepare(\r\n    'SELECT id, status FROM tb_profile WHERE id = ? AND company_id = ?'\r\n  )\r\n    .bind(profileId, auth.company_id)\r\n    .first<ProfileRow>()\r\n\r\n  if (!profile || profile.status !== 'ativo') {\r\n    return Response.json({ error: 'Perfil invalido.' }, { status: 400 })\r\n  }\r\n\r\n  const company = await env.DB.prepare(\r\n    'SELECT id, status FROM tb_company WHERE id = ?'\r\n  )\r\n    .bind(auth.company_id)\r\n    .first<CompanyRow>()\r\n\r\n  if (!company || company.status !== 'ativo') {\r\n    return Response.json({ error: 'Empresa invalida.' }, { status: 400 })\r\n  }\r\n\r\n  const existing = await env.DB.prepare(\r\n    'SELECT id FROM tb_user WHERE company_id = ? AND (cs = ? OR email = ? OR nome = ?)'\r\n  )\r\n    .bind(auth.company_id, cs, email, nome)\r\n    .first<{ id: string }>()\r\n\r\n  if (existing) {\r\n    return Response.json({ error: 'Usuario ja existe.' }, { status: 409 })\r\n  }\r\n\r\n  const userId = crypto.randomUUID()\r\n  const passwordHash = await bcrypt.hash(senha, 10)\r\n\r\n  await env.DB.prepare(\r\n    `INSERT INTO tb_user (\r\n      id, company_id, nome, cs, email, escala, profile_id, cargo, coordenacao, equipe, equipe_aditiva, status, created_at, updated_at\r\n    ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'), datetime('now'))`\r\n  )\r\n    .bind(\r\n      userId,\r\n      auth.company_id,\r\n      nome,\r\n      cs,\r\n      email,\r\n      escala,\r\n      profileId,\r\n      cargo,\r\n      coordenacao,\r\n      equipe,\r\n      equipeAditiva,\r\n      status\r\n    )\r\n    .run()\r\n\r\n  await env.DB.prepare(\r\n    'INSERT INTO tb_user_auth (user_id, password_hash) VALUES (?, ?)'\r\n  )\r\n    .bind(userId, passwordHash)\r\n    .run()\r\n\r\n  await logUserHistory(env, {\r\n    companyId: auth.company_id,\r\n    userId,\r\n    changedByUserId: auth.user_id,\r\n    changedByName: auth.nome,\r\n    changes: 'Usuario criado'\r\n  })\r\n\r\n  const user = await env.DB.prepare(\r\n    `SELECT u.id, u.company_id, u.nome, u.cs, u.email, u.escala, u.profile_id,\r\n            p.name AS profile_name, u.cargo, u.coordenacao, u.equipe, u.equipe_aditiva,\r\n            u.status, u.created_at, u.updated_at\r\n     FROM tb_user u\r\n     LEFT JOIN tb_profile p ON p.id = u.profile_id\r\n     WHERE u.id = ? AND u.company_id = ?`\r\n  )\r\n    .bind(userId, auth.company_id)\r\n    .first<UserRow>()\r\n\r\n  return Response.json({ user }, { status: 201 })\r\n}\r\n\r\nasync function handleListUsers(request: Request, env: Env): Promise<Response> {\n  assertJwtSecret(env)\n  const auth = await requireAuth(request, env)\n  if (!auth) {\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\n  }\n  const permissionError = await requirePermission(\n    env,\n    auth,\n    'configuracao',\n    'leitura'\n  )\n  if (permissionError) return permissionError\n\n  const result = await env.DB.prepare(\n    `SELECT u.id, u.company_id, u.nome, u.cs, u.email, u.escala, u.profile_id,\n            p.name AS profile_name, u.cargo, u.coordenacao, u.equipe, u.equipe_aditiva,\n            u.status, u.created_at, u.updated_at\n     FROM tb_user u\n     LEFT JOIN tb_profile p ON p.id = u.profile_id\n     WHERE u.company_id = ?\n     ORDER BY u.created_at DESC`\n  )\n    .bind(auth.company_id)\n    .all<UserRow>()\n\n  return Response.json({ users: result.results })\n}\n\nasync function handlePlanejamentoFilters(\n  request: Request,\n  env: Env\n): Promise<Response> {\n  assertJwtSecret(env)\n  const auth = await requireAuth(request, env)\n  if (!auth) {\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\n  }\n\n  const result = await env.DB.prepare(\n    `SELECT\n            TRIM(coordenacao) AS coordenacao,\n            TRIM(equipe) AS equipe\n     FROM tb_estrutura\n     WHERE company_id = ?\n       AND status = 'ativo'\n       AND coordenacao IS NOT NULL\n       AND TRIM(coordenacao) != ''\n       AND equipe IS NOT NULL\n       AND TRIM(equipe) != ''\n     ORDER BY coordenacao, equipe`\n  )\n    .bind(auth.company_id)\n    .all<{ coordenacao: string; equipe: string }>()\n\n  const combos = result.results.filter(\n    row => row.coordenacao && row.equipe\n  )\n\n  const coordenacoes = Array.from(\n    new Set(combos.map(row => row.coordenacao))\n  ).sort()\n\n  const equipesByCoord: Record<string, string[]> = {}\n  for (const row of combos) {\n    if (!row.coordenacao) continue\n    if (!equipesByCoord[row.coordenacao]) {\n      equipesByCoord[row.coordenacao] = []\n    }\n    if (!equipesByCoord[row.coordenacao].includes(row.equipe)) {\n      equipesByCoord[row.coordenacao].push(row.equipe)\n    }\n  }\n  for (const coord of Object.keys(equipesByCoord)) {\n    equipesByCoord[coord].sort()\n  }\n\n  return Response.json({\n    coordenacoes,\n    equipes_by_coordenacao: equipesByCoord\n  })\n}\n\nasync function handlePlanejamentoTechnicians(\n  request: Request,\n  env: Env\n): Promise<Response> {\n  assertJwtSecret(env)\n  const auth = await requireAuth(request, env)\n  if (!auth) {\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\n  }\n\n  const url = new URL(request.url)\n  const coordenacao = (url.searchParams.get('coordenacao') || '').trim()\n  const equipe = (url.searchParams.get('equipe') || '').trim()\n  if (!coordenacao || !equipe) {\n    return Response.json({ technicians: [] })\n  }\n\n  const result = await env.DB.prepare(\n    `SELECT id, nome, TRIM(coordenacao) AS coordenacao, TRIM(equipe) AS equipe\n     FROM tb_user\n     WHERE company_id = ?\n       AND status = 'ativo'\n       AND TRIM(coordenacao) = ?\n       AND TRIM(equipe) = ?\n     ORDER BY nome`\n  )\n    .bind(auth.company_id, coordenacao, equipe)\n    .all<{ id: string; nome: string; coordenacao: string; equipe: string }>()\n\n  return Response.json({\n    technicians: result.results\n  })\n}\n\nasync function handlePlanejamentoAssets(\n  request: Request,\n  env: Env\n): Promise<Response> {\n  assertJwtSecret(env)\n  const auth = await requireAuth(request, env)\n  if (!auth) {\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\n  }\n\n  const url = new URL(request.url)\n  const coordenacao = (url.searchParams.get('coordenacao') || '').trim()\n  const equipe = (url.searchParams.get('equipe') || '').trim()\n  const yearMonth = (url.searchParams.get('year_month') || '').trim()\n  if (\n    !coordenacao ||\n    !equipe ||\n    !yearMonth ||\n    !/^[0-9]{4}-[0-9]{2}$/.test(yearMonth)\n  ) {\n    return Response.json({ ativos: [] })\n  }\n\n  const result = await env.DB.prepare(\n    `SELECT id,\n            ATIVO_CODPE,\n            ATIVO_DESCRITIVO_OS,\n            ATIVO_SIGLA,\n            ATIVO_CICLO,\n            ATIVO_ULTIMA_MANUT,\n            date(ATIVO_ULTIMA_MANUT, '+' || ATIVO_CONTADOR || ' month') AS proxima_manut\n     FROM tb_ativo\n     WHERE company_id = ?\n       AND ATIVO_STATUS = 'ativo'\n       AND TRIM(ATIVO_COORDENACAO) = ?\n       AND TRIM(ATIVO_EQUIPE) = ?\n       AND ATIVO_ULTIMA_MANUT IS NOT NULL\n       AND TRIM(ATIVO_ULTIMA_MANUT) != ''\n       AND ATIVO_CONTADOR > 0\n       AND strftime('%Y-%m', date(ATIVO_ULTIMA_MANUT, '+' || ATIVO_CONTADOR || ' month')) = ?\n     ORDER BY ATIVO_DESCRITIVO_OS`\n  )\n    .bind(auth.company_id, coordenacao, equipe, yearMonth)\n    .all<PlanejamentoAssetRow>()\n\n  return Response.json({\n    ativos: result.results.map(row => ({\n      id: row.id,\n      codpe: row.ATIVO_CODPE,\n      description: row.ATIVO_DESCRITIVO_OS,\n      sigla: row.ATIVO_SIGLA,\n      cycle: row.ATIVO_CICLO,\n      lastMaintenance: row.ATIVO_ULTIMA_MANUT || null,\n      dueDate: row.proxima_manut || null\n    }))\n  })\n}\n\nasync function handleUpdateUser(request: Request, env: Env): Promise<Response> {\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const payload = await readJson(request)\r\n  if (!payload) {\r\n    return Response.json({ error: 'Dados invalidos.' }, { status: 400 })\r\n  }\r\n\r\n  const id = String(payload.id || '').trim()\r\n  if (!id) {\r\n    return Response.json({ error: 'ID obrigatorio.' }, { status: 400 })\r\n  }\r\n\r\n  const nome = payload.nome ? String(payload.nome).trim() : null\r\n  const cs = payload.cs ? String(payload.cs).trim() : null\r\n  const email = payload.email ? String(payload.email).trim().toLowerCase() : null\r\n  const escala = payload.escala ? normalizeEscala(String(payload.escala)) : null\r\n  const profileId = payload.profile_id ? String(payload.profile_id).trim() : null\r\n  const cargo = payload.cargo ? String(payload.cargo).trim() : null\r\n  const coordenacao = payload.coordenacao\r\n    ? String(payload.coordenacao).trim()\r\n    : null\r\n  const equipe = payload.equipe ? String(payload.equipe).trim() : null\r\n  const equipeAditiva = payload.equipe_aditiva\r\n    ? String(payload.equipe_aditiva).trim()\r\n    : null\r\n  const status = payload.status ? normalizeStatus(String(payload.status)) : null\r\n  const senha = payload.senha ? String(payload.senha) : null\r\n\r\n  if (cs && !isValidCs(cs)) {\r\n    return Response.json({ error: 'CS deve conter 6 digitos.' }, { status: 400 })\r\n  }\r\n\r\n  if (email && !isValidEmail(email)) {\r\n    return Response.json({ error: 'Email invalido.' }, { status: 400 })\r\n  }\r\n\r\n  if (payload.status && !status) {\r\n    return Response.json({ error: 'Status invalido.' }, { status: 400 })\r\n  }\r\n\r\n  if (payload.escala && !escala) {\r\n    return Response.json({ error: 'Escala invalida.' }, { status: 400 })\r\n  }\r\n\r\n  if (profileId) {\r\n    const profile = await env.DB.prepare(\r\n      'SELECT id, status FROM tb_profile WHERE id = ? AND company_id = ?'\r\n    )\r\n      .bind(profileId, auth.company_id)\r\n      .first<ProfileRow>()\r\n\r\n    if (!profile || profile.status !== 'ativo') {\r\n      return Response.json({ error: 'Perfil invalido.' }, { status: 400 })\r\n    }\r\n  }\r\n\r\n  if (senha && !isPasswordValid(senha)) {\r\n    return Response.json(\r\n      {\r\n        error:\r\n          'Senha invalida. Minimo 7 caracteres, 1 letra, 1 numero e 1 especial (!@#$%&).'\r\n      },\r\n      { status: 400 }\r\n    )\r\n  }\r\n\r\n  const existing = await env.DB.prepare(\r\n    `SELECT id, nome, cs, email, escala, profile_id, cargo, coordenacao, equipe, equipe_aditiva, status\r\n     FROM tb_user WHERE id = ? AND company_id = ?`\r\n  )\r\n    .bind(id, auth.company_id)\r\n    .first<UserRow>()\r\n\r\n  if (!existing) {\r\n    return Response.json({ error: 'Usuario nao encontrado.' }, { status: 404 })\r\n  }\r\n\r\n  const isDelete = status === 'excluido' && existing.status !== 'excluido'\r\n  const permissionError = await requirePermission(\r\n    env,\r\n    auth,\r\n    'configuracao',\r\n    isDelete ? 'exclusao' : 'edicao'\r\n  )\r\n  if (permissionError) return permissionError\r\n\r\n  if (cs || email || nome) {\r\n    const conflict = await env.DB.prepare(\r\n      'SELECT id FROM tb_user WHERE company_id = ? AND id != ? AND (cs = ? OR email = ? OR nome = ?)'\r\n    )\r\n      .bind(auth.company_id, id, cs ?? '', email ?? '', nome ?? '')\r\n      .first<{ id: string }>()\r\n\r\n    if (conflict) {\r\n      return Response.json({ error: 'Usuario ja existe.' }, { status: 409 })\r\n    }\r\n  }\r\n\r\n  const updates: string[] = []\r\n  const values: Array<string | null> = []\r\n  const changeLabels: string[] = []\r\n\r\n  if (nome !== null && nome !== existing.nome) {\r\n    updates.push('nome = ?')\r\n    values.push(nome)\r\n    changeLabels.push('nome')\r\n  }\r\n  if (cs !== null && cs !== existing.cs) {\r\n    updates.push('cs = ?')\r\n    values.push(cs)\r\n    changeLabels.push('cs')\r\n  }\r\n  if (email !== null && email !== existing.email) {\r\n    updates.push('email = ?')\r\n    values.push(email)\r\n    changeLabels.push('email')\r\n  }\r\n  if (escala !== null && escala !== existing.escala) {\r\n    updates.push('escala = ?')\r\n    values.push(escala)\r\n    changeLabels.push('escala')\r\n  }\r\n  if (profileId !== null && profileId !== existing.profile_id) {\r\n    updates.push('profile_id = ?')\r\n    values.push(profileId)\r\n    changeLabels.push('perfil')\r\n  }\r\n  if (cargo !== null && cargo !== existing.cargo) {\r\n    updates.push('cargo = ?')\r\n    values.push(cargo)\r\n    changeLabels.push('cargo')\r\n  }\r\n  if (coordenacao !== null && coordenacao !== existing.coordenacao) {\r\n    updates.push('coordenacao = ?')\r\n    values.push(coordenacao)\r\n    changeLabels.push('coordenacao')\r\n  }\r\n  if (equipe !== null && equipe !== existing.equipe) {\r\n    updates.push('equipe = ?')\r\n    values.push(equipe)\r\n    changeLabels.push('equipe')\r\n  }\r\n  if (equipeAditiva !== null && equipeAditiva !== existing.equipe_aditiva) {\r\n    updates.push('equipe_aditiva = ?')\r\n    values.push(equipeAditiva)\r\n    changeLabels.push('equipe_aditiva')\r\n  }\r\n  if (status !== null && status !== existing.status) {\r\n    updates.push('status = ?')\r\n    values.push(status)\r\n    changeLabels.push('status')\r\n  }\r\n\r\n  if (!updates.length && !senha) {\r\n    return Response.json({ error: 'Nada para atualizar.' }, { status: 400 })\r\n  }\r\n\r\n  if (updates.length) {\r\n    updates.push(\"updated_at = datetime('now')\")\r\n    await env.DB.prepare(\r\n      `UPDATE tb_user SET ${updates.join(', ')} WHERE id = ? AND company_id = ?`\r\n    )\r\n      .bind(...values, id, auth.company_id)\r\n      .run()\r\n  }\r\n\r\n  if (senha) {\r\n    const passwordHash = await bcrypt.hash(senha, 10)\r\n    await env.DB\r\n      .prepare(\r\n        'UPDATE tb_user_auth SET password_hash = ?, failed_attempts = 0, locked_until = NULL WHERE user_id = ?'\r\n      )\r\n      .bind(passwordHash, id)\r\n      .run()\r\n    changeLabels.push('senha')\r\n  }\r\n\r\n  if (changeLabels.length) {\r\n    const changeText = `Alterado: ${changeLabels.join(', ')}`\r\n    await logUserHistory(env, {\r\n      companyId: auth.company_id,\r\n      userId: id,\r\n      changedByUserId: auth.user_id,\r\n      changedByName: auth.nome,\r\n      changes: changeText\r\n    })\r\n  }\r\n\r\n  const user = await env.DB.prepare(\r\n    `SELECT u.id, u.company_id, u.nome, u.cs, u.email, u.escala, u.profile_id,\r\n            p.name AS profile_name, u.cargo, u.coordenacao, u.equipe, u.equipe_aditiva,\r\n            u.status, u.created_at, u.updated_at\r\n     FROM tb_user u\r\n     LEFT JOIN tb_profile p ON p.id = u.profile_id\r\n     WHERE u.id = ? AND u.company_id = ?`\r\n  )\r\n    .bind(id, auth.company_id)\r\n    .first<UserRow>()\r\n\r\n  return Response.json({ user })\r\n}\r\n\r\nasync function handleUserHistory(request: Request, env: Env): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n  const permissionError = await requirePermission(\r\n    env,\r\n    auth,\r\n    'configuracao',\r\n    'leitura'\r\n  )\r\n  if (permissionError) return permissionError\r\n\r\n  const url = new URL(request.url)\r\n  const userId = url.searchParams.get('user_id')\r\n  if (!userId) {\r\n    return Response.json({ error: 'user_id obrigatorio.' }, { status: 400 })\r\n  }\r\n\r\n  const result = await env.DB.prepare(\r\n    `SELECT id, company_id, user_id, changed_by_user_id, changed_by_name, changes, created_at\r\n     FROM tb_user_history\r\n     WHERE company_id = ? AND user_id = ?\r\n     ORDER BY created_at DESC`\r\n  )\r\n    .bind(auth.company_id, userId)\r\n    .all<UserHistoryRow>()\r\n\r\n  return Response.json({ history: result.results })\r\n}\r\n\r\nasync function handleListProfiles(request: Request, env: Env): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n  const permissionError = await requirePermission(\r\n    env,\r\n    auth,\r\n    'configuracao',\r\n    'leitura'\r\n  )\r\n  if (permissionError) return permissionError\r\n\r\n  const profiles = await env.DB.prepare(\r\n    `SELECT id, company_id, name, status, created_at, updated_at\r\n     FROM tb_profile\r\n     WHERE company_id = ?\r\n     ORDER BY created_at DESC`\r\n  )\r\n    .bind(auth.company_id)\r\n    .all<ProfileRow>()\r\n\r\n  const results = []\r\n  for (const profile of profiles.results) {\r\n    const permissions = await env.DB.prepare(\r\n      `SELECT profile_id, screen_id, leitura, criacao, edicao, exclusao\r\n       FROM tb_profile_permission\r\n       WHERE profile_id = ?`\r\n    )\r\n      .bind(profile.id)\r\n      .all<ProfilePermissionRow>()\r\n    results.push({\r\n      ...profile,\r\n      permissions: permissions.results\r\n    })\r\n  }\r\n\r\n  return Response.json({ profiles: results })\r\n}\r\n\r\nasync function handleCreateProfile(request: Request, env: Env): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n  const permissionError = await requirePermission(\r\n    env,\r\n    auth,\r\n    'configuracao',\r\n    'criacao'\r\n  )\r\n  if (permissionError) return permissionError\r\n\r\n  const payload = await readJson(request)\r\n  if (!payload) {\r\n    return Response.json({ error: 'Dados invalidos.' }, { status: 400 })\r\n  }\r\n\r\n  const name = String(payload.name || '').trim()\r\n  const status = normalizeProfileStatus(String(payload.status || 'ativo'))\r\n  const permissions = Array.isArray(payload.permissions)\r\n    ? payload.permissions\r\n    : []\r\n\r\n  if (!name || !status) {\r\n    return Response.json({ error: 'Nome e status sao obrigatorios.' }, { status: 400 })\r\n  }\r\n\r\n  const conflict = await env.DB.prepare(\r\n    'SELECT id FROM tb_profile WHERE company_id = ? AND name = ?'\r\n  )\r\n    .bind(auth.company_id, name)\r\n    .first<{ id: string }>()\r\n\r\n  if (conflict) {\r\n    return Response.json({ error: 'Perfil ja existe.' }, { status: 409 })\r\n  }\r\n\r\n  const profileId = crypto.randomUUID()\r\n  await env.DB.prepare(\r\n    `INSERT INTO tb_profile (id, company_id, name, status, created_at, updated_at)\r\n     VALUES (?, ?, ?, ?, datetime('now'), datetime('now'))`\r\n  )\r\n    .bind(profileId, auth.company_id, name, status)\r\n    .run()\r\n\r\n  await insertProfilePermissions(env, profileId, permissions)\r\n\r\n  await logProfileHistory(env, {\r\n    companyId: auth.company_id,\r\n    profileId,\r\n    changedByUserId: auth.user_id,\r\n    changedByName: auth.nome,\r\n    changes: 'Perfil criado'\r\n  })\r\n\r\n  const profile = await env.DB.prepare(\r\n    `SELECT id, company_id, name, status, created_at, updated_at\r\n     FROM tb_profile WHERE id = ? AND company_id = ?`\r\n  )\r\n    .bind(profileId, auth.company_id)\r\n    .first<ProfileRow>()\r\n\r\n  const savedPermissions = await env.DB.prepare(\r\n    `SELECT profile_id, screen_id, leitura, criacao, edicao, exclusao\r\n     FROM tb_profile_permission WHERE profile_id = ?`\r\n  )\r\n    .bind(profileId)\r\n    .all<ProfilePermissionRow>()\r\n\r\n  return Response.json(\r\n    { profile: { ...profile, permissions: savedPermissions.results } },\r\n    { status: 201 }\r\n  )\r\n}\r\n\r\nasync function handleUpdateProfile(request: Request, env: Env): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n  const permissionError = await requirePermission(\r\n    env,\r\n    auth,\r\n    'configuracao',\r\n    'edicao'\r\n  )\r\n  if (permissionError) return permissionError\r\n\r\n  const payload = await readJson(request)\r\n  if (!payload) {\r\n    return Response.json({ error: 'Dados invalidos.' }, { status: 400 })\r\n  }\r\n\r\n  const id = String(payload.id || '').trim()\r\n  if (!id) {\r\n    return Response.json({ error: 'ID obrigatorio.' }, { status: 400 })\r\n  }\r\n\r\n  const name = payload.name ? String(payload.name).trim() : null\r\n  const status = payload.status ? normalizeProfileStatus(String(payload.status)) : null\r\n  const permissions = Array.isArray(payload.permissions)\r\n    ? payload.permissions\r\n    : null\r\n\r\n  if (payload.status && !status) {\r\n    return Response.json({ error: 'Status invalido.' }, { status: 400 })\r\n  }\r\n\r\n  const existing = await env.DB.prepare(\r\n    `SELECT id, name, status\r\n     FROM tb_profile WHERE id = ? AND company_id = ?`\r\n  )\r\n    .bind(id, auth.company_id)\r\n    .first<ProfileRow>()\r\n\r\n  if (!existing) {\r\n    return Response.json({ error: 'Perfil nao encontrado.' }, { status: 404 })\r\n  }\r\n\r\n  if (name && name !== existing.name) {\r\n    const conflict = await env.DB.prepare(\r\n      'SELECT id FROM tb_profile WHERE company_id = ? AND id != ? AND name = ?'\r\n    )\r\n      .bind(auth.company_id, id, name)\r\n      .first<{ id: string }>()\r\n\r\n    if (conflict) {\r\n      return Response.json({ error: 'Perfil ja existe.' }, { status: 409 })\r\n    }\r\n  }\r\n\r\n  const updates: string[] = []\r\n  const values: Array<string> = []\r\n  const changeLabels: string[] = []\r\n\r\n  if (name && name !== existing.name) {\r\n    updates.push('name = ?')\r\n    values.push(name)\r\n    changeLabels.push('nome')\r\n  }\r\n  if (status && status !== existing.status) {\r\n    updates.push('status = ?')\r\n    values.push(status)\r\n    changeLabels.push('status')\r\n  }\r\n\r\n  if (!updates.length && !permissions) {\r\n    return Response.json({ error: 'Nada para atualizar.' }, { status: 400 })\r\n  }\r\n\r\n  if (updates.length) {\r\n    updates.push(\"updated_at = datetime('now')\")\r\n    await env.DB.prepare(\r\n      `UPDATE tb_profile SET ${updates.join(', ')} WHERE id = ? AND company_id = ?`\r\n    )\r\n      .bind(...values, id, auth.company_id)\r\n      .run()\r\n  }\r\n\r\n  if (permissions) {\r\n    await env.DB.prepare('DELETE FROM tb_profile_permission WHERE profile_id = ?')\r\n      .bind(id)\r\n      .run()\r\n    await insertProfilePermissions(env, id, permissions)\r\n    changeLabels.push('permissoes')\r\n  }\r\n\r\n  if (changeLabels.length) {\r\n    await logProfileHistory(env, {\r\n      companyId: auth.company_id,\r\n      profileId: id,\r\n      changedByUserId: auth.user_id,\r\n      changedByName: auth.nome,\r\n      changes: `Alterado: ${changeLabels.join(', ')}`\r\n    })\r\n  }\r\n\r\n  const profile = await env.DB.prepare(\r\n    `SELECT id, company_id, name, status, created_at, updated_at\r\n     FROM tb_profile WHERE id = ? AND company_id = ?`\r\n  )\r\n    .bind(id, auth.company_id)\r\n    .first<ProfileRow>()\r\n\r\n  const savedPermissions = await env.DB.prepare(\r\n    `SELECT profile_id, screen_id, leitura, criacao, edicao, exclusao\r\n     FROM tb_profile_permission WHERE profile_id = ?`\r\n  )\r\n    .bind(id)\r\n    .all<ProfilePermissionRow>()\r\n\r\n  return Response.json({ profile: { ...profile, permissions: savedPermissions.results } })\r\n}\r\n\r\nasync function handleProfileHistory(request: Request, env: Env): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n  const permissionError = await requirePermission(\r\n    env,\r\n    auth,\r\n    'configuracao',\r\n    'leitura'\r\n  )\r\n  if (permissionError) return permissionError\r\n\r\n  const url = new URL(request.url)\r\n  const profileId = url.searchParams.get('profile_id')\r\n  if (!profileId) {\r\n    return Response.json({ error: 'profile_id obrigatorio.' }, { status: 400 })\r\n  }\r\n\r\n  const result = await env.DB.prepare(\r\n    `SELECT id, company_id, profile_id, changed_by_user_id, changed_by_name, changes, created_at\r\n     FROM tb_profile_history\r\n     WHERE company_id = ? AND profile_id = ?\r\n     ORDER BY created_at DESC`\r\n  )\r\n    .bind(auth.company_id, profileId)\r\n    .all<ProfileHistoryRow>()\r\n\r\n  return Response.json({ history: result.results })\r\n}\r\n\r\nasync function handleListEstrutura(request: Request, env: Env): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n  const permissionError = await requirePermission(\r\n    env,\r\n    auth,\r\n    'configuracao',\r\n    'leitura'\r\n  )\r\n  if (permissionError) return permissionError\r\n\r\n  const result = await env.DB.prepare(\r\n    `SELECT id, company_id, coordenacao, equipe, cc, execucao, status, created_at\r\n     FROM tb_estrutura\r\n     WHERE company_id = ? AND status != 'excluido'\r\n     ORDER BY created_at DESC`\r\n  )\r\n    .bind(auth.company_id)\r\n    .all<EstruturaRow>()\r\n\r\n  return Response.json({ estrutura: result.results })\r\n}\r\n\r\nasync function handleCreateEstrutura(request: Request, env: Env): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n  const permissionError = await requirePermission(\r\n    env,\r\n    auth,\r\n    'configuracao',\r\n    'criacao'\r\n  )\r\n  if (permissionError) return permissionError\r\n\r\n  const payload = await readJson(request)\r\n  if (!payload) {\r\n    return Response.json({ error: 'Dados invalidos.' }, { status: 400 })\r\n  }\r\n\r\n  const coordenacao = String(payload.coordenacao || '').trim()\r\n  const equipe = String(payload.equipe || '').trim()\r\n  const cc = String(payload.cc || '').trim()\r\n  const execucao = String(payload.execucao || 'sim').trim().toLowerCase()\r\n\r\n  if (!coordenacao || !equipe || !cc) {\r\n    return Response.json(\r\n      { error: 'Coordenacao, equipe e CC sao obrigatorios.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n\r\n  if (execucao !== 'sim' && execucao !== 'nao') {\r\n    return Response.json({ error: 'Execucao invalida.' }, { status: 400 })\r\n  }\r\n\r\n  if (coordenacao.length > 20) {\r\n    return Response.json(\r\n      { error: 'Coordenacao deve ter no maximo 20 caracteres.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n  if (equipe.length > 10) {\r\n    return Response.json(\r\n      { error: 'Equipe deve ter no maximo 10 caracteres.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n  if (cc.length > 10) {\r\n    return Response.json(\r\n      { error: 'CC deve ter no maximo 10 caracteres.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n\r\n  const company = await env.DB.prepare(\r\n    'SELECT id, status FROM tb_company WHERE id = ?'\r\n  )\r\n    .bind(auth.company_id)\r\n    .first<CompanyRow>()\r\n\r\n  if (!company || company.status !== 'ativo') {\r\n    return Response.json({ error: 'Empresa invalida.' }, { status: 400 })\r\n  }\r\n\r\n  const conflict = await env.DB.prepare(\r\n    'SELECT id FROM tb_estrutura WHERE company_id = ? AND coordenacao = ? AND equipe = ?'\r\n  )\r\n    .bind(auth.company_id, coordenacao, equipe)\r\n    .first<{ id: string }>()\r\n\r\n  if (conflict) {\r\n    return Response.json({ error: 'Estrutura ja existe.' }, { status: 409 })\r\n  }\r\n\r\n  const estruturaId = crypto.randomUUID()\r\n  await env.DB.prepare(\r\n    `INSERT INTO tb_estrutura (id, company_id, coordenacao, equipe, cc, execucao, status, created_at)\r\n     VALUES (?, ?, ?, ?, ?, ?, 'ativo', datetime('now'))`\r\n  )\r\n    .bind(estruturaId, auth.company_id, coordenacao, equipe, cc, execucao)\r\n    .run()\r\n\r\n  const estrutura = await env.DB.prepare(\r\n    `SELECT id, company_id, coordenacao, equipe, cc, execucao, status, created_at\r\n     FROM tb_estrutura\r\n     WHERE id = ? AND company_id = ?`\r\n  )\r\n    .bind(estruturaId, auth.company_id)\r\n    .first<EstruturaRow>()\r\n\r\n  if (estrutura) {\r\n    await logEstruturaHistory(env, {\r\n      companyId: auth.company_id,\r\n      estruturaId: estrutura.id,\r\n      action: 'criado',\r\n      beforeData: null,\r\n      afterData: JSON.stringify({\r\n        coordenacao: estrutura.coordenacao,\r\n        equipe: estrutura.equipe,\r\n        cc: estrutura.cc,\r\n        execucao: estrutura.execucao,\r\n        status: estrutura.status\r\n      }),\r\n      changedByUserId: auth.user_id,\r\n      changedByName: auth.nome\r\n    })\r\n  }\r\n\r\n  return Response.json({ estrutura }, { status: 201 })\r\n}\r\n\r\nasync function handleUpdateEstrutura(request: Request, env: Env): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const payload = await readJson(request)\r\n  if (!payload) {\r\n    return Response.json({ error: 'Dados invalidos.' }, { status: 400 })\r\n  }\r\n\r\n  const id = String(payload.id || '').trim()\r\n  if (!id) {\r\n    return Response.json({ error: 'ID obrigatorio.' }, { status: 400 })\r\n  }\r\n\r\n  const coordenacao = payload.coordenacao\r\n    ? String(payload.coordenacao).trim()\r\n    : null\r\n  const equipe = payload.equipe ? String(payload.equipe).trim() : null\r\n  const cc = payload.cc ? String(payload.cc).trim() : null\r\n  const execucao = payload.execucao\r\n    ? String(payload.execucao).trim().toLowerCase()\r\n    : null\r\n  const status = payload.status ? normalizeStatus(String(payload.status)) : null\r\n\r\n  if (coordenacao && coordenacao.length > 20) {\r\n    return Response.json(\r\n      { error: 'Coordenacao deve ter no maximo 20 caracteres.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n  if (equipe && equipe.length > 10) {\r\n    return Response.json(\r\n      { error: 'Equipe deve ter no maximo 10 caracteres.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n  if (cc && cc.length > 10) {\r\n    return Response.json(\r\n      { error: 'CC deve ter no maximo 10 caracteres.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n  if (payload.execucao && execucao !== 'sim' && execucao !== 'nao') {\r\n    return Response.json({ error: 'Execucao invalida.' }, { status: 400 })\r\n  }\r\n  if (payload.status && !status) {\r\n    return Response.json({ error: 'Status invalido.' }, { status: 400 })\r\n  }\r\n\r\n  const existing = await env.DB.prepare(\r\n    `SELECT id, company_id, coordenacao, equipe, cc, execucao, status, created_at\r\n     FROM tb_estrutura WHERE id = ? AND company_id = ?`\r\n  )\r\n    .bind(id, auth.company_id)\r\n    .first<EstruturaRow>()\r\n\r\n  if (!existing) {\r\n    return Response.json({ error: 'Estrutura nao encontrada.' }, { status: 404 })\r\n  }\r\n\r\n  const isDelete = status === 'inativo' && existing.status !== 'inativo'\r\n  const permissionError = await requirePermission(\r\n    env,\r\n    auth,\r\n    'configuracao',\r\n    isDelete ? 'exclusao' : 'edicao'\r\n  )\r\n  if (permissionError) return permissionError\r\n\r\n  const nextCoordenacao = coordenacao ?? existing.coordenacao\r\n  const nextEquipe = equipe ?? existing.equipe\r\n  const shouldCheckUnique =\r\n    (coordenacao && coordenacao !== existing.coordenacao) ||\r\n    (equipe && equipe !== existing.equipe)\r\n\r\n  if (shouldCheckUnique) {\r\n    const conflict = await env.DB.prepare(\r\n      'SELECT id FROM tb_estrutura WHERE company_id = ? AND coordenacao = ? AND equipe = ? AND id != ?'\r\n    )\r\n      .bind(auth.company_id, nextCoordenacao, nextEquipe, id)\r\n      .first<{ id: string }>()\r\n\r\n    if (conflict) {\r\n      return Response.json({ error: 'Estrutura ja existe.' }, { status: 409 })\r\n    }\r\n  }\r\n\r\n  const updates: string[] = []\r\n  const values: Array<string | null> = []\r\n\r\n  if (coordenacao !== null && coordenacao !== existing.coordenacao) {\r\n    updates.push('coordenacao = ?')\r\n    values.push(coordenacao)\r\n  }\r\n  if (equipe !== null && equipe !== existing.equipe) {\r\n    updates.push('equipe = ?')\r\n    values.push(equipe)\r\n  }\r\n  if (cc !== null && cc !== existing.cc) {\r\n    updates.push('cc = ?')\r\n    values.push(cc)\r\n  }\r\n  if (execucao !== null && execucao !== existing.execucao) {\r\n    updates.push('execucao = ?')\r\n    values.push(execucao)\r\n  }\r\n  if (status !== null && status !== existing.status) {\r\n    updates.push('status = ?')\r\n    values.push(status)\r\n  }\r\n\r\n  if (!updates.length) {\r\n    if (status === 'excluido' && existing.status === 'excluido') {\r\n      return Response.json({ estrutura: existing })\r\n    }\r\n    return Response.json({ error: 'Nada para atualizar.' }, { status: 400 })\r\n  }\r\n\r\n  await env.DB.prepare(\r\n    `UPDATE tb_estrutura SET ${updates.join(', ')} WHERE id = ? AND company_id = ?`\r\n  )\r\n    .bind(...values, id, auth.company_id)\r\n    .run()\r\n\r\n  const estrutura = await env.DB.prepare(\r\n    `SELECT id, company_id, coordenacao, equipe, cc, execucao, status, created_at\r\n     FROM tb_estrutura\r\n     WHERE id = ? AND company_id = ?`\r\n  )\r\n    .bind(id, auth.company_id)\r\n    .first<EstruturaRow>()\r\n\r\n  if (estrutura) {\r\n    await logEstruturaHistory(env, {\r\n      companyId: auth.company_id,\r\n      estruturaId: estrutura.id,\r\n      action: 'atualizado',\r\n      beforeData: JSON.stringify({\r\n        coordenacao: existing.coordenacao,\r\n        equipe: existing.equipe,\r\n        cc: existing.cc,\r\n        execucao: existing.execucao,\r\n        status: existing.status\r\n      }),\r\n      afterData: JSON.stringify({\r\n        coordenacao: estrutura.coordenacao,\r\n        equipe: estrutura.equipe,\r\n        cc: estrutura.cc,\r\n        execucao: estrutura.execucao,\r\n        status: estrutura.status\r\n      }),\r\n      changedByUserId: auth.user_id,\r\n      changedByName: auth.nome\r\n    })\r\n  }\r\n\r\n  return Response.json({ estrutura })\r\n}\r\n\r\nasync function handleEstruturaHistory(\n  request: Request,\n  env: Env\n): Promise<Response> {\n  assertJwtSecret(env)\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n  const permissionError = await requirePermission(\r\n    env,\r\n    auth,\r\n    'configuracao',\r\n    'leitura'\r\n  )\r\n  if (permissionError) return permissionError\r\n\r\n  const url = new URL(request.url)\r\n  const estruturaId = url.searchParams.get('estrutura_id')\r\n  if (!estruturaId) {\r\n    return Response.json({ error: 'estrutura_id obrigatorio.' }, { status: 400 })\r\n  }\r\n\r\n  const result = await env.DB.prepare(\r\n    `SELECT id, company_id, estrutura_id, action, before_data, after_data, changed_by_user_id, changed_by_name, created_at\r\n     FROM tb_estrutura_history\r\n     WHERE company_id = ? AND estrutura_id = ?\r\n     ORDER BY created_at DESC`\r\n  )\r\n    .bind(auth.company_id, estruturaId)\r\n    .all<EstruturaHistoryRow>()\r\n\r\n  return Response.json({ history: result.results })\n}\n\nasync function handleListParametros(\n  request: Request,\n  env: Env\n): Promise<Response> {\n  assertJwtSecret(env)\n  const auth = await requireAuth(request, env)\n  if (!auth) {\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\n  }\n  const permissionError = await requirePermission(\n    env,\n    auth,\n    'configuracao',\n    'leitura'\n  )\n  if (permissionError) return permissionError\n\n  await ensureParametrosTable(env)\n\n  const url = new URL(request.url)\n  const conditions: string[] = ['company_id = ?']\n  const values: Array<string | number> = [auth.company_id]\n\n  const tipoParam = url.searchParams.get('tipo_parametro')\n  if (tipoParam && PARAMETRO_TIPOS.includes(tipoParam as ParametroCadastroAtivoType)) {\n    conditions.push('tipo_parametro = ?')\n    values.push(tipoParam)\n  }\n\n  const ativoParam = parseBooleanFlag(url.searchParams.get('ativo'))\n  if (ativoParam !== null) {\n    conditions.push('ativo = ?')\n    values.push(ativoParam)\n  }\n\n  const result = await env.DB.prepare(\n    `SELECT id_parametro, company_id, tipo_parametro, valor, ativo, ordem, observacao, created_at, updated_at\n     FROM tb_parametro\n     WHERE ${conditions.join(' AND ')}\n     ORDER BY tipo_parametro ASC, ordem IS NULL, ordem ASC`\n  )\n    .bind(...values)\n    .all<ParametroCadastroAtivoRow>()\n\n  return Response.json({ parametros: result.results })\n}\n\nasync function handleCreateParametro(\n  request: Request,\n  env: Env\n): Promise<Response> {\n  assertJwtSecret(env)\n  const auth = await requireAuth(request, env)\n  if (!auth) {\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\n  }\n  const permissionError = await requirePermission(\n    env,\n    auth,\n    'configuracao',\n    'criacao'\n  )\n  if (permissionError) return permissionError\n\n  await ensureParametrosTable(env)\n\n  const payload = await readJson(request)\n  if (!payload) {\n    return Response.json({ error: 'Dados invalidos.' }, { status: 400 })\n  }\n\n  const tipoParametro = String(payload.tipo_parametro || '').trim()\n  if (!PARAMETRO_TIPOS.includes(tipoParametro as ParametroCadastroAtivoType)) {\n    return Response.json({ error: 'Tipo de parametro invalido.' }, { status: 400 })\n  }\n\n  const valor = String(payload.valor || '').trim()\n  if (!valor) {\n    return Response.json({ error: 'Valor obrigatorio.' }, { status: 400 })\n  }\n\n  const ativoFlag = parseBooleanFlag(payload.ativo)\n  const ativoValue = ativoFlag === null ? 1 : ativoFlag\n  const ordemValue = payload.ordem !== undefined ? parseNullableNumber(payload.ordem) : null\n  const observacaoValue =\n    payload.observacao !== undefined\n      ? String(payload.observacao).trim() || null\n      : null\n\n  const duplicate = await env.DB\n    .prepare(\n      `SELECT id_parametro\n       FROM tb_parametro\n       WHERE company_id = ? AND tipo_parametro = ? AND valor = ?`\n    )\n    .bind(auth.company_id, tipoParametro, valor)\n    .first<{ id_parametro: string }>()\n\n  if (duplicate) {\n    return Response.json({ error: 'Parametro ja existe.' }, { status: 409 })\n  }\n\n  const idParametro = crypto.randomUUID()\n  await env.DB.prepare(\n    `INSERT INTO tb_parametro (\n      id_parametro,\n      company_id,\n      tipo_parametro,\n      valor,\n      ativo,\n      ordem,\n      observacao,\n      created_at,\n      updated_at\n    ) VALUES (?, ?, ?, ?, ?, ?, ?, datetime('now'), datetime('now'))`\n  )\n    .bind(\n      idParametro,\n      auth.company_id,\n      tipoParametro,\n      valor,\n      ativoValue,\n      ordemValue,\n      observacaoValue\n    )\n    .run()\n\n  const inserted = await env.DB\n    .prepare(\n      `SELECT id_parametro, company_id, tipo_parametro, valor, ativo, ordem, observacao, created_at, updated_at\n       FROM tb_parametro\n       WHERE id_parametro = ?`\n    )\n    .bind(idParametro)\n    .first<ParametroCadastroAtivoRow>()\n\n  return Response.json({ parametro: inserted }, { status: 201 })\n}\n\nasync function handleUpdateParametro(\n  request: Request,\n  env: Env\n): Promise<Response> {\n  assertJwtSecret(env)\n  const auth = await requireAuth(request, env)\n  if (!auth) {\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\n  }\n  const permissionError = await requirePermission(\n    env,\n    auth,\n    'configuracao',\n    'edicao'\n  )\n  if (permissionError) return permissionError\n\n  await ensureParametrosTable(env)\n\n  const payload = await readJson(request)\n  if (!payload) {\n    return Response.json({ error: 'Dados invalidos.' }, { status: 400 })\n  }\n\n  const idParametro = String(payload.id_parametro || '').trim()\n  if (!idParametro) {\n    return Response.json({ error: 'id_parametro obrigatorio.' }, { status: 400 })\n  }\n\n  const existing = await env.DB\n    .prepare(\n      `SELECT id_parametro\n       FROM tb_parametro\n       WHERE id_parametro = ? AND company_id = ?`\n    )\n    .bind(idParametro, auth.company_id)\n    .first<{ id_parametro: string }>()\n\n  if (!existing) {\n    return Response.json({ error: 'Parametro nao encontrado.' }, { status: 404 })\n  }\n\n  const updates: string[] = []\n  const values: Array<string | number | null> = []\n\n  if (payload.valor !== undefined) {\n    const valor = String(payload.valor || '').trim()\n    if (!valor) {\n      return Response.json({ error: 'Valor obrigatorio.' }, { status: 400 })\n    }\n    updates.push('valor = ?')\n    values.push(valor)\n  }\n\n  const ativoParam = payload.ativo === undefined ? null : parseBooleanFlag(payload.ativo)\n  if (ativoParam !== null) {\n    updates.push('ativo = ?')\n    values.push(ativoParam)\n  }\n\n  if (payload.ordem !== undefined) {\n    updates.push('ordem = ?')\n    values.push(parseNullableNumber(payload.ordem))\n  }\n\n  if (payload.observacao !== undefined) {\n    const observacao = String(payload.observacao).trim()\n    updates.push('observacao = ?')\n    values.push(observacao || null)\n  }\n\n  if (!updates.length) {\n    return Response.json({ error: 'Nada para atualizar.' }, { status: 400 })\n  }\n\n  updates.push(\"updated_at = datetime('now')\")\n\n  const query = `UPDATE tb_parametro SET ${updates.join(', ')} WHERE id_parametro = ?`\n  values.push(idParametro)\n\n  await env.DB.prepare(query).bind(...values).run()\n\n  const updated = await env.DB\n    .prepare(\n      `SELECT id_parametro, company_id, tipo_parametro, valor, ativo, ordem, observacao, created_at, updated_at\n       FROM tb_parametro\n       WHERE id_parametro = ?`\n    )\n    .bind(idParametro)\n    .first<ParametroCadastroAtivoRow>()\n\n  return Response.json({ parametro: updated })\n}\n\nasync function handleListAtivos(request: Request, env: Env): Promise<Response> {\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const url = new URL(request.url)\r\n  const conditions: string[] = ['company_id = ?']\r\n  const values: Array<string> = [auth.company_id]\r\n\r\n  const applyFilter = (param: string | null, column: string) => {\r\n    if (!param) return\r\n    conditions.push(`${column} LIKE ?`)\r\n    values.push(`%${param.trim()}%`)\r\n  }\r\n\r\n  applyFilter(url.searchParams.get('codpe'), 'ATIVO_CODPE')\r\n  applyFilter(url.searchParams.get('descritivo'), 'ATIVO_DESCRITIVO_OS')\r\n  applyFilter(url.searchParams.get('equipe'), 'ATIVO_EQUIPE')\r\n  applyFilter(url.searchParams.get('ciclo'), 'ATIVO_CICLO')\r\n  applyFilter(url.searchParams.get('sigla'), 'ATIVO_SIGLA')\r\n  applyFilter(url.searchParams.get('monitorados'), 'ATIVO_MONITORADOS')\r\n  applyFilter(url.searchParams.get('ultima_manut'), 'ATIVO_ULTIMA_MANUT')\r\n\r\n  const result = await env.DB.prepare(\r\n    `SELECT id,\r\n            ATIVO_CODPE,\r\n            ATIVO_DESCRITIVO_OS,\r\n            ATIVO_COORDENACAO,\r\n            ATIVO_EQUIPE,\r\n            ATIVO_CICLO,\r\n            ATIVO_SIGLA,\r\n            ATIVO_MONITORADOS,\r\n            ATIVO_ULTIMA_MANUT,\r\n            ATIVO_STATUS\r\n     FROM tb_ativo\r\n     WHERE ${conditions.join(' AND ')}\r\n     ORDER BY ATIVO_CODPE ASC`\r\n  )\r\n    .bind(...values)\r\n    .all<AtivoRow>()\r\n\r\n  return Response.json({ ativos: result.results })\r\n}\r\n\r\nasync function handleListComponentes(\r\n  request: Request,\r\n  env: Env\r\n): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n  const permissionError = await requirePermission(\r\n    env,\r\n    auth,\r\n    'componentes',\r\n    'leitura'\r\n  )\r\n  if (permissionError) return permissionError\r\n\r\n  const url = new URL(request.url)\r\n  const conditions: string[] = ['c.company_id = ?']\r\n  const values: Array<string> = [auth.company_id]\r\n\r\n  const applyFilter = (param: string | null, column: string) => {\r\n    if (!param) return\r\n    conditions.push(`${column} LIKE ?`)\r\n    values.push(`%${param.trim()}%`)\r\n  }\r\n\r\n  applyFilter(url.searchParams.get('codpe'), 'a.ATIVO_CODPE')\r\n  applyFilter(url.searchParams.get('descritivo'), 'a.ATIVO_DESCRITIVO_OS')\r\n  applyFilter(url.searchParams.get('nome'), 'c.COMP_NOME')\r\n  applyFilter(url.searchParams.get('modelo'), 'c.COMP_MODELO')\r\n  applyFilter(url.searchParams.get('serial'), 'c.COMP_SERIAL')\r\n\r\n  const result = await env.DB.prepare(\r\n    `SELECT c.IDCOMPONETE,\r\n            c.company_id,\r\n            c.IDATIVO,\r\n            c.COMP_NOME,\r\n            c.COMP_SERIAL,\r\n            c.COMP_DATA,\r\n            c.COMP_MODELO,\r\n            c.COMP_DESCRICAO,\r\n            a.ATIVO_CODPE,\r\n            a.ATIVO_DESCRITIVO_OS,\r\n            a.ATIVO_SIGLA,\r\n            a.ATIVO_COORDENACAO,\r\n            a.ATIVO_EQUIPE\r\n     FROM tb_componente c\r\n     LEFT JOIN tb_ativo a ON a.id = c.IDATIVO AND a.company_id = c.company_id\r\n     WHERE ${conditions.join(' AND ')}\r\n     ORDER BY c.IDCOMPONETE DESC`\r\n  )\r\n    .bind(...values)\r\n    .all<ComponenteListRow>()\r\n\r\n  return Response.json({ componentes: result.results })\r\n}\r\n\r\nasync function handleGetComponenteDetail(\r\n  request: Request,\r\n  env: Env\r\n): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const permissionError = await requirePermission(\r\n    env,\r\n    auth,\r\n    'componentes',\r\n    'leitura'\r\n  )\r\n  if (permissionError) return permissionError\r\n\r\n  const url = new URL(request.url)\r\n  const idParam = url.searchParams.get('id')\r\n  if (!idParam) {\r\n    return Response.json(\r\n      { error: 'component_id obrigatorio.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n\r\n  const componentId = Number(idParam)\r\n  if (!Number.isFinite(componentId)) {\r\n    return Response.json({ error: 'ID invalido.' }, { status: 400 })\r\n  }\r\n\r\n  const componente = await fetchComponenteWithAsset(\r\n    env,\r\n    auth.company_id,\r\n    componentId\r\n  )\r\n\r\n  if (!componente) {\r\n    return Response.json({ error: 'Componente nao encontrado.' }, { status: 404 })\r\n  }\r\n\r\n  return Response.json({ componente })\r\n}\r\n\r\nasync function handleCreateComponente(\r\n  request: Request,\r\n  env: Env\r\n): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const permissionError = await requirePermission(\r\n    env,\r\n    auth,\r\n    'componentes',\r\n    'criacao'\r\n  )\r\n  if (permissionError) return permissionError\r\n\r\n  const payload = await readJson(request)\r\n  if (!payload) {\r\n    return Response.json({ error: 'Dados invalidos.' }, { status: 400 })\r\n  }\r\n\r\n  const idAtivo = String(payload.IDATIVO ?? '').trim()\r\n  const nome = String(payload.COMP_NOME ?? '').trim()\r\n  const modelo = String(payload.COMP_MODELO ?? '').trim()\r\n  const serial =\r\n    payload.COMP_SERIAL !== undefined && payload.COMP_SERIAL !== null\r\n      ? String(payload.COMP_SERIAL).trim()\r\n      : null\r\n  const data =\r\n    payload.COMP_DATA !== undefined && payload.COMP_DATA !== null\r\n      ? String(payload.COMP_DATA).trim()\r\n      : null\r\n  const descricao =\r\n    payload.COMP_DESCRICAO !== undefined && payload.COMP_DESCRICAO !== null\r\n      ? String(payload.COMP_DESCRICAO).trim()\r\n      : null\r\n\r\n  if (!idAtivo || !nome || !modelo) {\r\n    return Response.json(\r\n      { error: 'IDATIVO, COMP_NOME e COMP_MODELO sao obrigatorios.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n\r\n  const ativo = await env.DB.prepare(\r\n    'SELECT id FROM tb_ativo WHERE company_id = ? AND (id = ? OR ATIVO_CODPE = ?)'\r\n  )\r\n    .bind(auth.company_id, idAtivo, idAtivo)\r\n    .first<{ id: string }>()\r\n\r\n  if (!ativo) {\r\n    return Response.json({ error: 'Ativo invalido.' }, { status: 400 })\r\n  }\r\n\r\n  const insert = await env.DB.prepare(\r\n    `INSERT INTO tb_componente (company_id, IDATIVO, COMP_NOME, COMP_SERIAL, COMP_DATA, COMP_MODELO, COMP_DESCRICAO)\r\n     VALUES (?, ?, ?, ?, ?, ?, ?)`\r\n  )\r\n    .bind(\r\n      auth.company_id,\r\n      ativo.id,\r\n      nome,\r\n      serial || null,\r\n      data || null,\r\n      modelo,\r\n      descricao || null\r\n    )\r\n    .run()\r\n\r\n  const componentId = Number(insert.meta.last_insert_rowid ?? 0)\r\n  if (!componentId) {\r\n    return Response.json(\r\n      { error: 'Nao foi possivel criar o componente.' },\r\n      { status: 500 }\r\n    )\r\n  }\r\n\r\n  const componente = await fetchComponenteWithAsset(\r\n    env,\r\n    auth.company_id,\r\n    componentId\r\n  )\r\n\r\n  if (!componente) {\r\n    return Response.json(\r\n      { error: 'Componente criado, mas nao foi possivel recuperar os dados.' },\r\n      { status: 500 }\r\n    )\r\n  }\r\n\r\n  return Response.json({ componente })\r\n}\r\n\r\nasync function handleUpdateComponente(\r\n  request: Request,\r\n  env: Env\r\n): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const permissionError = await requirePermission(\r\n    env,\r\n    auth,\r\n    'componentes',\r\n    'edicao'\r\n  )\r\n  if (permissionError) return permissionError\r\n\r\n  const payload = await readJson(request)\r\n  if (!payload) {\r\n    return Response.json({ error: 'Dados invalidos.' }, { status: 400 })\r\n  }\r\n\r\n  const componentId = Number(payload.IDCOMPONETE ?? '')\r\n  if (!Number.isFinite(componentId)) {\r\n    return Response.json({ error: 'IDCOMPONETE obrigatorio.' }, { status: 400 })\r\n  }\r\n\r\n  const existing = await env.DB\r\n    .prepare(\r\n      `SELECT IDCOMPONETE,\r\n              company_id,\r\n              IDATIVO,\r\n              COMP_NOME,\r\n              COMP_SERIAL,\r\n              COMP_DATA,\r\n              COMP_MODELO,\r\n              COMP_DESCRICAO\r\n       FROM tb_componente\r\n       WHERE IDCOMPONETE = ? AND company_id = ?`\r\n    )\r\n    .bind(componentId, auth.company_id)\r\n    .first<ComponenteRow>()\r\n\r\n  if (!existing) {\r\n    return Response.json({ error: 'Componente nao encontrado.' }, { status: 404 })\r\n  }\r\n\r\n  const nome = String(payload.COMP_NOME ?? existing.COMP_NOME ?? '').trim()\r\n  const modelo = String(payload.COMP_MODELO ?? existing.COMP_MODELO ?? '').trim()\r\n  if (!nome || !modelo) {\r\n    return Response.json(\r\n      { error: 'COMP_NOME e COMP_MODELO sao obrigatorios.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n\r\n  const serial =\r\n    payload.COMP_SERIAL !== undefined\r\n      ? payload.COMP_SERIAL === null\r\n        ? null\r\n        : String(payload.COMP_SERIAL).trim()\r\n      : existing.COMP_SERIAL\r\n  const data =\r\n    payload.COMP_DATA !== undefined\r\n      ? payload.COMP_DATA === null\r\n        ? null\r\n        : String(payload.COMP_DATA).trim()\r\n      : existing.COMP_DATA\r\n  const descricao =\r\n    payload.COMP_DESCRICAO !== undefined\r\n      ? payload.COMP_DESCRICAO === null\r\n        ? null\r\n        : String(payload.COMP_DESCRICAO).trim()\r\n      : existing.COMP_DESCRICAO\r\n  const ativoInput = String(payload.IDATIVO ?? existing.IDATIVO ?? '').trim()\r\n  if (!ativoInput) {\r\n    return Response.json({ error: 'IDATIVO obrigatorio.' }, { status: 400 })\r\n  }\r\n\r\n  const ativo = await env.DB\r\n    .prepare(\r\n      `SELECT id\r\n       FROM tb_ativo\r\n       WHERE company_id = ? AND (id = ? OR ATIVO_CODPE = ?)`\r\n    )\r\n    .bind(auth.company_id, ativoInput, ativoInput)\r\n    .first<{ id: string }>()\r\n\r\n  if (!ativo) {\r\n    return Response.json({ error: 'Ativo invalido.' }, { status: 400 })\r\n  }\r\n\r\n  const updates = [\r\n    'IDATIVO = ?',\r\n    'COMP_NOME = ?',\r\n    'COMP_SERIAL = ?',\r\n    'COMP_DATA = ?',\r\n    'COMP_MODELO = ?',\r\n    'COMP_DESCRICAO = ?'\r\n  ]\r\n  const values = [\r\n    ativo.id,\r\n    nome,\r\n    serial || null,\r\n    data || null,\r\n    modelo,\r\n    descricao || null,\r\n    componentId,\r\n    auth.company_id\r\n  ]\r\n\r\n  const changedFields: Array<{ label: string; before: string; after: string }> = []\r\n  const diff = (\r\n    label: string,\r\n    beforeValue: string | null | undefined,\r\n    afterValue: string | null | undefined\r\n  ) => {\r\n    const before = beforeValue ?? ''\r\n    const after = afterValue ?? ''\r\n    if (before !== after) {\r\n      changedFields.push({ label, before, after })\r\n    }\r\n  }\r\n\r\n  diff('Componente', existing.COMP_NOME, nome)\r\n  diff('Modelo', existing.COMP_MODELO, modelo)\r\n  diff('Serial', existing.COMP_SERIAL, serial)\r\n  diff('Instala\u00E7\u00E3o', existing.COMP_DATA, data)\r\n  diff('Descri\u00E7\u00E3o', existing.COMP_DESCRICAO, descricao)\r\n\r\n  if (!changedFields.length) {\r\n    return Response.json(\r\n      { error: 'Nenhuma altera\u00E7\u00E3o detectada.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n\r\n  await env.DB\r\n    .prepare(\r\n      `UPDATE tb_componente\r\n       SET ${updates.join(', ')}\r\n       WHERE IDCOMPONETE = ? AND company_id = ?`\r\n    )\r\n    .bind(...values)\r\n    .run()\r\n\r\n  const now = new Date().toISOString()\r\n  const resumo = changedFields\r\n    .map(change => {\r\n      const beforeValue = change.before || '-'\r\n      const afterValue = change.after || '-'\r\n      return `${change.label}: ${beforeValue} -> ${afterValue}`\r\n    })\r\n    .join(' | ')\r\n\r\n  await env.DB.prepare(\r\n    `INSERT INTO tb_componente_alteracao (\r\n       company_id,\r\n       IDCOMPONETE,\r\n       usuario_id,\r\n       data_hora,\r\n       campos_alterados\r\n     ) VALUES (?, ?, ?, ?, ?)`\r\n  )\r\n    .bind(auth.company_id, componentId, auth.user_id, now, resumo)\r\n    .run()\r\n\r\n  const componente = await fetchComponenteWithAsset(\r\n    env,\r\n    auth.company_id,\r\n    componentId\r\n  )\r\n\r\n  if (!componente) {\r\n    return Response.json(\r\n      { error: 'Componente atualizado, mas nao foi possivel recuperar os dados.' },\r\n      { status: 500 }\r\n    )\r\n  }\r\n\r\n  return Response.json({ componente })\r\n}\r\n\r\nasync function handleComponentesMaintenanceHistory(\r\n  request: Request,\r\n  env: Env\r\n): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const permissionError = await requirePermission(\r\n    env,\r\n    auth,\r\n    'componentes',\r\n    'leitura'\r\n  )\r\n  if (permissionError) return permissionError\r\n\r\n  const url = new URL(request.url)\r\n  const componentId = Number(url.searchParams.get('component_id') ?? '')\r\n  if (!Number.isFinite(componentId)) {\r\n    return Response.json({ error: 'component_id obrigatorio.' }, { status: 400 })\r\n  }\r\n\r\n  const result = await env.DB.prepare(\r\n    `SELECT id, company_id, hist_manut_id_componente, hist_manut_data_hora, hist_manut_id_os, created_at\r\n     FROM tb_componente_manutencao\r\n     WHERE company_id = ? AND hist_manut_id_componente = ?\r\n     ORDER BY hist_manut_data_hora DESC`\r\n  )\r\n    .bind(auth.company_id, componentId)\r\n    .all<ComponenteMaintenanceRow>()\r\n\r\n  return Response.json({ history: result.results })\r\n}\r\n\r\nasync function handleComponentesChangeHistory(\r\n  request: Request,\r\n  env: Env\r\n): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const permissionError = await requirePermission(\r\n    env,\r\n    auth,\r\n    'componentes',\r\n    'leitura'\r\n  )\r\n  if (permissionError) return permissionError\r\n\r\n  const url = new URL(request.url)\r\n  const componentId = Number(url.searchParams.get('component_id') ?? '')\r\n  if (!Number.isFinite(componentId)) {\r\n    return Response.json({ error: 'component_id obrigatorio.' }, { status: 400 })\r\n  }\r\n\r\n  const result = await env.DB.prepare(\r\n    `SELECT id, company_id, IDCOMPONETE, usuario_id, data_hora, campos_alterados, created_at\r\n     FROM tb_componente_alteracao\r\n     WHERE company_id = ? AND IDCOMPONETE = ?\r\n     ORDER BY data_hora DESC`\r\n  )\r\n    .bind(auth.company_id, componentId)\r\n    .all<ComponenteChangeRow>()\r\n\r\n  return Response.json({ history: result.results })\r\n}\r\n\r\nasync function handleListNotas(\r\n  request: Request,\r\n  env: Env\r\n): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n  const permissionError = await requirePermission(env, auth, 'notas', 'leitura')\r\n  if (permissionError) return permissionError\r\n\r\n  const url = new URL(request.url)\r\n  const conditions: string[] = ['n.company_id = ?']\r\n  const values: Array<string> = [auth.company_id]\r\n\r\n  const search = url.searchParams.get('search')\r\n  if (search) {\r\n    const term = `%${search.trim()}%`\r\n    conditions.push(\r\n      `(a.ATIVO_CODPE LIKE ? OR a.ATIVO_DESCRITIVO_OS LIKE ? OR n.nota_pendencia LIKE ?)`\r\n    )\r\n    values.push(term, term, term)\r\n  }\r\n\r\n  const status = normalizeNotaStatus(url.searchParams.get('status'))\r\n  if (status) {\r\n    conditions.push('n.nota_status = ?')\r\n    values.push(status)\r\n  }\r\n\r\n  const result = await env.DB.prepare(\r\n    `SELECT n.IDNOTA,\r\n            n.company_id,\r\n            n.id_ativo,\r\n            n.id_os,\r\n            n.nota_pendencia,\r\n            n.nota_status,\r\n            n.nota_data_criada,\r\n            n.nota_data_programada,\r\n            n.nota_data_realizada,\r\n            n.nota_observacao_pcm,\r\n            n.nota_observacao_tecnico,\r\n            a.ATIVO_CODPE,\r\n            a.ATIVO_DESCRITIVO_OS\r\n     FROM tb_nota n\r\n     LEFT JOIN tb_ativo a ON a.id = n.id_ativo AND a.company_id = n.company_id\r\n     WHERE ${conditions.join(' AND ')}\r\n     ORDER BY n.nota_data_criada DESC`\r\n  )\r\n    .bind(...values)\r\n    .all<NotaListRow>()\r\n\r\n  return Response.json({ notas: result.results })\r\n}\r\n\r\nasync function handleGetNotaDetail(\r\n  request: Request,\r\n  env: Env\r\n): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const permissionError = await requirePermission(env, auth, 'notas', 'leitura')\r\n  if (permissionError) return permissionError\r\n\r\n  const url = new URL(request.url)\r\n  const idParam = url.searchParams.get('id')\r\n  if (!idParam) {\r\n    return Response.json({ error: 'nota_id obrigatorio.' }, { status: 400 })\r\n  }\r\n  const notaId = Number(idParam)\r\n  if (!Number.isFinite(notaId)) {\r\n    return Response.json({ error: 'ID invalido.' }, { status: 400 })\r\n  }\r\n\r\n  const nota = await fetchNotaWithAsset(env, auth.company_id, notaId)\r\n  if (!nota) {\r\n    return Response.json({ error: 'Nota nao encontrada.' }, { status: 404 })\r\n  }\r\n\r\n  return Response.json({ nota })\r\n}\r\n\r\nasync function handleNotaChangeHistory(\r\n  request: Request,\r\n  env: Env\r\n): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const permissionError = await requirePermission(env, auth, 'notas', 'leitura')\r\n  if (permissionError) return permissionError\r\n\r\n  const url = new URL(request.url)\r\n  const notaId = Number(url.searchParams.get('nota_id') ?? '')\r\n  if (!Number.isFinite(notaId)) {\r\n    return Response.json({ error: 'nota_id obrigatorio.' }, { status: 400 })\r\n  }\r\n\r\n  const result = await env.DB.prepare(\r\n    `SELECT id, company_id, IDNOTA, usuario_id, data_hora, campos_alterados, created_at\r\n     FROM tb_nota_alteracao\r\n     WHERE company_id = ? AND IDNOTA = ?\r\n     ORDER BY data_hora DESC`\r\n  )\r\n    .bind(auth.company_id, notaId)\r\n    .all<NotaChangeRow>()\r\n\r\n  return Response.json({ history: result.results })\r\n}\r\n\r\nasync function handleCreateNotas(\r\n  request: Request,\r\n  env: Env\r\n): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const permissionError = await requirePermission(env, auth, 'notas', 'criacao')\r\n  if (permissionError) return permissionError\r\n\r\n  const payload = await readJson(request)\r\n  if (!payload) {\r\n    return Response.json({ error: 'Dados invalidos.' }, { status: 400 })\r\n  }\r\n\r\n  const ativosInput = Array.isArray(payload.ativos)\r\n    ? payload.ativos.map(value => String(value ?? '').trim())\r\n    : []\r\n  if (!ativosInput.length && payload.IDATIVO) {\r\n    ativosInput.push(String(payload.IDATIVO).trim())\r\n  }\r\n  const ativos = ativosInput.filter(Boolean)\r\n\r\n  const pendencia = String(payload.nota_pendencia ?? '').trim()\r\n  const status = normalizeNotaStatus(payload.nota_status)\r\n  if (!ativos.length || !pendencia || !status) {\r\n    return Response.json(\r\n      { error: 'Ativo, pendencia e status sao obrigatorios.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n\r\n  const idOs =\r\n    payload.id_os !== undefined && payload.id_os !== null\r\n      ? String(payload.id_os).trim()\r\n      : null\r\n  const descricaoPcm =\r\n    payload.nota_observacao_pcm !== undefined && payload.nota_observacao_pcm !== null\r\n      ? String(payload.nota_observacao_pcm).trim()\r\n      : null\r\n  const descricaoTecnico =\r\n    payload.nota_observacao_tecnico !== undefined &&\r\n    payload.nota_observacao_tecnico !== null\r\n      ? String(payload.nota_observacao_tecnico).trim()\r\n      : null\r\n  const dataProgramada =\r\n    payload.nota_data_programada !== undefined &&\r\n    payload.nota_data_programada !== null\r\n      ? String(payload.nota_data_programada).trim()\r\n      : null\r\n  const dataRealizada =\r\n    payload.nota_data_realizada !== undefined &&\r\n    payload.nota_data_realizada !== null\r\n      ? String(payload.nota_data_realizada).trim()\r\n      : null\r\n\r\n  const noteStmt = env.DB.prepare(\r\n    `INSERT INTO tb_nota (\r\n       company_id,\r\n       id_ativo,\r\n       id_os,\r\n       nota_pendencia,\r\n       nota_status,\r\n       nota_data_programada,\r\n       nota_data_realizada,\r\n       nota_observacao_pcm,\r\n       nota_observacao_tecnico\r\n     ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)`\r\n  )\r\n\r\n  const created: NotaListRow[] = []\r\n  for (const ativoCodpe of ativos) {\r\n    if (!ativoCodpe) continue\r\n    const ativo = await env.DB\r\n      .prepare(\r\n        `SELECT id FROM tb_ativo WHERE company_id = ? AND (id = ? OR ATIVO_CODPE = ?)`\r\n      )\r\n      .bind(auth.company_id, ativoCodpe, ativoCodpe)\r\n      .first<{ id: string }>()\r\n\r\n    if (!ativo) {\r\n      return Response.json({ error: `Ativo ${ativoCodpe} invalido.` }, { status: 400 })\r\n    }\r\n\r\n    const result = await noteStmt\r\n      .bind(\r\n        auth.company_id,\r\n        ativo.id,\r\n        idOs || null,\r\n        pendencia,\r\n        status,\r\n        dataProgramada || null,\r\n        dataRealizada || null,\r\n        descricaoPcm || null,\r\n        descricaoTecnico || null\r\n      )\r\n      .run()\r\n    const notaId = Number(result.meta.last_insert_rowid ?? 0)\r\n    if (!notaId) continue\r\n    const record = await fetchNotaWithAsset(env, auth.company_id, notaId)\r\n    if (record) {\r\n      created.push(record)\r\n    }\r\n  }\r\n\r\n  if (!created.length) {\r\n    return Response.json(\r\n      { error: 'Nao foi possivel criar as notas.' },\r\n      { status: 500 }\r\n    )\r\n  }\r\n\r\n  return Response.json({ notas: created })\r\n}\r\n\r\nasync function handleUpdateNota(\r\n  request: Request,\r\n  env: Env\r\n): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const permissionError = await requirePermission(env, auth, 'notas', 'edicao')\r\n  if (permissionError) return permissionError\r\n\r\n  const payload = await readJson(request)\r\n  if (!payload) {\r\n    return Response.json({ error: 'Dados invalidos.' }, { status: 400 })\r\n  }\r\n\r\n  const notaId = Number(payload.IDNOTA ?? '')\r\n  if (!Number.isFinite(notaId)) {\r\n    return Response.json({ error: 'IDNOTA obrigatorio.' }, { status: 400 })\r\n  }\r\n\r\n  const existing = await env.DB\r\n    .prepare(\r\n      `SELECT IDNOTA,\r\n              company_id,\r\n              id_ativo,\r\n              id_os,\r\n              nota_pendencia,\r\n              nota_status,\r\n              nota_data_programada,\r\n              nota_data_realizada,\r\n              nota_observacao_pcm,\r\n              nota_observacao_tecnico\r\n       FROM tb_nota\r\n       WHERE IDNOTA = ? AND company_id = ?`\r\n    )\r\n    .bind(notaId, auth.company_id)\r\n    .first<NotaRow>()\r\n\r\n  if (!existing) {\r\n    return Response.json({ error: 'Nota nao encontrada.' }, { status: 404 })\r\n  }\r\n\r\n  const pendencia = String(payload.nota_pendencia ?? existing.nota_pendencia ?? '').trim()\r\n  const status = normalizeNotaStatus(\r\n    payload.nota_status ?? existing.nota_status\r\n  )\r\n  if (!pendencia || !status) {\r\n    return Response.json(\r\n      { error: 'Pendencia e status sao obrigatorios.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n\r\n  const idOs =\r\n    payload.id_os !== undefined\r\n      ? payload.id_os === null\r\n        ? null\r\n        : String(payload.id_os).trim()\r\n      : existing.id_os\r\n  const descricaoPcm =\r\n    payload.nota_observacao_pcm !== undefined\r\n      ? payload.nota_observacao_pcm === null\r\n        ? null\r\n        : String(payload.nota_observacao_pcm).trim()\r\n      : existing.nota_observacao_pcm\r\n  const descricaoTecnico =\r\n    payload.nota_observacao_tecnico !== undefined\r\n      ? payload.nota_observacao_tecnico === null\r\n        ? null\r\n        : String(payload.nota_observacao_tecnico).trim()\r\n      : existing.nota_observacao_tecnico\r\n  const dataProgramada =\r\n    payload.nota_data_programada !== undefined\r\n      ? payload.nota_data_programada === null\r\n        ? null\r\n        : String(payload.nota_data_programada).trim()\r\n      : existing.nota_data_programada\r\n  const dataRealizada =\r\n    payload.nota_data_realizada !== undefined\r\n      ? payload.nota_data_realizada === null\r\n        ? null\r\n        : String(payload.nota_data_realizada).trim()\r\n      : existing.nota_data_realizada\r\n  const ativoInput = String(payload.IDATIVO ?? existing.id_ativo ?? '').trim()\r\n  if (!ativoInput) {\r\n    return Response.json({ error: 'IDATIVO obrigatorio.' }, { status: 400 })\r\n  }\r\n\r\n  const ativo = await env.DB\r\n    .prepare(\r\n      `SELECT id\r\n       FROM tb_ativo\r\n       WHERE company_id = ? AND (id = ? OR ATIVO_CODPE = ?)`\r\n    )\r\n    .bind(auth.company_id, ativoInput, ativoInput)\r\n    .first<{ id: string }>()\r\n\r\n  if (!ativo) {\r\n    return Response.json({ error: 'Ativo invalido.' }, { status: 400 })\r\n  }\r\n\r\n  const updates = [\r\n    'id_ativo = ?',\r\n    'id_os = ?',\r\n    'nota_pendencia = ?',\r\n    'nota_status = ?',\r\n    'nota_data_programada = ?',\r\n    'nota_data_realizada = ?',\r\n    'nota_observacao_pcm = ?',\r\n    'nota_observacao_tecnico = ?'\r\n  ]\r\n  const values = [\r\n    ativo.id,\r\n    idOs || null,\r\n    pendencia,\r\n    status,\r\n    dataProgramada || null,\r\n    dataRealizada || null,\r\n    descricaoPcm || null,\r\n    descricaoTecnico || null,\r\n    notaId,\r\n    auth.company_id\r\n  ]\r\n\r\n  const changedFields: Array<{ label: string; before: string; after: string }> = []\r\n  const diff = (\r\n    label: string,\r\n    beforeValue: string | null | undefined,\r\n    afterValue: string | null | undefined\r\n  ) => {\r\n    const before = beforeValue ?? ''\r\n    const after = afterValue ?? ''\r\n    if (before !== after) {\r\n      changedFields.push({ label, before, after })\r\n    }\r\n  }\r\n\r\n  diff('Pend\u00EAncia', existing.nota_pendencia, pendencia)\r\n  diff('Status', existing.nota_status, status)\r\n  diff('Ativo', existing.id_ativo, ativo.id)\r\n  diff('OS', existing.id_os, idOs)\r\n  diff('Programada', existing.nota_data_programada, dataProgramada)\r\n  diff('Realizada', existing.nota_data_realizada, dataRealizada)\r\n  diff('Obs PCM', existing.nota_observacao_pcm, descricaoPcm)\r\n  diff('Obs T\u00E9cnico', existing.nota_observacao_tecnico, descricaoTecnico)\r\n\r\n  if (!changedFields.length) {\r\n    return Response.json(\r\n      { error: 'Nenhuma altera\u00E7\u00E3o detectada.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n\r\n  await env.DB\r\n    .prepare(\r\n      `UPDATE tb_nota\r\n       SET ${updates.join(', ')}\r\n       WHERE IDNOTA = ? AND company_id = ?`\r\n    )\r\n    .bind(...values)\r\n    .run()\r\n\r\n  const now = new Date().toISOString()\r\n  const resumo = changedFields\r\n    .map(change => `${change.label}: ${change.before || '-'} -> ${change.after || '-'}`)\r\n    .join(' | ')\r\n\r\n  await env.DB.prepare(\r\n    `INSERT INTO tb_nota_alteracao (\r\n       company_id,\r\n       IDNOTA,\r\n       usuario_id,\r\n       data_hora,\r\n       campos_alterados\r\n     ) VALUES (?, ?, ?, ?, ?)`\r\n  )\r\n    .bind(auth.company_id, notaId, auth.user_id, now, resumo)\r\n    .run()\r\n\r\n  const nota = await fetchNotaWithAsset(env, auth.company_id, notaId)\r\n  if (!nota) {\r\n    return Response.json(\r\n      { error: 'Nota atualizada, mas nao foi possivel recuperar os dados.' },\r\n      { status: 500 }\r\n    )\r\n  }\r\n\r\n  return Response.json({ nota })\r\n}\r\n\r\nfunction normalizeBooleanFlag(value: unknown, fallback: 0 | 1): 0 | 1 {\r\n  if (value === false || value === 'false' || value === 0 || value === '0') {\r\n    return 0\r\n  }\r\n  if (value === true || value === 'true' || value === 1 || value === '1') {\r\n    return 1\r\n  }\r\n  return fallback\r\n}\r\n\r\nfunction normalizeOptionalString(value: unknown): string | null {\r\n  const text = String(value ?? '').trim()\r\n  return text ? text : null\r\n}\r\n\r\nasync function handleListTarefas(\r\n  request: Request,\r\n  env: Env\r\n): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const permissionError = await requirePermission(env, auth, 'tarefas', 'leitura')\r\n  if (permissionError) return permissionError\r\n\r\n  const url = new URL(request.url)\r\n  const pageParam = Number(url.searchParams.get('page') ?? '1')\r\n  const perPageParam = Number(url.searchParams.get('per_page') ?? '20')\r\n  const sortKey = url.searchParams.get('sort') === 'tarefa' ? 'tarefa' : 'sigla'\r\n  const sortDir =\r\n    url.searchParams.get('order') === 'desc' ? 'DESC' : 'ASC'\r\n\r\n  const page = Math.max(1, Number.isFinite(pageParam) ? Math.trunc(pageParam) : 1)\r\n  const perPage = Math.min(\r\n    100,\r\n    Math.max(5, Number.isFinite(perPageParam) ? Math.trunc(perPageParam) : 20)\r\n  )\r\n\r\n  const conditions: string[] = ['company_id = ?']\r\n  const values: Array<string | number> = [auth.company_id]\r\n\r\n  const siglaFilter = normalizeOptionalString(url.searchParams.get('sigla'))\r\n  if (siglaFilter) {\r\n    conditions.push('sigla LIKE ?')\r\n    values.push(`%${siglaFilter}%`)\r\n  }\r\n\r\n  const sistemaFilter = normalizeOptionalString(url.searchParams.get('sistema'))\r\n  if (sistemaFilter) {\r\n    conditions.push('sistema LIKE ?')\r\n    values.push(`%${sistemaFilter}%`)\r\n  }\r\n\r\n  const activeParam = url.searchParams.get('active')\r\n  if (activeParam === 'false') {\r\n    conditions.push('active = ?')\r\n    values.push(0)\r\n  } else if (activeParam === 'true' || activeParam === null) {\r\n    conditions.push('active = ?')\r\n    values.push(1)\r\n  }\r\n\r\n  const countResult = await env.DB\r\n    .prepare(\r\n      `SELECT COUNT(*) AS total\r\n       FROM tb_tarefas\r\n       WHERE ${conditions.join(' AND ')}`\r\n    )\r\n    .bind(...values)\r\n    .first<{ total: number }>()\r\n\r\n  const offset = (page - 1) * perPage\r\n  const query = env.DB.prepare(\r\n    `SELECT id,\r\n            company_id,\r\n            id_sigla,\r\n            sigla,\r\n            tarefa,\r\n            medicao,\r\n            criticidade,\r\n            periodicidade,\r\n            sub_sistema,\r\n            sistema,\r\n            codigo,\r\n            active,\r\n            created_at,\r\n            updated_at,\r\n            created_by,\r\n            updated_by\r\n     FROM tb_tarefas\r\n     WHERE ${conditions.join(' AND ')}\r\n     ORDER BY ${sortKey} ${sortDir}\r\n     LIMIT ? OFFSET ?`\r\n  )\r\n\r\n  const result = await query.bind(...values, perPage, offset).all<TarefaRow>()\r\n\r\n  const tarefas = result.results.map(row => ({\r\n    ...row,\r\n    medicao: row.medicao === 1,\r\n    criticidade: row.criticidade === 1,\r\n    active: row.active === 1\r\n  }))\r\n\r\n  return Response.json({\r\n    tarefas,\r\n    meta: {\r\n      total: countResult?.total ?? 0,\r\n      page,\r\n      per_page: perPage\r\n    }\r\n  })\r\n}\r\n\r\nasync function handleCreateTarefa(\r\n  request: Request,\r\n  env: Env\r\n): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const permissionError = await requirePermission(env, auth, 'tarefas', 'criacao')\r\n  if (permissionError) return permissionError\r\n\r\n  const payload = await readJson(request)\r\n  if (!payload) {\r\n    return Response.json({ error: 'Dados invalidos.' }, { status: 400 })\r\n  }\r\n\r\n  const sigla = String(payload.sigla || '').trim()\r\n  const tarefa = String(payload.tarefa || '').trim()\r\n  const codigo = String(payload.codigo || '').trim()\r\n  if (!sigla || !tarefa) {\r\n    return Response.json(\r\n      { error: 'Sigla e tarefa sao obrigatorios.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n  if (!codigo) {\r\n    return Response.json(\r\n      { error: 'Codigo da tarefa e obrigatorio.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n  if (tarefa.length > 255) {\r\n    return Response.json(\r\n      { error: 'A descricao da tarefa nao pode ultrapassar 255 caracteres.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n\r\n  const periodicidadeRaw = Number(payload.periodicidade ?? '')\r\n  if (!Number.isFinite(periodicidadeRaw)) {\r\n    return Response.json(\r\n      { error: 'Periodicidade invalida.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n  const periodicidade = Math.trunc(periodicidadeRaw)\r\n  if (periodicidade < 1 || periodicidade > 60) {\r\n    return Response.json(\r\n      { error: 'Periodicidade deve estar entre 1 e 60.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n\r\n  const idSigla = String(payload.id_sigla || sigla).trim()\r\n  if (!idSigla) {\r\n    return Response.json(\r\n      { error: 'Identificador da sigla e obrigatorio.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n\r\n  const existing = await env.DB\r\n    .prepare(\r\n      `SELECT id\r\n       FROM tb_tarefas\r\n       WHERE company_id = ? AND sigla = ? AND codigo = ?`\r\n    )\r\n    .bind(auth.company_id, sigla, codigo)\r\n    .first<{ id: string }>()\r\n\r\n  if (existing) {\r\n    return Response.json(\r\n      { error: 'Ja existe uma tarefa com essa sigla e codigo.' },\r\n      { status: 409 }\r\n    )\r\n  }\r\n\r\n  const medicao = normalizeBooleanFlag(payload.medicao, 0)\r\n  const criticidade = normalizeBooleanFlag(payload.criticidade, 0)\r\n  const active = normalizeBooleanFlag(payload.active, 1)\r\n  const sistema = normalizeOptionalString(payload.sistema)\r\n  const subSistema = normalizeOptionalString(payload.sub_sistema)\r\n  const now = new Date().toISOString()\r\n  const id = crypto.randomUUID()\r\n\r\n  await env.DB\r\n    .prepare(\r\n      `INSERT INTO tb_tarefas (\r\n         id,\r\n         company_id,\r\n         id_sigla,\r\n         sigla,\r\n         tarefa,\r\n         medicao,\r\n         criticidade,\r\n         periodicidade,\r\n         sub_sistema,\r\n         sistema,\r\n         codigo,\r\n         active,\r\n         created_at,\r\n         updated_at,\r\n         created_by,\r\n         updated_by\r\n       ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`\r\n    )\r\n    .bind(\r\n      id,\r\n      auth.company_id,\r\n      idSigla,\r\n      sigla,\r\n      tarefa,\r\n      medicao,\r\n      criticidade,\r\n      periodicidade,\r\n      subSistema,\r\n      sistema,\r\n      codigo,\r\n      active,\r\n      now,\r\n      now,\r\n      auth.user_id,\r\n      auth.user_id\r\n    )\r\n    .run()\r\n\r\n  return Response.json({ ok: true, id })\r\n}\r\n\r\nasync function handleUpdateTarefa(\r\n  request: Request,\r\n  env: Env\r\n): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const permissionError = await requirePermission(env, auth, 'tarefas', 'edicao')\r\n  if (permissionError) return permissionError\r\n\r\n  const payload = await readJson(request)\r\n  if (!payload) {\r\n    return Response.json({ error: 'Dados invalidos.' }, { status: 400 })\r\n  }\r\n\r\n  const tarefaId = String(payload.id || '').trim()\r\n  if (!tarefaId) {\r\n    return Response.json({ error: 'ID da tarefa obrigatorio.' }, { status: 400 })\r\n  }\r\n\r\n  const existing = await env.DB\r\n    .prepare(\r\n      `SELECT *\r\n       FROM tb_tarefas\r\n       WHERE id = ? AND company_id = ?`\r\n    )\r\n    .bind(tarefaId, auth.company_id)\r\n    .first<TarefaRow>()\r\n\r\n  if (!existing) {\r\n    return Response.json({ error: 'Tarefa nao encontrada.' }, { status: 404 })\r\n  }\r\n\r\n  const sigla = String(payload.sigla ?? existing.sigla).trim()\r\n  const codigo = String(payload.codigo ?? existing.codigo).trim()\r\n  const tarefa = String(payload.tarefa ?? existing.tarefa).trim()\r\n  if (!sigla || !codigo || !tarefa) {\r\n    return Response.json(\r\n      { error: 'Sigla, codigo e tarefa sao obrigatorios.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n  if (tarefa.length > 255) {\r\n    return Response.json(\r\n      { error: 'A descricao da tarefa nao pode ultrapassar 255 caracteres.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n\r\n  const periodicidadeRaw =\r\n    payload.periodicidade !== undefined\r\n      ? Number(payload.periodicidade)\r\n      : existing.periodicidade\r\n  if (!Number.isFinite(periodicidadeRaw)) {\r\n    return Response.json(\r\n      { error: 'Periodicidade invalida.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n  const periodicidade = Math.trunc(periodicidadeRaw)\r\n  if (periodicidade < 1 || periodicidade > 60) {\r\n    return Response.json(\r\n      { error: 'Periodicidade deve estar entre 1 e 60.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n\r\n  const idSigla = String(payload.id_sigla ?? existing.id_sigla).trim()\r\n  if (!idSigla) {\r\n    return Response.json(\r\n      { error: 'Identificador da sigla e obrigatorio.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n\r\n  if (sigla !== existing.sigla || codigo !== existing.codigo) {\r\n    const conflict = await env.DB\r\n      .prepare(\r\n        `SELECT id\r\n         FROM tb_tarefas\r\n         WHERE company_id = ? AND sigla = ? AND codigo = ? AND id != ?`\r\n      )\r\n      .bind(auth.company_id, sigla, codigo, tarefaId)\r\n      .first<{ id: string }>()\r\n\r\n    if (conflict) {\r\n      return Response.json(\r\n        { error: 'Ja existe uma tarefa com essa sigla e codigo.' },\r\n        { status: 409 }\r\n      )\r\n    }\r\n  }\r\n\r\n  const medicao = normalizeBooleanFlag(payload.medicao, existing.medicao)\r\n  const criticidade = normalizeBooleanFlag(\r\n    payload.criticidade,\r\n    existing.criticidade\r\n  )\r\n  const active = normalizeBooleanFlag(payload.active, existing.active)\r\n  const sistema =\r\n    payload.sistema !== undefined\r\n      ? normalizeOptionalString(payload.sistema)\r\n      : existing.sistema\r\n  const subSistema =\r\n    payload.sub_sistema !== undefined\r\n      ? normalizeOptionalString(payload.sub_sistema)\r\n      : existing.sub_sistema\r\n  const now = new Date().toISOString()\r\n\r\n  await env.DB\r\n    .prepare(\r\n      `UPDATE tb_tarefas\r\n       SET id_sigla = ?,\r\n           sigla = ?,\r\n           tarefa = ?,\r\n           medicao = ?,\r\n           criticidade = ?,\r\n           periodicidade = ?,\r\n           sub_sistema = ?,\r\n           sistema = ?,\r\n           codigo = ?,\r\n           active = ?,\r\n           updated_at = ?,\r\n           updated_by = ?\r\n       WHERE id = ? AND company_id = ?`\r\n    )\r\n    .bind(\r\n      idSigla,\r\n      sigla,\r\n      tarefa,\r\n      medicao,\r\n      criticidade,\r\n      periodicidade,\r\n      subSistema,\r\n      sistema,\r\n      codigo,\r\n      active,\r\n      now,\r\n      auth.user_id,\r\n      tarefaId,\r\n      auth.company_id\r\n    )\r\n    .run()\r\n\r\n  return Response.json({ ok: true })\r\n}\r\n\r\nasync function fetchNotaWithAsset(\r\n  env: Env,\r\n  companyId: string,\r\n  notaId: number\r\n): Promise<NotaListRow | null> {\r\n  return env.DB\r\n    .prepare(\r\n      `SELECT n.IDNOTA,\r\n              n.company_id,\r\n              n.id_ativo,\r\n              n.id_os,\r\n              n.nota_pendencia,\r\n              n.nota_status,\r\n              n.nota_data_criada,\r\n              n.nota_data_programada,\r\n              n.nota_data_realizada,\r\n              n.nota_observacao_pcm,\r\n              n.nota_observacao_tecnico,\r\n              a.ATIVO_CODPE,\r\n              a.ATIVO_DESCRITIVO_OS\r\n       FROM tb_nota n\r\n       LEFT JOIN tb_ativo a ON a.id = n.id_ativo AND a.company_id = n.company_id\r\n       WHERE n.company_id = ? AND n.IDNOTA = ?`\r\n    )\r\n    .bind(companyId, notaId)\r\n    .first<NotaListRow>()\r\n}\r\n\r\nasync function handleDeleteComponente(\r\n  request: Request,\r\n  env: Env\r\n): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const permissionError = await requirePermission(\r\n    env,\r\n    auth,\r\n    'componentes',\r\n    'exclusao'\r\n  )\r\n  if (permissionError) return permissionError\r\n\r\n  const url = new URL(request.url)\r\n  const segments = url.pathname.split('/').filter(Boolean)\r\n  const rawId = segments[segments.length - 1]\r\n  const componentId = Number(rawId ?? '')\r\n  if (!Number.isFinite(componentId)) {\r\n    return Response.json({ error: 'ID invalido.' }, { status: 400 })\r\n  }\r\n\r\n  const result = await env.DB.prepare(\r\n    'DELETE FROM tb_componente WHERE IDCOMPONETE = ? AND company_id = ?'\r\n  )\r\n    .bind(componentId, auth.company_id)\r\n    .run()\r\n\r\n  if ((result.meta?.changes ?? 0) === 0) {\r\n    return Response.json({ error: 'Componente nao encontrado.' }, { status: 404 })\r\n  }\r\n\r\n  return Response.json({ ok: true })\r\n}\r\n\r\nasync function fetchComponenteWithAsset(\r\n  env: Env,\r\n  companyId: string,\r\n  componentId: number\r\n): Promise<ComponenteListRow | null> {\r\n  return env.DB\r\n    .prepare(\r\n      `SELECT c.IDCOMPONETE,\r\n              c.company_id,\r\n              c.IDATIVO,\r\n              c.COMP_NOME,\r\n              c.COMP_SERIAL,\r\n              c.COMP_DATA,\r\n              c.COMP_MODELO,\r\n              c.COMP_DESCRICAO,\r\n              a.ATIVO_CODPE,\r\n              a.ATIVO_DESCRITIVO_OS,\r\n              a.ATIVO_SIGLA,\r\n              a.ATIVO_COORDENACAO,\r\n              a.ATIVO_EQUIPE\r\n       FROM tb_componente c\r\n       LEFT JOIN tb_ativo a ON a.id = c.IDATIVO AND a.company_id = c.company_id\r\n       WHERE c.company_id = ? AND c.IDCOMPONETE = ?`\r\n    )\r\n    .bind(companyId, componentId)\r\n    .first<ComponenteListRow>()\r\n}\r\n\r\nasync function handleGetAtivo(request: Request, env: Env): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const url = new URL(request.url)\r\n  const id = url.searchParams.get('id')\r\n  const codpe = url.searchParams.get('codpe')\r\n\r\n  if (!id && !codpe) {\r\n    return Response.json({ error: 'id ou codpe obrigatorio.' }, { status: 400 })\r\n  }\r\n\r\n  const query = id\r\n    ? env.DB.prepare(\r\n        `SELECT *\r\n         FROM tb_ativo\r\n         WHERE id = ? AND company_id = ?`\r\n      ).bind(id, auth.company_id)\r\n    : env.DB.prepare(\r\n        `SELECT *\r\n         FROM tb_ativo\r\n         WHERE ATIVO_CODPE = ? AND company_id = ?`\r\n      ).bind(codpe, auth.company_id)\r\n\r\n  const ativo = await query.first<AtivoRow>()\r\n\r\n  if (!ativo) {\r\n    return Response.json({ error: 'Ativo nao encontrado.' }, { status: 404 })\r\n  }\r\n\r\n  return Response.json({ ativo })\r\n}\r\n\r\nasync function handleCreateAtivo(request: Request, env: Env): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const payload = await readJson(request)\r\n  if (!payload) {\r\n    return Response.json({ error: 'Dados invalidos.' }, { status: 400 })\r\n  }\r\n\r\n  const ativoEmpresa = normalizeAtivoField(payload.ATIVO_EMPRESA)\r\n  const ativoCodpe = normalizeAtivoField(payload.ATIVO_CODPE)\r\n  const ativoDescritivo = normalizeAtivoField(payload.ATIVO_DESCRITIVO_OS)\r\n  const ativoStatus = normalizeAtivoField(payload.ATIVO_STATUS)\r\n  const ativoCoordenacao = normalizeAtivoField(payload.ATIVO_COORDENACAO)\r\n  const ativoEquipe = normalizeAtivoField(payload.ATIVO_EQUIPE)\r\n  const ativoMonitorados = normalizeAtivoField(payload.ATIVO_MONITORADOS)\r\n  const ativoSigla = normalizeAtivoField(payload.ATIVO_SIGLA)\r\n  const ativoCiclo = normalizeAtivoField(payload.ATIVO_CICLO)\r\n  const contadorCiclo = normalizeAtivoField(payload.CONTADOR_CICLO)\r\n  const ativoTolerancia = normalizeAtivoField(payload.ATIVO_TOLERANCIA)\r\n  const ativoClasse = normalizeAtivoField(payload.ATIVO_CLASSE)\r\n  const ativoGrupo = normalizeAtivoField(payload.ATIVO_GRUPO)\r\n  const ativoOea = normalizeAtivoField(payload.ATIVO_OEA)\r\n  const ativoTmm = normalizeAtivoField(payload.ATIVO_TMM)\r\n\r\n  const requiredFields = [\r\n    ativoEmpresa,\r\n    ativoCodpe,\r\n    ativoDescritivo,\r\n    ativoStatus,\r\n    ativoCoordenacao,\r\n    ativoEquipe,\r\n    ativoMonitorados,\r\n    ativoSigla,\r\n    ativoCiclo,\r\n    contadorCiclo,\r\n    ativoTolerancia,\r\n    ativoClasse,\r\n    ativoGrupo,\r\n    ativoOea,\r\n    ativoTmm\r\n  ]\r\n\r\n  if (requiredFields.some(value => !value)) {\r\n    return Response.json(\r\n      { error: 'Preencha todos os campos obrigatorios.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n\r\n  if (ativoCoordenacao.length > 20) {\r\n    return Response.json(\r\n      { error: 'Coordenacao deve ter no maximo 20 caracteres.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n  if (ativoEquipe.length > 10) {\r\n    return Response.json(\r\n      { error: 'Equipe deve ter no maximo 10 caracteres.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n\r\n  const company = await env.DB.prepare(\r\n    'SELECT id, status FROM tb_company WHERE id = ?'\r\n  )\r\n    .bind(auth.company_id)\r\n    .first<CompanyRow>()\r\n\r\n  if (!company || company.status !== 'ativo') {\r\n    return Response.json({ error: 'Empresa invalida.' }, { status: 400 })\r\n  }\r\n\r\n    const estrutura = await env.DB.prepare(\r\n      `SELECT id FROM tb_estrutura\r\n       WHERE company_id = ? AND coordenacao = ? AND equipe = ? AND status = 'ativo' AND execucao = 'sim'`\r\n    )\r\n      .bind(auth.company_id, ativoCoordenacao, ativoEquipe)\r\n      .first<{ id: string }>()\r\n\r\n  if (!estrutura) {\r\n    return Response.json(\r\n      { error: 'Coordenacao/equipe invalida.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n\r\n  const conflict = await env.DB.prepare(\r\n    'SELECT id FROM tb_ativo WHERE company_id = ? AND ATIVO_CODPE = ?'\r\n  )\r\n    .bind(auth.company_id, ativoCodpe)\r\n    .first<{ id: string }>()\r\n\r\n  if (conflict) {\r\n    return Response.json({ error: 'ATIVO_CODPE ja existe.' }, { status: 409 })\r\n  }\r\n\r\n  const ativoId = crypto.randomUUID()\r\n  const ativoContador = 1\r\n\r\n  const optionalField = (value: unknown) => {\r\n    const normalized = value ? String(value).trim() : ''\r\n    return normalized ? normalized : null\r\n  }\r\n\r\n  const insertValues = {\r\n    id: ativoId,\r\n    company_id: auth.company_id,\r\n    ATIVO_EMPRESA: ativoEmpresa,\r\n    ATIVO_CODPE: ativoCodpe,\r\n    ATIVO_DESCRITIVO_OS: ativoDescritivo,\r\n    ATIVO_STATUS: ativoStatus,\r\n    ATIVO_COORDENACAO: ativoCoordenacao,\r\n    ATIVO_EQUIPE: ativoEquipe,\r\n    ATIVO_MONITORADOS: ativoMonitorados,\r\n    ATIVO_SIGLA: ativoSigla,\r\n    ATIVO_CICLO: ativoCiclo,\r\n    ATIVO_CONTADOR: ativoContador,\r\n    CONTADOR_CICLO: contadorCiclo,\r\n    ATIVO_TOLERANCIA: ativoTolerancia,\r\n    ATIVO_CLASSE: ativoClasse,\r\n    ATIVO_GRUPO: ativoGrupo,\r\n    ATIVO_OEA: ativoOea,\r\n    ATIVO_TMM: ativoTmm,\r\n    ATIVO_LATITUDE: optionalField(payload.ATIVO_LATITUDE),\r\n    ATIVO_LONGITUDE: optionalField(payload.ATIVO_LONGITUDE),\r\n    ATIVO_ULTIMA_MANUT: optionalField(payload.ATIVO_ULTIMA_MANUT),\r\n    ATIVO_MODELO_POSTE: optionalField(payload.ATIVO_MODELO_POSTE),\r\n    ATIVO_MODELO_RELE: optionalField(payload.ATIVO_MODELO_RELE),\r\n    ATIVO_MODELO_DDS: optionalField(payload.ATIVO_MODELO_DDS),\r\n    ATIVO_DDS_SERIAL: optionalField(payload.ATIVO_DDS_SERIAL),\r\n    ATIVO_DDS_DTQ: optionalField(payload.ATIVO_DDS_DTQ),\r\n    ATIVO_MYTRAIN: optionalField(payload.ATIVO_MYTRAIN),\r\n    ATIVO_JAMPER1: optionalField(payload.ATIVO_JAMPER1),\r\n    ATIVO_JAMPER2: optionalField(payload.ATIVO_JAMPER2),\r\n    ATIVO_MODELO: optionalField(payload.ATIVO_MODELO),\r\n    ATIVO_OBSERVACAO: optionalField(payload.ATIVO_OBSERVACAO)\r\n  }\r\n\r\n  await env.DB.prepare(\r\n    `INSERT INTO tb_ativo (\r\n      id,\r\n      company_id,\r\n      ATIVO_EMPRESA,\r\n      ATIVO_CODPE,\r\n      ATIVO_DESCRITIVO_OS,\r\n      ATIVO_STATUS,\r\n      ATIVO_COORDENACAO,\r\n      ATIVO_EQUIPE,\r\n      ATIVO_MONITORADOS,\r\n      ATIVO_SIGLA,\r\n      ATIVO_CICLO,\r\n      ATIVO_CONTADOR,\r\n      CONTADOR_CICLO,\r\n      ATIVO_TOLERANCIA,\r\n      ATIVO_CLASSE,\r\n      ATIVO_GRUPO,\r\n      ATIVO_OEA,\r\n      ATIVO_TMM,\r\n      ATIVO_LATITUDE,\r\n      ATIVO_LONGITUDE,\r\n      ATIVO_ULTIMA_MANUT,\r\n      ATIVO_MODELO_POSTE,\r\n      ATIVO_MODELO_RELE,\r\n      ATIVO_MODELO_DDS,\r\n      ATIVO_DDS_SERIAL,\r\n      ATIVO_DDS_DTQ,\r\n      ATIVO_MYTRAIN,\r\n      ATIVO_JAMPER1,\r\n      ATIVO_JAMPER2,\r\n      ATIVO_MODELO,\r\n      ATIVO_OBSERVACAO\r\n    ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`\r\n  )\r\n    .bind(\r\n      insertValues.id,\r\n      insertValues.company_id,\r\n      insertValues.ATIVO_EMPRESA,\r\n      insertValues.ATIVO_CODPE,\r\n      insertValues.ATIVO_DESCRITIVO_OS,\r\n      insertValues.ATIVO_STATUS,\r\n      insertValues.ATIVO_COORDENACAO,\r\n      insertValues.ATIVO_EQUIPE,\r\n      insertValues.ATIVO_MONITORADOS,\r\n      insertValues.ATIVO_SIGLA,\r\n      insertValues.ATIVO_CICLO,\r\n      insertValues.ATIVO_CONTADOR,\r\n      insertValues.CONTADOR_CICLO,\r\n      insertValues.ATIVO_TOLERANCIA,\r\n      insertValues.ATIVO_CLASSE,\r\n      insertValues.ATIVO_GRUPO,\r\n      insertValues.ATIVO_OEA,\r\n      insertValues.ATIVO_TMM,\r\n      insertValues.ATIVO_LATITUDE,\r\n      insertValues.ATIVO_LONGITUDE,\r\n      insertValues.ATIVO_ULTIMA_MANUT,\r\n      insertValues.ATIVO_MODELO_POSTE,\r\n      insertValues.ATIVO_MODELO_RELE,\r\n      insertValues.ATIVO_MODELO_DDS,\r\n      insertValues.ATIVO_DDS_SERIAL,\r\n      insertValues.ATIVO_DDS_DTQ,\r\n      insertValues.ATIVO_MYTRAIN,\r\n      insertValues.ATIVO_JAMPER1,\r\n      insertValues.ATIVO_JAMPER2,\r\n      insertValues.ATIVO_MODELO,\r\n      insertValues.ATIVO_OBSERVACAO\r\n    )\r\n    .run()\r\n\r\n  await logAtivoHistory(env, {\r\n    companyId: auth.company_id,\r\n    ativoId,\r\n    action: 'criado',\r\n    beforeData: null,\r\n    afterData: JSON.stringify(insertValues),\r\n    changedByUserId: auth.user_id,\r\n    changedByName: auth.nome\r\n  })\r\n\r\n  const ativo = await env.DB.prepare(\r\n    `SELECT * FROM tb_ativo WHERE id = ? AND company_id = ?`\r\n  )\r\n    .bind(ativoId, auth.company_id)\r\n    .first<AtivoRow>()\r\n\r\n  return Response.json({ ativo }, { status: 201 })\r\n}\r\n\r\nasync function handleUpdateAtivo(request: Request, env: Env): Promise<Response> {\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const payload = await readJson(request)\r\n  if (!payload) {\r\n    return Response.json({ error: 'Dados invalidos.' }, { status: 400 })\r\n  }\r\n\r\n  const id = String(payload.id || '').trim()\r\n  if (!id) {\r\n    return Response.json({ error: 'ID obrigatorio.' }, { status: 400 })\r\n  }\r\n\r\n  const existing = await env.DB.prepare(\r\n    `SELECT * FROM tb_ativo WHERE id = ? AND company_id = ?`\r\n  )\r\n    .bind(id, auth.company_id)\r\n    .first<AtivoRow>()\r\n\r\n  if (!existing) {\r\n    return Response.json({ error: 'Ativo nao encontrado.' }, { status: 404 })\r\n  }\r\n\r\n  if (payload.ATIVO_STATUS !== undefined) {\n    const nextStatus = String(payload.ATIVO_STATUS || '').trim().toLowerCase()\n    if (nextStatus === 'inativo' && existing.ATIVO_STATUS.toLowerCase() !== 'inativo') {\n      const permissionError = await requirePermission(\n        env,\n        auth,\n        'ativos',\n        'exclusao'\n      )\n      if (permissionError) return permissionError\n    }\n  }\n\n  const nextStatusValue =\n    payload.ATIVO_STATUS !== undefined\n      ? String(payload.ATIVO_STATUS || '').trim()\n      : existing.ATIVO_STATUS\n  const statusChanged =\n    payload.ATIVO_STATUS !== undefined &&\n    nextStatusValue.toLowerCase() !== existing.ATIVO_STATUS.toLowerCase()\n  const normalizedStatus = nextStatusValue.toLowerCase()\n  const statusLogPayload =\n    (payload.status_log as Record<string, unknown> | undefined) ?? undefined\n  let statusLogEntry:\n    | {\n        observacao: string\n        dataAlteracao: string\n        dataPrevisaoReparo: string | null\n      }\n    | null = null\n  if (statusChanged && normalizedStatus !== 'ok') {\n    const observacao = String(statusLogPayload?.observacao ?? '').trim()\n    const dataAlteracao = String(statusLogPayload?.data_alteracao ?? '').trim()\n    if (!observacao || !dataAlteracao) {\n      return Response.json(\n        { error: 'Observa\u00E7\u00E3o e data de altera\u00E7\u00E3o s\u00E3o obrigat\u00F3rias para status n\u00E3o OK.' },\n        { status: 400 }\n      )\n    }\n    const previsaoRaw = statusLogPayload?.data_previsao_reparo\n    const previsao =\n      previsaoRaw === undefined || previsaoRaw === null\n        ? null\n        : String(previsaoRaw).trim() || null\n    statusLogEntry = {\n      observacao,\n      dataAlteracao,\n      dataPrevisaoReparo: previsao\n    }\n  }\n\r\n  const requiredFieldsToCheck: Array<[string, unknown]> = [\r\n    ['ATIVO_EMPRESA', payload.ATIVO_EMPRESA],\r\n    ['ATIVO_CODPE', payload.ATIVO_CODPE],\r\n    ['ATIVO_DESCRITIVO_OS', payload.ATIVO_DESCRITIVO_OS],\r\n    ['ATIVO_STATUS', payload.ATIVO_STATUS],\r\n    ['ATIVO_COORDENACAO', payload.ATIVO_COORDENACAO],\r\n    ['ATIVO_EQUIPE', payload.ATIVO_EQUIPE],\r\n    ['ATIVO_MONITORADOS', payload.ATIVO_MONITORADOS],\r\n    ['ATIVO_SIGLA', payload.ATIVO_SIGLA],\r\n    ['ATIVO_CICLO', payload.ATIVO_CICLO],\r\n    ['CONTADOR_CICLO', payload.CONTADOR_CICLO],\r\n    ['ATIVO_TOLERANCIA', payload.ATIVO_TOLERANCIA],\r\n    ['ATIVO_CLASSE', payload.ATIVO_CLASSE],\r\n    ['ATIVO_GRUPO', payload.ATIVO_GRUPO],\r\n    ['ATIVO_OEA', payload.ATIVO_OEA],\r\n    ['ATIVO_TMM', payload.ATIVO_TMM]\r\n  ]\r\n\r\n  for (const [field, value] of requiredFieldsToCheck) {\r\n    if (value === undefined) continue\r\n    if (!String(value ?? '').trim()) {\r\n      return Response.json(\r\n        { error: `Campo obrigatorio vazio: ${field}.` },\r\n        { status: 400 }\r\n      )\r\n    }\r\n  }\r\n\r\n  const updates: string[] = []\r\n  const values: Array<string | number | null> = []\r\n\r\n  const applyUpdate = (field: keyof AtivoRow, value: unknown) => {\r\n    if (value === undefined) return\r\n    const normalized = value === null ? '' : String(value).trim()\r\n    if (!normalized) {\r\n      return\r\n    }\r\n    if ((existing as Record<string, unknown>)[field] === normalized) return\r\n    updates.push(`${field} = ?`)\r\n    values.push(normalized)\r\n  }\r\n\r\n  applyUpdate('ATIVO_EMPRESA', payload.ATIVO_EMPRESA)\r\n  applyUpdate('ATIVO_CODPE', payload.ATIVO_CODPE)\r\n  applyUpdate('ATIVO_DESCRITIVO_OS', payload.ATIVO_DESCRITIVO_OS)\r\n  applyUpdate('ATIVO_STATUS', payload.ATIVO_STATUS)\r\n  applyUpdate('ATIVO_COORDENACAO', payload.ATIVO_COORDENACAO)\r\n  applyUpdate('ATIVO_EQUIPE', payload.ATIVO_EQUIPE)\r\n  applyUpdate('ATIVO_MONITORADOS', payload.ATIVO_MONITORADOS)\r\n  applyUpdate('ATIVO_SIGLA', payload.ATIVO_SIGLA)\r\n  applyUpdate('ATIVO_CICLO', payload.ATIVO_CICLO)\r\n  if (payload.ATIVO_CONTADOR !== undefined && payload.ATIVO_CONTADOR !== null) {\r\n    const contadorValue = Number(payload.ATIVO_CONTADOR)\r\n    if (Number.isNaN(contadorValue)) {\r\n      return Response.json(\r\n        { error: 'ATIVO_CONTADOR deve ser numerico.' },\r\n        { status: 400 }\r\n      )\r\n    }\r\n    if (contadorValue !== existing.ATIVO_CONTADOR) {\r\n      updates.push('ATIVO_CONTADOR = ?')\r\n      values.push(contadorValue)\r\n    }\r\n  }\r\n  applyUpdate('CONTADOR_CICLO', payload.CONTADOR_CICLO)\r\n  applyUpdate('ATIVO_TOLERANCIA', payload.ATIVO_TOLERANCIA)\r\n  applyUpdate('ATIVO_CLASSE', payload.ATIVO_CLASSE)\r\n  applyUpdate('ATIVO_GRUPO', payload.ATIVO_GRUPO)\r\n  applyUpdate('ATIVO_OEA', payload.ATIVO_OEA)\r\n  applyUpdate('ATIVO_TMM', payload.ATIVO_TMM)\r\n\r\n  const optionalUpdate = (field: keyof AtivoRow, value: unknown) => {\r\n    if (value === undefined) return\r\n    const normalized = value ? String(value).trim() : null\r\n    if ((existing as Record<string, unknown>)[field] === normalized) return\r\n    updates.push(`${field} = ?`)\r\n    values.push(normalized)\r\n  }\r\n\r\n  optionalUpdate('ATIVO_LATITUDE', payload.ATIVO_LATITUDE)\r\n  optionalUpdate('ATIVO_LONGITUDE', payload.ATIVO_LONGITUDE)\r\n  optionalUpdate('ATIVO_ULTIMA_MANUT', payload.ATIVO_ULTIMA_MANUT)\r\n  optionalUpdate('ATIVO_MODELO_POSTE', payload.ATIVO_MODELO_POSTE)\r\n  optionalUpdate('ATIVO_MODELO_RELE', payload.ATIVO_MODELO_RELE)\r\n  optionalUpdate('ATIVO_MODELO_DDS', payload.ATIVO_MODELO_DDS)\r\n  optionalUpdate('ATIVO_DDS_SERIAL', payload.ATIVO_DDS_SERIAL)\r\n  optionalUpdate('ATIVO_DDS_DTQ', payload.ATIVO_DDS_DTQ)\r\n  optionalUpdate('ATIVO_MYTRAIN', payload.ATIVO_MYTRAIN)\r\n  optionalUpdate('ATIVO_JAMPER1', payload.ATIVO_JAMPER1)\r\n  optionalUpdate('ATIVO_JAMPER2', payload.ATIVO_JAMPER2)\r\n  optionalUpdate('ATIVO_MODELO', payload.ATIVO_MODELO)\r\n  optionalUpdate('ATIVO_OBSERVACAO', payload.ATIVO_OBSERVACAO)\r\n\r\n  if (!updates.length) {\r\n    return Response.json({ error: 'Nada para atualizar.' }, { status: 400 })\r\n  }\r\n\r\n  const nextCodpe =\n    payload.ATIVO_CODPE !== undefined &&\n    String(payload.ATIVO_CODPE).trim().length > 0\n      ? String(payload.ATIVO_CODPE).trim()\n      : existing.ATIVO_CODPE\n  const nextDescritivo =\n    payload.ATIVO_DESCRITIVO_OS !== undefined\n      ? String(payload.ATIVO_DESCRITIVO_OS).trim()\n      : existing.ATIVO_DESCRITIVO_OS\n  const nextCoordenacao =\n    payload.ATIVO_COORDENACAO !== undefined\n      ? String(payload.ATIVO_COORDENACAO).trim()\n      : existing.ATIVO_COORDENACAO\n  const nextEquipe =\r\n    payload.ATIVO_EQUIPE !== undefined\r\n      ? String(payload.ATIVO_EQUIPE).trim()\r\n      : existing.ATIVO_EQUIPE\r\n\r\n  if (nextCoordenacao.length > 20) {\r\n    return Response.json(\r\n      { error: 'Coordenacao deve ter no maximo 20 caracteres.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n  if (nextEquipe.length > 10) {\r\n    return Response.json(\r\n      { error: 'Equipe deve ter no maximo 10 caracteres.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n\r\n  if (\r\n    nextCoordenacao !== existing.ATIVO_COORDENACAO ||\r\n    nextEquipe !== existing.ATIVO_EQUIPE\r\n  ) {\r\n    const estrutura = await env.DB.prepare(\r\n      `SELECT id FROM tb_estrutura\r\n       WHERE company_id = ? AND coordenacao = ? AND equipe = ? AND status = 'ativo' AND execucao = 'sim'`\r\n    )\r\n      .bind(auth.company_id, nextCoordenacao, nextEquipe)\r\n      .first<{ id: string }>()\r\n\r\n    if (!estrutura) {\r\n      return Response.json(\r\n        { error: 'Coordenacao/equipe invalida.' },\r\n        { status: 400 }\r\n      )\r\n    }\r\n  }\r\n\r\n  if (\r\n    payload.ATIVO_CODPE !== undefined &&\r\n    payload.ATIVO_CODPE !== null &&\r\n    String(payload.ATIVO_CODPE).trim() !== existing.ATIVO_CODPE\r\n  ) {\r\n    const conflict = await env.DB.prepare(\r\n      'SELECT id FROM tb_ativo WHERE company_id = ? AND ATIVO_CODPE = ? AND id != ?'\r\n    )\r\n      .bind(auth.company_id, String(payload.ATIVO_CODPE).trim(), id)\r\n      .first<{ id: string }>()\r\n\r\n    if (conflict) {\r\n      return Response.json({ error: 'ATIVO_CODPE ja existe.' }, { status: 409 })\r\n    }\r\n  }\r\n\r\n  await env.DB.prepare(\r\n    `UPDATE tb_ativo SET ${updates.join(', ')} WHERE id = ? AND company_id = ?`\r\n  )\r\n    .bind(...values, id, auth.company_id)\r\n    .run()\r\n\r\n  const ativo = await env.DB.prepare(\r\n    `SELECT * FROM tb_ativo WHERE id = ? AND company_id = ?`\r\n  )\r\n    .bind(id, auth.company_id)\r\n    .first<AtivoRow>()\r\n\r\n  if (ativo) {\n    await logAtivoHistory(env, {\n      companyId: auth.company_id,\n      ativoId: id,\n      action: 'atualizado',\n      beforeData: JSON.stringify(existing),\n      afterData: JSON.stringify(ativo),\n      changedByUserId: auth.user_id,\n      changedByName: auth.nome\n    })\n  }\n\n  if (statusLogEntry && ativo) {\n    await logAtivoStatusChange(env, {\n      companyId: auth.company_id,\n      ativoId: id,\n      ativoCodpe: nextCodpe,\n      ativoDescritivo: nextDescritivo,\n      equipe: nextEquipe,\n      status: nextStatusValue,\n      observacao: statusLogEntry.observacao,\n      dataAlteracao: statusLogEntry.dataAlteracao,\n      dataPrevisaoReparo: statusLogEntry.dataPrevisaoReparo,\n      changedByUserId: auth.user_id,\n      changedByName: auth.nome\n    })\n  }\n\n  return Response.json({ ativo })\n}\n\nasync function handleAtivoStatusHistory(\n  request: Request,\n  env: Env\n): Promise<Response> {\n  assertJwtSecret(env)\n  const auth = await requireAuth(request, env)\n  if (!auth) {\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\n  }\n\n  const url = new URL(request.url)\n  const ativoId = url.searchParams.get('ativo_id')\n  if (!ativoId) {\n    return Response.json({ error: 'ativo_id obrigatorio.' }, { status: 400 })\n  }\n\n  const result = await env.DB.prepare(\n    `SELECT id,\n            ativo_id,\n            ativo_codpe,\n            ativo_descritivo,\n            equipe,\n            status,\n            observacao,\n            data_alteracao,\n            data_previsao_reparo,\n            changed_by_user_id,\n            changed_by_name,\n            created_at\n     FROM tb_ativo_status_log\n     WHERE company_id = ? AND ativo_id = ?\n     ORDER BY data_alteracao DESC`\n  )\n    .bind(auth.company_id, ativoId)\n    .all<AtivoStatusLogRow>()\n\n  return Response.json({ history: result.results })\n}\n\nasync function handleAtivoHistory(request: Request, env: Env): Promise<Response> {\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const url = new URL(request.url)\r\n  const ativoId = url.searchParams.get('ativo_id')\r\n  if (!ativoId) {\r\n    return Response.json({ error: 'ativo_id obrigatorio.' }, { status: 400 })\r\n  }\r\n\r\n  const result = await env.DB.prepare(\r\n    `SELECT id, company_id, ativo_id, action, before_data, after_data, changed_by_user_id, changed_by_name, created_at\r\n     FROM tb_ativo_history\r\n     WHERE company_id = ? AND ativo_id = ?\r\n     ORDER BY created_at DESC`\r\n  )\r\n    .bind(auth.company_id, ativoId)\r\n    .all<AtivoHistoryRow>()\r\n\r\n  return Response.json({ history: result.results })\r\n}\r\n\r\nasync function handleListOrderService(\r\n  request: Request,\r\n  env: Env\r\n): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const url = new URL(request.url)\r\n  const conditions: string[] = ['os.company_id = ?']\r\n  const values: Array<string | number> = [auth.company_id]\r\n\r\n  const ano = url.searchParams.get('ano')\r\n  const mes = url.searchParams.get('mes')\r\n  if (ano) {\r\n    conditions.push('os.os_ano = ?')\r\n    values.push(Number(ano))\r\n  }\r\n  if (mes) {\r\n    conditions.push('os.os_mes = ?')\r\n    values.push(Number(mes))\r\n  }\r\n  const osNumeroRaw = url.searchParams.get('os_numero')\r\n  if (osNumeroRaw) {\r\n    const osNumero = Number(osNumeroRaw)\r\n    if (!Number.isNaN(osNumero)) {\r\n      conditions.push('os.os_numero = ?')\r\n      values.push(osNumero)\r\n    }\r\n  }\r\n\r\n  const statusList = (url.searchParams.get('status') || '')\r\n    .split(',')\r\n    .map(item => item.trim().toUpperCase())\r\n    .filter(Boolean)\r\n  if (statusList.length) {\r\n    conditions.push(`os.os_status IN (${statusList.map(() => '?').join(', ')})`)\r\n    values.push(...statusList)\r\n  }\r\n\r\n  const tipo = normalizeOsTipo(url.searchParams.get('tipo'))\r\n  if (tipo) {\r\n    conditions.push('os.os_tipo = ?')\r\n    values.push(tipo)\r\n  }\r\n\r\n  const pdm = normalizeFlag(url.searchParams.get('pdm'))\r\n  if (pdm !== null) {\r\n    conditions.push('os.os_pdm = ?')\r\n    values.push(pdm)\r\n  }\r\n\r\n  const capex = normalizeFlag(url.searchParams.get('capex'))\r\n  if (capex !== null) {\r\n    conditions.push('os.os_capex = ?')\r\n    values.push(capex)\r\n  }\r\n\r\n  const equipeList = (url.searchParams.get('equipe') || '')\r\n    .split(',')\r\n    .map(item => item.trim())\r\n    .filter(Boolean)\r\n  if (equipeList.length) {\r\n    conditions.push(`e.equipe IN (${equipeList.map(() => '?').join(', ')})`)\r\n    values.push(...equipeList)\r\n  }\r\n\r\n  const coordenacao = url.searchParams.get('coordenacao')\r\n  if (coordenacao) {\r\n    conditions.push('e.coordenacao = ?')\r\n    values.push(coordenacao)\r\n  }\r\n\r\n  const search = url.searchParams.get('search')\r\n  if (search) {\r\n    const terms = search\r\n      .split(',')\r\n      .map(item => item.trim())\r\n      .filter(Boolean)\r\n    const numericTerms = terms.filter(item => /^[0-9]+$/.test(item))\r\n    const textTerms = terms.filter(item => !/^[0-9]+$/.test(item))\r\n\r\n    const subConditions: string[] = []\r\n\r\n    if (numericTerms.length) {\r\n      subConditions.push(\r\n        `os.os_numero IN (${numericTerms.map(() => '?').join(', ')})`\r\n      )\r\n      values.push(...numericTerms.map(Number))\r\n    }\r\n\r\n    for (const term of textTerms) {\r\n      subConditions.push('(a.ATIVO_CODPE LIKE ? OR a.ATIVO_DESCRITIVO_OS LIKE ?)')\r\n      values.push(`%${term}%`, `%${term}%`)\r\n    }\r\n\r\n    if (subConditions.length) {\r\n      conditions.push(`(${subConditions.join(' OR ')})`)\r\n    }\r\n  }\r\n\r\n  const result = await env.DB.prepare(\r\n    `SELECT os.id,\r\n            os.os_numero,\r\n            os.os_status,\r\n            os.os_pdm,\r\n            os.os_tipo,\r\n            os.os_checklist,\r\n            os.os_capex,\r\n            os.os_programado1,\r\n            os.os_programado2,\r\n            os.os_programado3,\r\n            os.os_programado4,\r\n            os.os_programado5,\r\n            os.os_realizado_em,\r\n            os.os_obs_pcm,\r\n            a.ATIVO_CODPE,\r\n            a.ATIVO_DESCRITIVO_OS,\r\n            a.ATIVO_EQUIPE\r\n     FROM tb_order_service os\r\n     JOIN tb_ativo a ON a.id = os.ativo_id\r\n     JOIN tb_estrutura e ON e.id = os.estrutura_id\r\n     WHERE ${conditions.join(' AND ')}\r\n     ORDER BY os.os_numero DESC`\r\n  )\r\n    .bind(...values)\r\n    .all<OrderServiceListRow>()\r\n\r\n  return Response.json({ os: result.results })\r\n}\r\n\r\nasync function handleGetOrderService(\r\n  request: Request,\r\n  env: Env\r\n): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const url = new URL(request.url)\r\n  const id = url.searchParams.get('id')\r\n  if (!id) {\r\n    return Response.json({ error: 'id obrigatorio.' }, { status: 400 })\r\n  }\r\n\r\n  const os = await env.DB\r\n    .prepare(\r\n      `SELECT os.*,\r\n              a.ATIVO_CODPE,\r\n              a.ATIVO_DESCRITIVO_OS,\r\n              a.ATIVO_EQUIPE,\r\n              e.coordenacao AS estrutura_coordenacao,\r\n              e.equipe AS estrutura_equipe\r\n       FROM tb_order_service os\r\n       JOIN tb_ativo a ON a.id = os.ativo_id\r\n       JOIN tb_estrutura e ON e.id = os.estrutura_id\r\n       WHERE os.id = ? AND os.company_id = ?`\r\n    )\r\n    .bind(id, auth.company_id)\r\n    .first<OrderServiceRow>()\r\n\r\n  if (!os) {\r\n    return Response.json({ error: 'OS nao encontrada.' }, { status: 404 })\r\n  }\r\n\r\n  return Response.json({ os })\r\n}\r\n\r\nasync function handleCreateOrderService(\r\n  request: Request,\r\n  env: Env\r\n): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const payload = await readJson(request)\r\n  if (!payload) {\r\n    return Response.json({ error: 'Dados invalidos.' }, { status: 400 })\r\n  }\r\n\r\n  const estruturaId = String(payload.estrutura_id || '').trim()\r\n  const ativoIdsRaw = Array.isArray(payload.ativo_ids) ? payload.ativo_ids : []\r\n  const ativoIds = Array.from(\r\n    new Set(ativoIdsRaw.map(id => String(id || '').trim()).filter(Boolean))\r\n  )\r\n\r\n  const osTipo = normalizeOsTipo(payload.os_tipo)\r\n  const osPdm = normalizeFlag(payload.os_pdm)\r\n  const osChecklist = normalizeFlag(payload.os_checklist)\r\n  const osCapex = normalizeFlag(payload.os_capex)\r\n  const osStatus = normalizeOsStatus(payload.os_status || 'CRIADO') || 'CRIADO'\r\n  const osAno = Number(payload.os_ano)\r\n  const osMes = Number(payload.os_mes)\r\n  const osObsPcm = payload.os_obs_pcm ? String(payload.os_obs_pcm).trim() : null\r\n\r\n  if (!estruturaId || !ativoIds.length || !osTipo) {\r\n    return Response.json(\r\n      { error: 'Estrutura, ativos e tipo sao obrigatorios.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n\r\n  if (osPdm === null || osChecklist === null || osCapex === null) {\r\n    return Response.json({ error: 'Flags invalidas.' }, { status: 400 })\r\n  }\r\n\r\n  if (!Number.isInteger(osAno) || !Number.isInteger(osMes)) {\r\n    return Response.json({ error: 'Ano/mes invalidos.' }, { status: 400 })\r\n  }\r\n\r\n  if (osMes < 1 || osMes > 12) {\r\n    return Response.json({ error: 'Mes invalido.' }, { status: 400 })\r\n  }\r\n\r\n  const company = await env.DB.prepare(\r\n    'SELECT id, status FROM tb_company WHERE id = ?'\r\n  )\r\n    .bind(auth.company_id)\r\n    .first<CompanyRow>()\r\n\r\n  if (!company || company.status !== 'ativo') {\r\n    return Response.json({ error: 'Empresa invalida.' }, { status: 400 })\r\n  }\r\n\r\n  const estrutura = await env.DB.prepare(\r\n    `SELECT id, coordenacao, equipe, status, execucao\r\n     FROM tb_estrutura\r\n     WHERE id = ? AND company_id = ?`\r\n  )\r\n    .bind(estruturaId, auth.company_id)\r\n    .first<{ id: string; coordenacao: string; equipe: string; status: string; execucao: string }>()\r\n\r\n  if (!estrutura || estrutura.status !== 'ativo' || estrutura.execucao !== 'sim') {\r\n    return Response.json({ error: 'Estrutura invalida.' }, { status: 400 })\r\n  }\r\n\r\n  const placeholders = ativoIds.map(() => '?').join(', ')\r\n  const ativos = await env.DB.prepare(\r\n    `SELECT id, ATIVO_EQUIPE\r\n     FROM tb_ativo\r\n     WHERE company_id = ? AND id IN (${placeholders})`\r\n  )\r\n    .bind(auth.company_id, ...ativoIds)\r\n    .all<{ id: string; ATIVO_EQUIPE: string }>()\r\n\r\n  if (ativos.results.length !== ativoIds.length) {\r\n    return Response.json({ error: 'Ativos invalidos.' }, { status: 400 })\r\n  }\r\n\r\n  for (const ativo of ativos.results) {\r\n    if (ativo.ATIVO_EQUIPE !== estrutura.equipe) {\r\n      return Response.json(\r\n        { error: 'Ativo fora da equipe selecionada.' },\r\n        { status: 400 }\r\n      )\r\n    }\r\n  }\r\n\r\n  const maxRow = await env.DB.prepare(\r\n    'SELECT COALESCE(MAX(os_numero), 0) AS max_numero FROM tb_order_service WHERE company_id = ?'\r\n  )\r\n    .bind(auth.company_id)\r\n    .first<{ max_numero: number }>()\r\n\r\n  let nextNumero = (maxRow?.max_numero ?? 0) + 1\r\n  const created: Array<{ id: string; os_numero: number; ativo_id: string }> = []\r\n\r\n  for (const ativo of ativos.results) {\r\n    const osId = crypto.randomUUID()\r\n    const numero = nextNumero++\r\n\r\n    await env.DB.prepare(\r\n      `INSERT INTO tb_order_service (\r\n        id,\r\n        company_id,\r\n        os_numero,\r\n        estrutura_id,\r\n        ativo_id,\r\n        os_tipo,\r\n        os_pdm,\r\n        os_status,\r\n        os_checklist,\r\n        os_capex,\r\n        os_realizado_em,\r\n        os_programado1,\r\n        os_programado2,\r\n        os_programado3,\r\n        os_programado4,\r\n        os_programado5,\r\n        os_obs_pcm,\r\n        os_obs_tecnico,\r\n        os_ano,\r\n        os_mes,\r\n        created_at,\r\n        created_by\r\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, NULL, NULL, NULL, NULL, NULL, NULL, ?, NULL, ?, ?, datetime('now'), ?)`\r\n    )\r\n      .bind(\r\n        osId,\r\n        auth.company_id,\r\n        numero,\r\n        estruturaId,\r\n        ativo.id,\r\n        osTipo,\r\n        osPdm,\r\n        osStatus,\r\n        osChecklist,\r\n        osCapex,\r\n        osObsPcm,\r\n        osAno,\r\n        osMes,\r\n        auth.user_id\r\n      )\r\n      .run()\r\n\r\n    const afterData = {\r\n      id: osId,\r\n      company_id: auth.company_id,\r\n      os_numero: numero,\r\n      estrutura_id: estruturaId,\r\n      ativo_id: ativo.id,\r\n      os_tipo: osTipo,\r\n      os_pdm: osPdm,\r\n      os_status: osStatus,\r\n      os_checklist: osChecklist,\r\n      os_capex: osCapex,\r\n      os_obs_pcm: osObsPcm,\r\n      os_ano: osAno,\r\n      os_mes: osMes\r\n    }\r\n\r\n    await logOrderServiceHistory(env, {\r\n      companyId: auth.company_id,\r\n      orderServiceId: osId,\r\n      action: 'criado',\r\n      beforeData: null,\r\n      afterData: JSON.stringify(afterData),\r\n      changedByUserId: auth.user_id,\r\n      changedByName: auth.nome\r\n    })\r\n\r\n    created.push({ id: osId, os_numero: numero, ativo_id: ativo.id })\r\n  }\r\n\r\n  return Response.json({ created }, { status: 201 })\r\n}\r\n\r\nasync function handleUpdateOrderService(\r\n  request: Request,\r\n  env: Env\r\n): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const payload = await readJson(request)\r\n  if (!payload) {\r\n    return Response.json({ error: 'Dados invalidos.' }, { status: 400 })\r\n  }\r\n\r\n  const id = String(payload.id || '').trim()\r\n  if (!id) {\r\n    return Response.json({ error: 'ID obrigatorio.' }, { status: 400 })\r\n  }\r\n\r\n  const existing = await env.DB.prepare(\r\n    `SELECT * FROM tb_order_service WHERE id = ? AND company_id = ?`\r\n  )\r\n    .bind(id, auth.company_id)\r\n    .first<OrderServiceRow>()\r\n\r\n  if (!existing) {\r\n    return Response.json({ error: 'OS nao encontrada.' }, { status: 404 })\r\n  }\r\n\r\n  if (payload.os_programado1 !== undefined) {\r\n    const todayKey = getLocalDateKey()\r\n    const existingProgramado1 = normalizeDateOnly(existing.os_programado1)\r\n    if (\r\n      existing.os_status === 'PROGRAMADO' &&\r\n      !existing.os_realizado_em &&\r\n      existingProgramado1 &&\r\n      existingProgramado1 < todayKey\r\n    ) {\r\n      return Response.json(\r\n        { error: 'Semana 1 nao realizada nao pode ser alterada.' },\r\n        { status: 400 }\r\n      )\r\n    }\r\n  }\r\n\r\n  if (payload.os_status !== undefined) {\r\n    const nextStatus = normalizeOsStatus(payload.os_status)\r\n    if (nextStatus === 'CANCELADO' && existing.os_status !== 'CANCELADO') {\r\n      const permissionError = await requirePermission(\r\n        env,\r\n        auth,\r\n        'planejamento',\r\n        'exclusao'\r\n      )\r\n      if (permissionError) return permissionError\r\n    }\r\n  }\r\n\r\n  const updates: string[] = []\r\n  const values: Array<string | number | null> = []\r\n\r\n  const updateOptionalText = (field: keyof OrderServiceRow, value: unknown) => {\r\n    if (value === undefined) return\r\n    const normalized = String(value ?? '').trim()\r\n    const finalValue = normalized ? normalized : null\r\n    if ((existing as Record<string, unknown>)[field] === finalValue) return null\r\n    updates.push(`${field} = ?`)\r\n    values.push(finalValue)\r\n    return null\r\n  }\r\n\r\n  const updateFlag = (field: keyof OrderServiceRow, value: unknown) => {\r\n    if (value === undefined) return\r\n    const normalized = normalizeFlag(value)\r\n    if (normalized === null) {\r\n      return Response.json({ error: `Flag invalida: ${field}.` }, { status: 400 })\r\n    }\r\n    if ((existing as Record<string, unknown>)[field] === normalized) return null\r\n    updates.push(`${field} = ?`)\r\n    values.push(normalized)\r\n    return null\r\n  }\r\n\r\n  const updateTipo = (value: unknown) => {\r\n    if (value === undefined) return null\r\n    const normalized = normalizeOsTipo(value)\r\n    if (!normalized) {\r\n      return Response.json({ error: 'Tipo invalido.' }, { status: 400 })\r\n    }\r\n    if (existing.os_tipo === normalized) return null\r\n    updates.push('os_tipo = ?')\r\n    values.push(normalized)\r\n    return null\r\n  }\r\n\r\n  const updateStatus = (value: unknown) => {\r\n    if (value === undefined) return null\r\n    const normalized = normalizeOsStatus(value)\r\n    if (!normalized) {\r\n      return Response.json({ error: 'Status invalido.' }, { status: 400 })\r\n    }\r\n    if (existing.os_status === normalized) return null\r\n    updates.push('os_status = ?')\r\n    values.push(normalized)\r\n    return null\r\n  }\r\n\r\n  const responses = [\r\n    updateOptionalText('os_obs_pcm', payload.os_obs_pcm),\r\n    updateOptionalText('os_obs_tecnico', payload.os_obs_tecnico),\r\n    updateOptionalText('os_programado1', payload.os_programado1),\r\n    updateOptionalText('os_programado2', payload.os_programado2),\r\n    updateOptionalText('os_programado3', payload.os_programado3),\r\n    updateOptionalText('os_programado4', payload.os_programado4),\r\n    updateOptionalText('os_programado5', payload.os_programado5),\r\n    updateOptionalText('os_realizado_em', payload.os_realizado_em),\r\n    updateFlag('os_pdm', payload.os_pdm),\r\n    updateFlag('os_checklist', payload.os_checklist),\r\n    updateFlag('os_capex', payload.os_capex),\r\n    updateTipo(payload.os_tipo),\r\n    updateStatus(payload.os_status)\r\n  ]\r\n\r\n  const errorResponse = responses.find(item => item instanceof Response) as\r\n    | Response\r\n    | undefined\r\n  if (errorResponse) return errorResponse\r\n\r\n  if (payload.os_ano !== undefined) {\r\n    const value = Number(payload.os_ano)\r\n    if (!Number.isInteger(value)) {\r\n      return Response.json({ error: 'Ano invalido.' }, { status: 400 })\r\n    }\r\n    if (value !== existing.os_ano) {\r\n      updates.push('os_ano = ?')\r\n      values.push(value)\r\n    }\r\n  }\r\n\r\n  if (payload.os_mes !== undefined) {\r\n    const value = Number(payload.os_mes)\r\n    if (!Number.isInteger(value) || value < 1 || value > 12) {\r\n      return Response.json({ error: 'Mes invalido.' }, { status: 400 })\r\n    }\r\n    if (value !== existing.os_mes) {\r\n      updates.push('os_mes = ?')\r\n      values.push(value)\r\n    }\r\n  }\r\n\r\n  let nextEstruturaId = existing.estrutura_id\r\n  let nextAtivoId = existing.ativo_id\r\n\r\n  if (payload.estrutura_id !== undefined) {\r\n    nextEstruturaId = String(payload.estrutura_id || '').trim()\r\n    if (!nextEstruturaId) {\r\n      return Response.json({ error: 'Estrutura invalida.' }, { status: 400 })\r\n    }\r\n    if (nextEstruturaId !== existing.estrutura_id) {\r\n      const estrutura = await env.DB.prepare(\r\n        `SELECT id, equipe, status, execucao FROM tb_estrutura WHERE id = ? AND company_id = ?`\r\n      )\r\n        .bind(nextEstruturaId, auth.company_id)\r\n        .first<{ id: string; equipe: string; status: string; execucao: string }>()\r\n\r\n      if (!estrutura || estrutura.status !== 'ativo' || estrutura.execucao !== 'sim') {\r\n        return Response.json({ error: 'Estrutura invalida.' }, { status: 400 })\r\n      }\r\n      updates.push('estrutura_id = ?')\r\n      values.push(nextEstruturaId)\r\n    }\r\n  }\r\n\r\n  if (payload.ativo_id !== undefined) {\r\n    nextAtivoId = String(payload.ativo_id || '').trim()\r\n    if (!nextAtivoId) {\r\n      return Response.json({ error: 'Ativo invalido.' }, { status: 400 })\r\n    }\r\n    if (nextAtivoId !== existing.ativo_id) {\r\n      const ativo = await env.DB.prepare(\r\n        `SELECT id, ATIVO_EQUIPE FROM tb_ativo WHERE id = ? AND company_id = ?`\r\n      )\r\n        .bind(nextAtivoId, auth.company_id)\r\n        .first<{ id: string; ATIVO_EQUIPE: string }>()\r\n\r\n      if (!ativo) {\r\n        return Response.json({ error: 'Ativo invalido.' }, { status: 400 })\r\n      }\r\n      updates.push('ativo_id = ?')\r\n      values.push(nextAtivoId)\r\n    }\r\n  }\r\n\r\n  if (!updates.length) {\r\n    return Response.json({ error: 'Nada para atualizar.' }, { status: 400 })\r\n  }\r\n\r\n  updates.push('updated_at = datetime(\\'now\\')')\r\n  updates.push('updated_by = ?')\r\n  values.push(auth.user_id)\r\n\r\n  await env.DB.prepare(\r\n    `UPDATE tb_order_service SET ${updates.join(', ')} WHERE id = ? AND company_id = ?`\r\n  )\r\n    .bind(...values, id, auth.company_id)\r\n    .run()\r\n\r\n  const os = await env.DB.prepare(\r\n    `SELECT * FROM tb_order_service WHERE id = ? AND company_id = ?`\r\n  )\r\n    .bind(id, auth.company_id)\r\n    .first<OrderServiceRow>()\r\n\r\n  if (os) {\r\n    await logOrderServiceHistory(env, {\r\n      companyId: auth.company_id,\r\n      orderServiceId: id,\r\n      action: 'atualizado',\r\n      beforeData: JSON.stringify(existing),\r\n      afterData: JSON.stringify(os),\r\n      changedByUserId: auth.user_id,\r\n      changedByName: auth.nome\r\n    })\r\n  }\r\n\r\n  return Response.json({ os })\r\n}\r\n\r\nasync function handleBulkUpdateOrderService(\r\n  request: Request,\r\n  env: Env\r\n): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const payload = await readJson(request)\r\n  if (!payload) {\r\n    return Response.json({ error: 'Dados invalidos.' }, { status: 400 })\r\n  }\r\n\r\n  const idsRaw = Array.isArray(payload.ids) ? payload.ids : []\r\n  const ids = Array.from(\r\n    new Set(idsRaw.map(id => String(id || '').trim()).filter(Boolean))\r\n  )\r\n\r\n  if (!ids.length) {\r\n    return Response.json({ error: 'IDs obrigatorios.' }, { status: 400 })\r\n  }\r\n\r\n  const nextStatus =\r\n    payload.os_status !== undefined ? normalizeOsStatus(payload.os_status) : null\r\n  const nextTipo =\r\n    payload.os_tipo !== undefined ? normalizeOsTipo(payload.os_tipo) : null\r\n\r\n  if (payload.os_status !== undefined && !nextStatus) {\r\n    return Response.json({ error: 'Status invalido.' }, { status: 400 })\r\n  }\r\n  if (payload.os_tipo !== undefined && !nextTipo) {\r\n    return Response.json({ error: 'Tipo invalido.' }, { status: 400 })\r\n  }\r\n  if (!nextStatus && !nextTipo) {\r\n    return Response.json({ error: 'Nada para atualizar.' }, { status: 400 })\r\n  }\r\n\r\n  const permissionError = await requirePermission(\r\n    env,\r\n    auth,\r\n    'planejamento',\r\n    'edicao'\r\n  )\r\n  if (permissionError) return permissionError\r\n\r\n  if (nextStatus === 'CANCELADO') {\r\n    const cancelPermission = await requirePermission(\r\n      env,\r\n      auth,\r\n      'planejamento',\r\n      'exclusao'\r\n    )\r\n    if (cancelPermission) return cancelPermission\r\n  }\r\n\r\n  const placeholders = ids.map(() => '?').join(', ')\r\n  const existingRows = await env.DB.prepare(\r\n    `SELECT * FROM tb_order_service WHERE company_id = ? AND id IN (${placeholders})`\r\n  )\r\n    .bind(auth.company_id, ...ids)\r\n    .all<OrderServiceRow>()\r\n\r\n  if (existingRows.results.length !== ids.length) {\r\n    return Response.json({ error: 'OS invalidas.' }, { status: 400 })\r\n  }\r\n\r\n  let updated = 0\r\n\r\n  for (const existing of existingRows.results) {\r\n    const updates: string[] = []\r\n    const values: Array<string | number | null> = []\r\n\r\n    let changed = false\r\n\r\n    if (nextStatus && existing.os_status !== nextStatus) {\r\n      updates.push('os_status = ?')\r\n      values.push(nextStatus)\r\n      changed = true\r\n    }\r\n\r\n    if (nextTipo && existing.os_tipo !== nextTipo) {\r\n      updates.push('os_tipo = ?')\r\n      values.push(nextTipo)\r\n      changed = true\r\n    }\r\n\r\n    if (!changed) continue\r\n\r\n    updates.push('updated_at = datetime(\\'now\\')')\r\n    updates.push('updated_by = ?')\r\n    values.push(auth.user_id)\r\n\r\n    await env.DB.prepare(\r\n      `UPDATE tb_order_service SET ${updates.join(', ')} WHERE id = ? AND company_id = ?`\r\n    )\r\n      .bind(...values, existing.id, auth.company_id)\r\n      .run()\r\n\r\n    const afterData = {\r\n      ...existing,\r\n      os_status: nextStatus ?? existing.os_status,\r\n      os_tipo: nextTipo ?? existing.os_tipo\r\n    }\r\n\r\n    await logOrderServiceHistory(env, {\r\n      companyId: auth.company_id,\r\n      orderServiceId: existing.id,\r\n      action: 'atualizado',\r\n      beforeData: JSON.stringify(existing),\r\n      afterData: JSON.stringify(afterData),\r\n      changedByUserId: auth.user_id,\r\n      changedByName: auth.nome\r\n    })\r\n\r\n    updated += 1\r\n  }\r\n\r\n  return Response.json({ updated })\r\n}\r\n\r\nasync function handleGetSchedulerConfig(\r\n  request: Request,\r\n  env: Env\r\n): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const url = new URL(request.url)\r\n  const mes = String(url.searchParams.get('mes') || '').trim()\r\n  const coordenacao = String(url.searchParams.get('coordenacao') || '').trim()\r\n  const equipeId = String(url.searchParams.get('equipe_id') || '').trim()\r\n\r\n  if (!mes || !/^\\d{4}-\\d{2}$/.test(mes)) {\r\n    return Response.json({ error: 'Mes invalido.' }, { status: 400 })\r\n  }\r\n  if (!coordenacao || !equipeId) {\r\n    return Response.json(\r\n      { error: 'Coordenacao e equipe sao obrigatorias.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n\r\n  const subEquipe = String(url.searchParams.get('sub_equipe') || '').trim()\r\n  if (!subEquipe) {\r\n    return Response.json(\r\n      { error: 'Sub-equipe obrigatoria.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n\r\n  const row = await env.DB.prepare(\r\n    `SELECT id, company_id, coordenacao, equipe_id, sub_equipe, mes, data_json\r\n     FROM tb_os_scheduler_config_v2\r\n     WHERE company_id = ? AND coordenacao = ? AND equipe_id = ? AND sub_equipe = ? AND mes = ?`\r\n  )\r\n    .bind(auth.company_id, coordenacao, equipeId, subEquipe, mes)\r\n    .first<SchedulerConfigRow>()\r\n\r\n  if (!row) {\r\n    return Response.json({ config: null })\r\n  }\r\n\r\n  let config: unknown = null\r\n  try {\r\n    config = JSON.parse(row.data_json || 'null')\r\n  } catch {\r\n    config = null\r\n  }\r\n\r\n  return Response.json({ config })\r\n}\r\n\r\nasync function handleUpsertSchedulerConfig(\r\n  request: Request,\r\n  env: Env\r\n): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const payload = await readJson(request)\r\n  if (!payload) {\r\n    return Response.json({ error: 'Dados invalidos.' }, { status: 400 })\r\n  }\r\n\r\n  const mes = String(payload.mes || '').trim()\r\n  const coordenacao = String(payload.coordenacao || '').trim()\r\n  const equipeId = String(payload.equipe_id || '').trim()\r\n  const subEquipe = String(payload.sub_equipe || '').trim()\r\n  const config = payload.config\r\n\r\n  if (!mes || !/^\\d{4}-\\d{2}$/.test(mes)) {\r\n    return Response.json({ error: 'Mes invalido.' }, { status: 400 })\r\n  }\r\n  if (!coordenacao || !equipeId || !subEquipe) {\r\n    return Response.json(\r\n      { error: 'Coordenacao, equipe e sub-equipe sao obrigatorias.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n  if (!config || typeof config !== 'object') {\r\n    return Response.json({ error: 'Configuracao invalida.' }, { status: 400 })\r\n  }\r\n\r\n  const dataJson = JSON.stringify(config)\r\n  const existing = await env.DB.prepare(\r\n    `SELECT id FROM tb_os_scheduler_config_v2\r\n     WHERE company_id = ? AND coordenacao = ? AND equipe_id = ? AND sub_equipe = ? AND mes = ?`\r\n  )\r\n    .bind(auth.company_id, coordenacao, equipeId, subEquipe, mes)\r\n    .first<{ id: string }>()\r\n\r\n  if (existing?.id) {\r\n    await env.DB.prepare(\r\n      `UPDATE tb_os_scheduler_config_v2\r\n       SET data_json = ?, updated_at = datetime('now')\r\n       WHERE id = ? AND company_id = ?`\r\n    )\r\n      .bind(dataJson, existing.id, auth.company_id)\r\n      .run()\r\n  } else {\r\n    const id = crypto.randomUUID()\r\n    await env.DB.prepare(\r\n      `INSERT INTO tb_os_scheduler_config_v2 (\r\n         id,\r\n         company_id,\r\n         coordenacao,\r\n         equipe_id,\r\n         sub_equipe,\r\n         mes,\r\n         data_json,\r\n         created_at,\r\n         updated_at\r\n       ) VALUES (?, ?, ?, ?, ?, ?, ?, datetime('now'), datetime('now'))`\r\n    )\r\n      .bind(\r\n        id,\r\n        auth.company_id,\r\n        coordenacao,\r\n        equipeId,\r\n        subEquipe,\r\n        mes,\r\n        dataJson\r\n      )\r\n      .run()\r\n  }\r\n\r\n  return Response.json({ ok: true })\r\n}\r\n\r\nasync function handleGetSchedulerTeamConfig(\r\n  request: Request,\r\n  env: Env\r\n): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const url = new URL(request.url)\r\n  const coordenacao = url.searchParams.get('coordenacao')\r\n\r\n  const conditions: string[] = ['company_id = ?']\r\n  const values: Array<string | number> = [auth.company_id]\r\n\r\n  if (coordenacao) {\r\n    conditions.push('coordenacao = ?')\r\n    values.push(coordenacao)\r\n  }\r\n\r\n  const result = await env.DB.prepare(\r\n    `SELECT id, company_id, coordenacao, equipe, escala, observacao, created_at, updated_at\r\n     FROM tb_os_scheduler_team_config\r\n     WHERE ${conditions.join(' AND ')}\r\n     ORDER BY coordenacao, equipe`\r\n  )\r\n    .bind(...values)\r\n    .all<SchedulerTeamConfigRow>()\r\n\r\n  return Response.json({ configs: result.results })\r\n}\r\n\r\nasync function handleUpsertSchedulerTeamConfig(\r\n  request: Request,\r\n  env: Env\r\n): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const payload = await readJson(request)\r\n  if (!payload) {\r\n    return Response.json({ error: 'Dados invalidos.' }, { status: 400 })\r\n  }\r\n\r\n  const coordenacao = String(payload.coordenacao || '').trim()\r\n  const equipe = String(payload.equipe || '').trim()\r\n  const escala = normalizeEscala(String(payload.escala || ''))\r\n  const observacao =\r\n    payload.observacao !== undefined && payload.observacao !== null\r\n      ? String(payload.observacao).trim()\r\n      : null\r\n\r\n  if (!coordenacao || !equipe || !escala) {\r\n    return Response.json(\r\n      { error: 'Coordenacao, equipe e escala sao obrigatorias.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n\r\n  const existing = await env.DB.prepare(\r\n    `SELECT id FROM tb_os_scheduler_team_config\r\n     WHERE company_id = ? AND coordenacao = ? AND equipe = ?`\r\n  )\r\n    .bind(auth.company_id, coordenacao, equipe)\r\n    .first<{ id: string }>()\r\n\r\n  if (existing?.id) {\r\n    await env.DB.prepare(\r\n      `UPDATE tb_os_scheduler_team_config\r\n       SET escala = ?, observacao = ?, updated_at = datetime('now')\r\n       WHERE id = ? AND company_id = ?`\r\n    )\r\n      .bind(escala, observacao, existing.id, auth.company_id)\r\n      .run()\r\n  } else {\r\n    const id = crypto.randomUUID()\r\n    await env.DB.prepare(\r\n      `INSERT INTO tb_os_scheduler_team_config (\r\n         id,\r\n         company_id,\r\n         coordenacao,\r\n         equipe,\r\n         escala,\r\n         observacao,\r\n         created_at,\r\n         updated_at\r\n       ) VALUES (?, ?, ?, ?, ?, ?, datetime('now'), datetime('now'))`\r\n    )\r\n      .bind(id, auth.company_id, coordenacao, equipe, escala, observacao)\r\n      .run()\r\n  }\r\n\r\n  return Response.json({ ok: true })\r\n}\r\n\r\nasync function handleGetSchedulerSubTeamConfig(\r\n  request: Request,\r\n  env: Env\r\n): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const url = new URL(request.url)\r\n  const coordenacao = url.searchParams.get('coordenacao')\r\n  const equipeId = url.searchParams.get('equipe_id')\r\n\r\n  const conditions: string[] = ['company_id = ?']\r\n  const values: Array<string | number> = [auth.company_id]\r\n\r\n  if (coordenacao) {\r\n    conditions.push('coordenacao = ?')\r\n    values.push(coordenacao)\r\n  }\r\n  if (equipeId) {\r\n    conditions.push('equipe_id = ?')\r\n    values.push(equipeId)\r\n  }\r\n\r\n  const result = await env.DB.prepare(\r\n    `SELECT id, company_id, coordenacao, equipe_id, sub_equipe, escala, status, observacao, created_at, updated_at\r\n     FROM tb_os_scheduler_sub_team\r\n     WHERE ${conditions.join(' AND ')}\r\n     ORDER BY coordenacao, equipe_id, sub_equipe`\r\n  )\r\n    .bind(...values)\r\n    .all<SchedulerSubTeamConfigRow>()\r\n\r\n  return Response.json({ configs: result.results })\r\n}\r\n\r\nasync function handleUpsertSchedulerSubTeamConfig(\r\n  request: Request,\r\n  env: Env\r\n): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const payload = await readJson(request)\r\n  if (!payload) {\r\n    return Response.json({ error: 'Dados invalidos.' }, { status: 400 })\r\n  }\r\n\r\n  const coordenacao = String(payload.coordenacao || '').trim()\r\n  const equipeId = String(payload.equipe_id || '').trim()\r\n  const subEquipe = String(payload.sub_equipe || '').trim()\r\n  const escala = normalizeEscala(String(payload.escala || ''))\r\n  const status = normalizeStatus(String(payload.status || 'ativo'))\r\n  const observacao =\r\n    payload.observacao !== undefined && payload.observacao !== null\r\n      ? String(payload.observacao).trim()\r\n      : null\r\n\r\n  if (!coordenacao || !equipeId || !subEquipe || !escala || !status) {\r\n    return Response.json(\r\n      { error: 'Coordenacao, equipe, sub-equipe e escala sao obrigatorias.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n\r\n  const estrutura = await env.DB.prepare(\r\n    `SELECT id, coordenacao FROM tb_estrutura\r\n     WHERE id = ? AND company_id = ?`\r\n  )\r\n    .bind(equipeId, auth.company_id)\r\n    .first<{ id: string; coordenacao: string }>()\r\n\r\n  if (!estrutura || estrutura.coordenacao !== coordenacao) {\r\n    return Response.json({ error: 'Equipe invalida.' }, { status: 400 })\r\n  }\r\n\r\n  const existing = await env.DB.prepare(\r\n    `SELECT id FROM tb_os_scheduler_sub_team\r\n     WHERE company_id = ? AND coordenacao = ? AND equipe_id = ? AND sub_equipe = ?`\r\n  )\r\n    .bind(auth.company_id, coordenacao, equipeId, subEquipe)\r\n    .first<{ id: string }>()\r\n\r\n  try {\r\n    if (existing?.id) {\r\n      await env.DB.prepare(\r\n        `UPDATE tb_os_scheduler_sub_team\r\n         SET escala = ?, status = ?, observacao = ?, updated_at = datetime('now')\r\n         WHERE id = ? AND company_id = ?`\r\n      )\r\n        .bind(escala, status, observacao, existing.id, auth.company_id)\r\n        .run()\r\n    } else {\r\n      const id = crypto.randomUUID()\r\n      await env.DB.prepare(\r\n        `INSERT INTO tb_os_scheduler_sub_team (\r\n           id,\r\n           company_id,\r\n           coordenacao,\r\n           equipe_id,\r\n           sub_equipe,\r\n           escala,\r\n           status,\r\n           observacao,\r\n           created_at,\r\n           updated_at\r\n         ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, datetime('now'), datetime('now'))`\r\n      )\r\n        .bind(\r\n          id,\r\n          auth.company_id,\r\n          coordenacao,\r\n          equipeId,\r\n          subEquipe,\r\n          escala,\r\n          status,\r\n          observacao\r\n        )\r\n        .run()\r\n    }\r\n  } catch (error) {\r\n    console.error('scheduler-sub-team save failed', error)\r\n    return Response.json({ error: 'Falha ao salvar sub-equipe.' }, { status: 400 })\r\n  }\r\n\r\n  return Response.json({ ok: true })\r\n}\r\n\r\nasync function handleDeleteSchedulerSubTeamConfig(\r\n  request: Request,\r\n  env: Env\r\n): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const url = new URL(request.url)\r\n  const coordenacao = String(url.searchParams.get('coordenacao') || '').trim()\r\n  const equipeId = String(url.searchParams.get('equipe_id') || '').trim()\r\n  const subEquipe = String(url.searchParams.get('sub_equipe') || '').trim()\r\n\r\n  if (!coordenacao || !equipeId || !subEquipe) {\r\n    return Response.json(\r\n      { error: 'Coordenacao, equipe e sub-equipe sao obrigatorias.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n\r\n  await env.DB.prepare(\r\n    `DELETE FROM tb_os_scheduler_sub_team\r\n     WHERE company_id = ? AND coordenacao = ? AND equipe_id = ? AND sub_equipe = ?`\r\n  )\r\n    .bind(auth.company_id, coordenacao, equipeId, subEquipe)\r\n    .run()\r\n\r\n  return Response.json({ ok: true })\r\n}\r\n\r\nasync function handleGetSchedulerAssignments(\r\n  request: Request,\r\n  env: Env\r\n): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const url = new URL(request.url)\r\n  const coordenacao = url.searchParams.get('coordenacao')\r\n  const equipeId = url.searchParams.get('equipe_id')\r\n  const subEquipe = url.searchParams.get('sub_equipe')\r\n\r\n  const conditions: string[] = ['company_id = ?']\r\n  const values: Array<string | number> = [auth.company_id]\r\n\r\n  if (coordenacao) {\r\n    conditions.push('coordenacao = ?')\r\n    values.push(coordenacao)\r\n  }\r\n  if (equipeId) {\r\n    conditions.push('equipe_id = ?')\r\n    values.push(equipeId)\r\n  }\r\n  if (subEquipe) {\r\n    conditions.push('sub_equipe = ?')\r\n    values.push(subEquipe)\r\n  }\r\n\r\n  const result = await env.DB.prepare(\r\n    `SELECT id, company_id, os_id, coordenacao, equipe_id, sub_equipe, created_at, updated_at\r\n     FROM tb_os_scheduler_assignment\r\n     WHERE ${conditions.join(' AND ')}`\r\n  )\r\n    .bind(...values)\r\n    .all<SchedulerAssignmentRow>()\r\n\r\n  return Response.json({ assignments: result.results })\r\n}\r\n\r\nasync function handleUpsertSchedulerAssignment(\r\n  request: Request,\r\n  env: Env\r\n): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const payload = await readJson(request)\r\n  if (!payload) {\r\n    return Response.json({ error: 'Dados invalidos.' }, { status: 400 })\r\n  }\r\n\r\n  const osId = String(payload.os_id || '').trim()\r\n  const coordenacao = String(payload.coordenacao || '').trim()\r\n  const equipeId = String(payload.equipe_id || '').trim()\r\n  const subEquipe = String(payload.sub_equipe || '').trim()\r\n\r\n  if (!osId || !coordenacao || !equipeId || !subEquipe) {\r\n    return Response.json(\r\n      { error: 'OS, coordenacao, equipe e sub-equipe sao obrigatorias.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n\r\n  const os = await env.DB.prepare(\r\n    `SELECT id, os_status, os_programado1, os_realizado_em\r\n     FROM tb_order_service\r\n     WHERE id = ? AND company_id = ?`\r\n  )\r\n    .bind(osId, auth.company_id)\r\n    .first<OrderServiceRow>()\r\n\r\n  if (!os) {\r\n    return Response.json({ error: 'OS nao encontrada.' }, { status: 404 })\r\n  }\r\n\r\n  const estrutura = await env.DB.prepare(\r\n    `SELECT id, coordenacao FROM tb_estrutura WHERE id = ? AND company_id = ?`\r\n  )\r\n    .bind(equipeId, auth.company_id)\r\n    .first<{ id: string; coordenacao: string }>()\r\n\r\n  if (!estrutura || estrutura.coordenacao !== coordenacao) {\r\n    return Response.json({ error: 'Equipe invalida.' }, { status: 400 })\r\n  }\r\n\r\n  const existing = await env.DB.prepare(\r\n    `SELECT id, coordenacao, equipe_id, sub_equipe\r\n     FROM tb_os_scheduler_assignment\r\n     WHERE company_id = ? AND os_id = ?`\r\n  )\r\n    .bind(auth.company_id, osId)\r\n    .first<SchedulerAssignmentRow>()\r\n\r\n  const todayKey = getLocalDateKey()\r\n  const programado1 = normalizeDateOnly(os.os_programado1)\r\n  const isOverdueWeek1 =\r\n    os.os_status === 'PROGRAMADO' &&\r\n    !os.os_realizado_em &&\r\n    Boolean(programado1) &&\r\n    (programado1 || '') < todayKey\r\n\r\n  if (existing) {\r\n    if (existing.equipe_id === equipeId && existing.sub_equipe === subEquipe) {\r\n      return Response.json({ ok: true, id: existing.id })\r\n    }\r\n    if (os.os_status !== 'CRIADO' && !isOverdueWeek1) {\r\n      return Response.json(\r\n        { error: 'OS ja esta alocada em outra equipe.' },\r\n        { status: 409 }\r\n      )\r\n    }\r\n    await env.DB.prepare(\r\n      `UPDATE tb_os_scheduler_assignment\r\n       SET coordenacao = ?, equipe_id = ?, sub_equipe = ?, updated_at = datetime('now')\r\n       WHERE id = ? AND company_id = ?`\r\n    )\r\n      .bind(coordenacao, equipeId, subEquipe, existing.id, auth.company_id)\r\n      .run()\r\n    return Response.json({ ok: true, id: existing.id })\r\n  }\r\n\r\n  const id = crypto.randomUUID()\r\n  await env.DB.prepare(\r\n    `INSERT INTO tb_os_scheduler_assignment (\r\n       id,\r\n       company_id,\r\n       os_id,\r\n       coordenacao,\r\n       equipe_id,\r\n       sub_equipe,\r\n       created_at,\r\n       updated_at\r\n     ) VALUES (?, ?, ?, ?, ?, ?, datetime('now'), datetime('now'))`\r\n  )\r\n    .bind(id, auth.company_id, osId, coordenacao, equipeId, subEquipe)\r\n    .run()\r\n\r\n  return Response.json({ ok: true, id })\r\n}\r\n\r\nasync function handleDeleteSchedulerAssignment(\r\n  request: Request,\r\n  env: Env\r\n): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const url = new URL(request.url)\r\n  const osId = String(url.searchParams.get('os_id') || '').trim()\r\n  if (!osId) {\r\n    return Response.json({ error: 'os_id obrigatorio.' }, { status: 400 })\r\n  }\r\n\r\n  await env.DB.prepare(\r\n    `DELETE FROM tb_os_scheduler_assignment\r\n     WHERE company_id = ? AND os_id = ?`\r\n  )\r\n    .bind(auth.company_id, osId)\r\n    .run()\r\n\r\n  return Response.json({ ok: true })\r\n}\r\n\r\nasync function handleGetSchedulerHolidays(\r\n  request: Request,\r\n  env: Env\r\n): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const url = new URL(request.url)\r\n  const equipeId = url.searchParams.get('equipe_id')\r\n\r\n  const conditions: string[] = ['company_id = ?']\r\n  const values: Array<string | number> = [auth.company_id]\r\n\r\n  if (equipeId) {\r\n    conditions.push('equipe_id = ?')\r\n    values.push(equipeId)\r\n  }\r\n\r\n  const result = await env.DB.prepare(\r\n    `SELECT id, company_id, equipe_id, feriado, data, created_at, updated_at\r\n     FROM tb_os_scheduler_holiday\r\n     WHERE ${conditions.join(' AND ')}\r\n     ORDER BY data, feriado`\r\n  )\r\n    .bind(...values)\r\n    .all<SchedulerHolidayRow>()\r\n\r\n  return Response.json({ holidays: result.results })\r\n}\r\n\r\nasync function handleUpsertSchedulerHoliday(\r\n  request: Request,\r\n  env: Env\r\n): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const payload = await readJson(request)\r\n  if (!payload) {\r\n    return Response.json({ error: 'Dados invalidos.' }, { status: 400 })\r\n  }\r\n\r\n  const id = payload.id ? String(payload.id).trim() : ''\r\n  const feriado = String(payload.feriado || '').trim()\r\n  const data = String(payload.data || '').trim()\r\n\r\n  if (!feriado || !data) {\r\n    return Response.json(\r\n      { error: 'Feriado e data sao obrigatorios.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n\r\n  if (id) {\r\n    const equipeId = String(payload.equipe_id || '').trim()\r\n    if (!equipeId) {\r\n      return Response.json({ error: 'Equipe obrigatoria.' }, { status: 400 })\r\n    }\r\n\r\n    const estrutura = await env.DB.prepare(\r\n      `SELECT id FROM tb_estrutura WHERE id = ? AND company_id = ?`\r\n    )\r\n      .bind(equipeId, auth.company_id)\r\n      .first<{ id: string }>()\r\n\r\n    if (!estrutura) {\r\n      return Response.json({ error: 'Equipe invalida.' }, { status: 400 })\r\n    }\r\n\r\n    await env.DB.prepare(\r\n      `UPDATE tb_os_scheduler_holiday\r\n       SET equipe_id = ?, feriado = ?, data = ?, updated_at = datetime('now')\r\n       WHERE id = ? AND company_id = ?`\r\n    )\r\n      .bind(equipeId, feriado, data, id, auth.company_id)\r\n      .run()\r\n\r\n    return Response.json({ ok: true })\r\n  }\r\n\r\n  const allEquipes = Boolean(payload.all_equipes)\r\n  let equipeIds: string[] = Array.isArray(payload.equipe_ids)\r\n    ? payload.equipe_ids.map((value: unknown) => String(value).trim()).filter(Boolean)\r\n    : []\r\n\r\n  if (allEquipes) {\r\n    const result = await env.DB.prepare(\r\n      `SELECT id FROM tb_estrutura\r\n       WHERE company_id = ? AND status = 'ativo' AND execucao = 'sim'`\r\n    )\r\n      .bind(auth.company_id)\r\n      .all<{ id: string }>()\r\n    equipeIds = result.results.map(row => row.id)\r\n  }\r\n\r\n  if (!equipeIds.length) {\r\n    return Response.json(\r\n      { error: 'Selecione ao menos uma equipe.' },\r\n      { status: 400 }\r\n    )\r\n  }\r\n\r\n  const createdAt = await env.DB.prepare(`SELECT datetime('now') AS now`).first<{\r\n    now: string\r\n  }>()\r\n  const now = createdAt?.now || new Date().toISOString()\r\n\r\n  const insertStmt = env.DB.prepare(\r\n    `INSERT INTO tb_os_scheduler_holiday (\r\n       id,\r\n       company_id,\r\n       equipe_id,\r\n       feriado,\r\n       data,\r\n       created_at,\r\n       updated_at\r\n     ) VALUES (?, ?, ?, ?, ?, ?, ?)`\r\n  )\r\n\r\n  for (const equipeId of equipeIds) {\r\n    const estrutura = await env.DB.prepare(\r\n      `SELECT id FROM tb_estrutura WHERE id = ? AND company_id = ?`\r\n    )\r\n      .bind(equipeId, auth.company_id)\r\n      .first<{ id: string }>()\r\n\r\n    if (!estrutura) {\r\n      continue\r\n    }\r\n\r\n    const newId = crypto.randomUUID()\r\n    await insertStmt\r\n      .bind(newId, auth.company_id, equipeId, feriado, data, now, now)\r\n      .run()\r\n  }\r\n\r\n  return Response.json({ ok: true })\r\n}\r\n\r\nasync function handleOrderServiceHistory(\r\n  request: Request,\r\n  env: Env\r\n): Promise<Response> {\r\n  assertJwtSecret(env)\r\n  const auth = await requireAuth(request, env)\r\n  if (!auth) {\r\n    return Response.json({ error: 'Token invalido.' }, { status: 401 })\r\n  }\r\n\r\n  const url = new URL(request.url)\r\n  const osId = url.searchParams.get('os_id')\r\n  if (!osId) {\r\n    return Response.json({ error: 'os_id obrigatorio.' }, { status: 400 })\r\n  }\r\n\r\n  const result = await env.DB.prepare(\r\n    `SELECT id, company_id, order_service_id, action, before_data, after_data, changed_by_user_id, changed_by_name, created_at\r\n     FROM tb_order_service_history\r\n     WHERE company_id = ? AND order_service_id = ?\r\n     ORDER BY created_at DESC`\r\n  )\r\n    .bind(auth.company_id, osId)\r\n    .all<OrderServiceHistoryRow>()\r\n\r\n  return Response.json({ history: result.results })\r\n}\r\n\r\nasync function insertProfilePermissions(\r\n  env: Env,\r\n  profileId: string,\r\n  permissions: Array<Record<string, unknown>>\r\n) {\r\n  for (const item of permissions) {\r\n    const screenId = String(item.screen_id || '').trim()\r\n    if (!screenId) continue\r\n    const leitura = item.leitura ? 1 : 0\r\n    const criacao = item.criacao ? 1 : 0\r\n    const edicao = item.edicao ? 1 : 0\r\n    const exclusao = item.exclusao ? 1 : 0\r\n    await env.DB.prepare(\r\n      `INSERT INTO tb_profile_permission (profile_id, screen_id, leitura, criacao, edicao, exclusao)\r\n       VALUES (?, ?, ?, ?, ?, ?)`\r\n    )\r\n      .bind(profileId, screenId, leitura, criacao, edicao, exclusao)\r\n      .run()\r\n  }\r\n}\r\n\r\nasync function revokeActiveSessionsForUser(\n  env: Env,\n  userId: string,\n  companyId: string\n): Promise<void> {\n  const now = new Date().toISOString()\n  await env.DB.prepare(\n    `UPDATE tb_user_session\n     SET revoked_at = ?\n     WHERE company_id = ? AND user_id = ? AND revoked_at IS NULL`\n  )\n    .bind(now, companyId, userId)\n    .run()\n}\n\nasync function revokeSession(\n  env: Env,\n  sessionId: string,\n  companyId: string,\n  userId: string\n): Promise<void> {\n  const now = new Date().toISOString()\n  await env.DB.prepare(\n    `UPDATE tb_user_session\n     SET revoked_at = ?\n     WHERE id = ? AND company_id = ? AND user_id = ? AND revoked_at IS NULL`\n  )\n    .bind(now, sessionId, companyId, userId)\n    .run()\n}\n\r\nasync function createUserSession(\r\n  env: Env,\r\n  companyId: string,\r\n  userId: string,\r\n  ip: string | null\r\n): Promise<string> {\r\n  const id = crypto.randomUUID()\r\n  const now = new Date().toISOString()\r\n  await env.DB.prepare(\r\n    `INSERT INTO tb_user_session (id, company_id, user_id, ip, created_at)\r\n     VALUES (?, ?, ?, ?, ?)`\r\n  )\r\n    .bind(id, companyId, userId, ip, now)\r\n    .run()\r\n  return id\r\n}\r\n\r\nasync function getSessionById(\r\n  env: Env,\r\n  sessionId: string,\r\n  companyId: string,\r\n  userId: string\r\n): Promise<UserSessionRow | null> {\r\n  return env.DB\r\n    .prepare(\r\n      `SELECT id, company_id, user_id, ip, created_at, revoked_at\r\n       FROM tb_user_session\r\n       WHERE id = ? AND company_id = ? AND user_id = ?`\r\n    )\r\n    .bind(sessionId, companyId, userId)\r\n    .first<UserSessionRow>()\r\n}\r\n\r\nasync function requireAuth(request: Request, env: Env): Promise<AuthPayload | null> {\n  const header = request.headers.get('authorization') || ''\n  let token = header.startsWith('Bearer ') ? header.slice(7).trim() : ''\n  if (!token) {\n    token = getTokenFromCookie(request) || ''\n  }\n  if (!token) return null\n  const payload = await verifyJwt(token, env.JWT_SECRET)\r\n  if (!payload) return null\r\n  if (!payload.session_id) return null\r\n\r\n  const session = await getSessionById(\r\n    env,\r\n    payload.session_id,\r\n    payload.company_id,\r\n    payload.user_id\r\n  )\r\n  if (!session || session.revoked_at) {\r\n    return null\r\n  }\r\n\r\n  const requestIp = getClientIp(request)\n  if (session.ip && requestIp && session.ip !== requestIp) {\n    return null\n  }\n\n  const nowSeconds = Math.floor(Date.now() / 1000)\n  const refreshThresholdSeconds = SESSION_REFRESH_THRESHOLD_MINUTES * 60\n  if (payload.exp - nowSeconds <= refreshThresholdSeconds) {\n    const expiresMinutes =\n      parseInt(env.JWT_EXP_MINUTES || '', 10) || DEFAULT_JWT_EXP_MINUTES\n    const refreshToken = await signJwt(\n      {\n        user_id: payload.user_id,\n        company_id: payload.company_id,\n        nome: payload.nome,\n        cargo: payload.cargo,\n        equipe: payload.equipe,\n        session_id: payload.session_id\n      },\n      env.JWT_SECRET,\n      expiresMinutes\n    )\n    scheduleSessionRefresh(request, refreshToken, expiresMinutes * 60)\n  }\n\n  return payload\n}\n\r\nasync function requirePermission(\r\n  env: Env,\r\n  auth: AuthPayload,\r\n  screenId: string,\r\n  action: PermissionAction\r\n): Promise<Response | null> {\r\n  const row = await env.DB.prepare(\r\n    `SELECT p.status AS profile_status,\r\n            perm.leitura AS leitura,\r\n            perm.criacao AS criacao,\r\n            perm.edicao AS edicao,\r\n            perm.exclusao AS exclusao\r\n     FROM tb_user u\r\n     LEFT JOIN tb_profile p ON p.id = u.profile_id\r\n     LEFT JOIN tb_profile_permission perm\r\n       ON perm.profile_id = u.profile_id AND perm.screen_id = ?\r\n     WHERE u.id = ? AND u.company_id = ?`\r\n  )\r\n    .bind(screenId, auth.user_id, auth.company_id)\r\n    .first<PermissionCheckRow>()\r\n\r\n  if (!row || row.profile_status !== 'ativo') {\r\n    return Response.json({ error: 'Acesso negado.' }, { status: 403 })\r\n  }\r\n\r\n  const allowed =\r\n    action === 'leitura'\r\n      ? row.leitura === 1\r\n      : action === 'criacao'\r\n        ? row.criacao === 1\r\n        : action === 'edicao'\r\n          ? row.edicao === 1\r\n          : row.exclusao === 1\r\n\r\n  if (!allowed) {\r\n    return Response.json({ error: 'Acesso negado.' }, { status: 403 })\r\n  }\r\n\r\n  return null\r\n}\r\n\r\nasync function signJwt(\r\n  data: Omit<AuthPayload, 'exp'>,\r\n  secret: string,\r\n  expiresInMinutes: number\r\n): Promise<string> {\r\n  const header = { alg: 'HS256', typ: 'JWT' }\r\n  const exp = Math.floor(Date.now() / 1000) + expiresInMinutes * 60\r\n  const payload: AuthPayload = { ...data, exp }\r\n\r\n  const headerB64 = base64UrlEncode(JSON.stringify(header))\r\n  const payloadB64 = base64UrlEncode(JSON.stringify(payload))\r\n  const signature = await hmacSha256(`${headerB64}.${payloadB64}`, secret)\r\n\r\n  return `${headerB64}.${payloadB64}.${signature}`\r\n}\r\n\r\nasync function verifyJwt(token: string, secret: string): Promise<AuthPayload | null> {\r\n  const [headerB64, payloadB64, signature] = token.split('.')\r\n  if (!headerB64 || !payloadB64 || !signature) return null\r\n\r\n  const expected = await hmacSha256(`${headerB64}.${payloadB64}`, secret)\r\n  if (!timingSafeEqual(signature, expected)) return null\r\n\r\n  const payload = decodeBase64Url<AuthPayload>(payloadB64)\r\n  if (!payload || typeof payload.exp !== 'number') return null\r\n  if (payload.exp <= Math.floor(Date.now() / 1000)) return null\r\n\r\n  return payload\r\n}\r\n\r\nasync function hmacSha256(value: string, secret: string): Promise<string> {\r\n  const key = await crypto.subtle.importKey(\r\n    'raw',\r\n    new TextEncoder().encode(secret),\r\n    { name: 'HMAC', hash: 'SHA-256' },\r\n    false,\r\n    ['sign']\r\n  )\r\n  const signature = await crypto.subtle.sign('HMAC', key, new TextEncoder().encode(value))\r\n  return base64UrlEncode(new Uint8Array(signature))\r\n}\r\n\r\nfunction timingSafeEqual(a: string, b: string): boolean {\r\n  if (a.length !== b.length) return false\r\n  let result = 0\r\n  for (let i = 0; i < a.length; i += 1) {\r\n    result |= a.charCodeAt(i) ^ b.charCodeAt(i)\r\n  }\r\n  return result === 0\r\n}\r\n\r\nfunction base64UrlEncode(input: string | Uint8Array): string {\r\n  const bytes = typeof input === 'string' ? new TextEncoder().encode(input) : input\r\n  let binary = ''\r\n  bytes.forEach(byte => {\r\n    binary += String.fromCharCode(byte)\r\n  })\r\n  return btoa(binary).replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=+$/g, '')\r\n}\r\n\r\nfunction decodeBase64Url<T>(value: string): T | null {\r\n  const padded = value.replace(/-/g, '+').replace(/_/g, '/')\r\n  const padLength = (4 - (padded.length % 4)) % 4\r\n  const base64 = padded + '='.repeat(padLength)\r\n  try {\r\n    const decoded = atob(base64)\r\n    return JSON.parse(decoded) as T\r\n  } catch {\r\n    return null\r\n  }\r\n}\r\n\r\nfunction assertJwtSecret(env: Env) {\r\n  if (!env.JWT_SECRET) {\r\n    throw new Error('JWT_SECRET is required as an environment variable')\r\n  }\r\n}\r\n\r\nfunction normalizeStatus(value: string): 'ativo' | 'inativo' | 'excluido' | null {\r\n  if (value === 'ativo' || value === 'inativo' || value === 'excluido') {\r\n    return value\r\n  }\r\n  return null\r\n}\r\n\r\nfunction normalizeProfileStatus(value: string): 'ativo' | 'inativo' | null {\r\n  const normalized = normalizeStatus(value)\r\n  if (normalized === 'excluido') {\r\n    return null\r\n  }\r\n  return normalized\r\n}\r\n\r\nfunction normalizeEscala(value: string): 'ADM' | '6x2' | null {\r\n  const normalized = String(value ?? '').trim().toUpperCase()\r\n  if (normalized === 'ADM') return 'ADM'\r\n  if (normalized === '6X2') return '6x2'\r\n  return null\r\n}\r\n\r\nfunction normalizeAtivoField(value: unknown): string {\r\n  return String(value ?? '').trim()\r\n}\r\n\r\nfunction normalizeOsTipo(value: unknown): 'PDM' | 'EX' | 'RI' | null {\r\n  const normalized = String(value ?? '').trim().toUpperCase()\r\n  if (normalized === 'PDM' || normalized === 'EX' || normalized === 'RI') {\r\n    return normalized\r\n  }\r\n  return null\r\n}\r\n\r\nfunction normalizeOsStatus(\r\n  value: unknown\r\n): 'CRIADO' | 'PROGRAMADO' | 'REALIZADO' | 'CANCELADO' | null {\r\n  const normalized = String(value ?? '').trim().toUpperCase()\r\n  if (\r\n    normalized === 'CRIADO' ||\r\n    normalized === 'PROGRAMADO' ||\r\n    normalized === 'REALIZADO' ||\r\n    normalized === 'CANCELADO'\r\n  ) {\r\n    return normalized\r\n  }\r\n  return null\r\n}\r\n\r\nfunction normalizeFlag(value: unknown): 0 | 1 | null {\r\n  if (value === 0 || value === '0' || value === false) return 0\r\n  if (value === 1 || value === '1' || value === true) return 1\r\n  return null\r\n}\r\n\r\nfunction normalizeDateOnly(value: unknown): string | null {\r\n  if (!value) return null\r\n  const trimmed = String(value).trim()\r\n  if (!trimmed) return null\r\n  const datePart = trimmed.split('T')[0].split(' ')[0]\r\n  return datePart || null\r\n}\r\n\r\nfunction getLocalDateKey(): string {\r\n  const now = new Date()\r\n  const year = now.getFullYear()\r\n  const month = String(now.getMonth() + 1).padStart(2, '0')\r\n  const day = String(now.getDate()).padStart(2, '0')\r\n  return `${year}-${month}-${day}`\r\n}\r\n\r\nfunction isPasswordValid(value: string): boolean {\r\n  if (value.length < 7) return false\r\n  const hasLetter = /[A-Za-z]/.test(value)\r\n  const hasNumber = /[0-9]/.test(value)\r\n  const hasSpecial = /[!@#$%&]/.test(value)\r\n  return hasLetter && hasNumber && hasSpecial\r\n}\r\n\r\nfunction isValidCs(value: string): boolean {\r\n  return /^[0-9]{6}$/.test(value)\r\n}\r\n\r\nfunction isValidEmail(value: string): boolean {\n  return /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(value)\n}\n\nasync function readJson(request: Request): Promise<Record<string, unknown> | null> {\n  try {\n    if (!request.body) return null\n    return (await request.json()) as Record<string, unknown>\n  } catch {\n    return null\n  }\n}\n\nfunction parseBooleanFlag(value: unknown): 0 | 1 | null {\n  if (value === undefined || value === null) return null\n  if (typeof value === 'boolean') return value ? 1 : 0\n  const normalized = String(value).trim().toLowerCase()\n  if (normalized === '1' || normalized === 'true') return 1\n  if (normalized === '0' || normalized === 'false') return 0\n  return null\n}\n\nfunction parseNullableNumber(value: unknown): number | null {\n  if (value === undefined || value === null) return null\n  if (typeof value === 'number') {\n    return Number.isFinite(value) ? value : null\n  }\n  const normalized = String(value).trim()\n  if (!normalized) return null\n  const parsed = Number(normalized)\n  if (Number.isNaN(parsed)) return null\n  return parsed\n}\n\r\ntype LoginLogInput = {\r\n  success: 0 | 1\r\n  reason: string\r\n  companyId?: string | null\r\n  userId?: string | null\r\n  cs?: string | null\r\n  email?: string | null\r\n  ip?: string | null\r\n  userAgent?: string | null\r\n}\r\n\r\nasync function logLoginAttempt(env: Env, input: LoginLogInput): Promise<void> {\r\n  await env.DB\r\n    .prepare(\r\n      'INSERT INTO tb_login_log (id, company_id, user_id, cs, email, ip, user_agent, success, reason) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)'\r\n    )\r\n    .bind(\r\n      crypto.randomUUID(),\r\n      input.companyId ?? null,\r\n      input.userId ?? null,\r\n      input.cs ?? null,\r\n      input.email ?? null,\r\n      input.ip ?? null,\r\n      input.userAgent ?? null,\r\n      input.success,\r\n      input.reason\r\n    )\r\n    .run()\r\n}\r\n\r\ntype UserHistoryInput = {\r\n  companyId: string\r\n  userId: string\r\n  changedByUserId: string\r\n  changedByName: string\r\n  changes: string\r\n}\r\n\r\nasync function logUserHistory(env: Env, input: UserHistoryInput): Promise<void> {\r\n  await env.DB\r\n    .prepare(\r\n      'INSERT INTO tb_user_history (id, company_id, user_id, changed_by_user_id, changed_by_name, changes) VALUES (?, ?, ?, ?, ?, ?)'\r\n    )\r\n    .bind(\r\n      crypto.randomUUID(),\r\n      input.companyId,\r\n      input.userId,\r\n      input.changedByUserId,\r\n      input.changedByName,\r\n      input.changes\r\n    )\r\n    .run()\r\n}\r\n\r\ntype ProfileHistoryInput = {\r\n  companyId: string\r\n  profileId: string\r\n  changedByUserId: string\r\n  changedByName: string\r\n  changes: string\r\n}\r\n\r\nasync function logProfileHistory(env: Env, input: ProfileHistoryInput): Promise<void> {\r\n  await env.DB\r\n    .prepare(\r\n      'INSERT INTO tb_profile_history (id, company_id, profile_id, changed_by_user_id, changed_by_name, changes) VALUES (?, ?, ?, ?, ?, ?)'\r\n    )\r\n    .bind(\r\n      crypto.randomUUID(),\r\n      input.companyId,\r\n      input.profileId,\r\n      input.changedByUserId,\r\n      input.changedByName,\r\n      input.changes\r\n    )\r\n    .run()\r\n}\r\n\r\ntype EstruturaHistoryInput = {\r\n  companyId: string\r\n  estruturaId: string\r\n  action: 'criado' | 'atualizado'\r\n  beforeData: string | null\r\n  afterData: string\r\n  changedByUserId: string\r\n  changedByName: string\r\n}\r\n\r\nasync function logEstruturaHistory(\r\n  env: Env,\r\n  input: EstruturaHistoryInput\r\n): Promise<void> {\r\n  await env.DB\r\n    .prepare(\r\n      'INSERT INTO tb_estrutura_history (id, company_id, estrutura_id, action, before_data, after_data, changed_by_user_id, changed_by_name) VALUES (?, ?, ?, ?, ?, ?, ?, ?)'\r\n    )\r\n    .bind(\r\n      crypto.randomUUID(),\r\n      input.companyId,\r\n      input.estruturaId,\r\n      input.action,\r\n      input.beforeData,\r\n      input.afterData,\r\n      input.changedByUserId,\r\n      input.changedByName\r\n    )\r\n    .run()\r\n}\r\n\r\ntype AtivoHistoryInput = {\n  companyId: string\n  ativoId: string\n  action: 'criado' | 'atualizado'\n  beforeData: string | null\n  afterData: string\n  changedByUserId: string\n  changedByName: string\n}\n\r\nasync function logAtivoHistory(env: Env, input: AtivoHistoryInput): Promise<void> {\n  await env.DB\n    .prepare(\n      'INSERT INTO tb_ativo_history (id, company_id, ativo_id, action, before_data, after_data, changed_by_user_id, changed_by_name) VALUES (?, ?, ?, ?, ?, ?, ?, ?)'\n    )\n    .bind(\n      crypto.randomUUID(),\n      input.companyId,\r\n      input.ativoId,\r\n      input.action,\r\n      input.beforeData,\r\n      input.afterData,\r\n      input.changedByUserId,\r\n      input.changedByName\r\n    )\n    .run()\n}\n\ntype AtivoStatusLogInput = {\n  companyId: string\n  ativoId: string\n  ativoCodpe: string\n  ativoDescritivo: string\n  equipe: string\n  status: string\n  observacao: string\n  dataAlteracao: string\n  dataPrevisaoReparo: string | null\n  changedByUserId: string | null\n  changedByName: string | null\n}\nasync function logAtivoStatusChange(\n  env: Env,\n  input: AtivoStatusLogInput\n): Promise<void> {\n  await env.DB\n    .prepare(\n      `INSERT INTO tb_ativo_status_log (\n        id,\n        company_id,\n        ativo_id,\n        ativo_codpe,\n        ativo_descritivo,\n        equipe,\n        status,\n        observacao,\n        data_alteracao,\n        data_previsao_reparo,\n        changed_by_user_id,\n        changed_by_name\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`\n    )\n    .bind(\n      crypto.randomUUID(),\n      input.companyId,\n      input.ativoId,\n      input.ativoCodpe,\n      input.ativoDescritivo,\n      input.equipe,\n      input.status,\n      input.observacao,\n      input.dataAlteracao,\n      input.dataPrevisaoReparo,\n      input.changedByUserId,\n      input.changedByName\n    )\n    .run()\n}\n\r\ntype OrderServiceHistoryInput = {\r\n  companyId: string\r\n  orderServiceId: string\r\n  action: 'criado' | 'atualizado'\r\n  beforeData: string | null\r\n  afterData: string\r\n  changedByUserId: string\r\n  changedByName: string\r\n}\r\n\r\nasync function logOrderServiceHistory(\r\n  env: Env,\r\n  input: OrderServiceHistoryInput\r\n): Promise<void> {\r\n  await env.DB\r\n    .prepare(\r\n      'INSERT INTO tb_order_service_history (id, company_id, order_service_id, action, before_data, after_data, changed_by_user_id, changed_by_name) VALUES (?, ?, ?, ?, ?, ?, ?, ?)'\r\n    )\r\n    .bind(\r\n      crypto.randomUUID(),\r\n      input.companyId,\r\n      input.orderServiceId,\r\n      input.action,\r\n      input.beforeData,\r\n      input.afterData,\r\n      input.changedByUserId,\r\n      input.changedByName\r\n    )\r\n    .run()\r\n}\r\n\r\nfunction getClientIp(request: Request): string | null {\n  return (\n    request.headers.get('cf-connecting-ip') ||\n    request.headers.get('x-forwarded-for') ||\n    null\n  )\n}\n\nfunction getTokenFromCookie(request: Request): string | null {\n  const raw = request.headers.get('cookie') || ''\n  if (!raw) return null\n  const search = `${SESSION_COOKIE_NAME}=`\n  const parts = raw.split(';')\n  for (const part of parts) {\n    const trimmed = part.trim()\n    if (trimmed.startsWith(search)) {\n      return trimmed.slice(search.length)\n    }\n  }\n  return null\n}\n\nfunction isSecureRequest(request: Request): boolean {\n  const forwardedProto = request.headers.get('x-forwarded-proto')\n  if (forwardedProto) {\n    return forwardedProto.toLowerCase().includes('https')\n  }\n  const protocol = new URL(request.url).protocol\n  return protocol === 'https:'\n}\n\nfunction buildSessionCookie(\n  value: string,\n  request: Request,\n  maxAgeSeconds: number\n): string {\n  const secure = isSecureRequest(request)\n  const sameSite = secure ? 'None' : 'Lax'\n  const parts = [\n    `${SESSION_COOKIE_NAME}=${value}`,\n    `Max-Age=${maxAgeSeconds}`,\n    'Path=/',\n    'HttpOnly',\n    `SameSite=${sameSite}`\n  ]\n  if (secure) {\n    parts.push('Secure')\n  }\n  return parts.join('; ')\n}\n\r\nfunction resolveCorsOrigin(env: Env, request?: Request): string {\n  const explicit = env.CORS_ORIGIN?.trim()\n  if (explicit && explicit !== '*') {\n    return explicit\n  }\n  const requestOrigin = request?.headers.get('origin')\n  if (requestOrigin) {\n    return requestOrigin\n  }\n  return explicit || '*'\n}\n\nfunction withCors(\n  response: Response,\n  env: Env,\n  request?: Request\n): Response {\n  const origin = resolveCorsOrigin(env, request)\n  const headers = new Headers(response.headers)\n  headers.set('Access-Control-Allow-Origin', origin)\n  headers.set('Access-Control-Allow-Methods', 'GET,POST,PATCH,DELETE,OPTIONS')\n  headers.set('Access-Control-Allow-Headers', 'Content-Type, Authorization')\n  headers.set('Access-Control-Max-Age', '86400')\n  if (origin !== '*') {\n    headers.set('Access-Control-Allow-Credentials', 'true')\n  }\n  return new Response(response.body, {\n    status: response.status,\n    statusText: response.statusText,\n    headers\n  })\n}\n", "import type { Middleware } from \"./common\";\n\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} finally {\n\t\ttry {\n\t\t\tif (request.body !== null && !request.bodyUsed) {\n\t\t\t\tconst reader = request.body.getReader();\n\t\t\t\twhile (!(await reader.read()).done) {}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\n\t\t}\n\t}\n};\n\nexport default drainBody;\n", "import type { Middleware } from \"./common\";\n\ninterface JsonError {\n\tmessage?: string;\n\tname?: string;\n\tstack?: string;\n\tcause?: JsonError;\n}\n\nfunction reduceError(e: any): JsonError {\n\treturn {\n\t\tname: e?.name,\n\t\tmessage: e?.message ?? String(e),\n\t\tstack: e?.stack,\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\n\t};\n}\n\n// See comment in `bundle.ts` for details on why this is needed\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} catch (e: any) {\n\t\tconst error = reduceError(e);\n\t\treturn Response.json(error, {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\n\t\t});\n\t}\n};\n\nexport default jsonError;\n", "export type Awaitable<T> = T | Promise<T>;\n// TODO: allow dispatching more events?\nexport type Dispatcher = (\n\ttype: \"scheduled\",\n\tinit: { cron?: string }\n) => Awaitable<void>;\n\nexport type IncomingRequest = Request<\n\tunknown,\n\tIncomingRequestCfProperties<unknown>\n>;\n\nexport interface MiddlewareContext {\n\tdispatch: Dispatcher;\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\n}\n\nexport type Middleware = (\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tmiddlewareCtx: MiddlewareContext\n) => Awaitable<Response>;\n\nconst __facade_middleware__: Middleware[] = [];\n\n// The register functions allow for the insertion of one or many middleware,\n// We register internal middleware first in the stack, but have no way of controlling\n// the order that addMiddleware is run in service workers so need an internal function.\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\n\t__facade_middleware__.push(...args.flat());\n}\nexport function __facade_registerInternal__(\n\t...args: (Middleware | Middleware[])[]\n) {\n\t__facade_middleware__.unshift(...args.flat());\n}\n\nfunction __facade_invokeChain__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tmiddlewareChain: Middleware[]\n): Awaitable<Response> {\n\tconst [head, ...tail] = middlewareChain;\n\tconst middlewareCtx: MiddlewareContext = {\n\t\tdispatch,\n\t\tnext(newRequest, newEnv) {\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\n\t\t},\n\t};\n\treturn head(request, env, ctx, middlewareCtx);\n}\n\nexport function __facade_invoke__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tfinalMiddleware: Middleware\n): Awaitable<Response> {\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\n\t\t...__facade_middleware__,\n\t\tfinalMiddleware,\n\t]);\n}\n"],
  "mappings": "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AAC;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAChE;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAChE;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAChE;AAAA,QAAG;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAC/D;AAAA,QAAI;AAAA,QAAG;AAAA,QAAG;AAAA,QAAG;AAAA,QAAG;AAAA,QAAG;AAAA,QAAG;AAAA,QAAG;AAAA,QAAG;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAChE;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAChE;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAChE;AAAA,QAAI;AAAA,QAAI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Y;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,MAC5B;AAOA,UAAI,SAAS;AAAA,QACT;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,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",
  "names": ["bcrypt", "random", "callback", "salt", "utfx", "b", "err", "bcrypt"]
}
